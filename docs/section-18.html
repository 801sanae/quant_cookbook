<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 크롤링 이해하기 | R을 이용한 퀀트 투자 포트폴리오 만들기</title>
  <meta name="description" content="Chapter 4 크롤링 이해하기 | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 크롤링 이해하기 | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="hyunyulhenry/quant_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 크롤링 이해하기 | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  
  
  

<meta name="author" content="이현열" />


<meta name="date" content="2020-01-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="api-.html">
<link rel="next" href="section-23.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-7.0.1/css/motion.css" rel="stylesheet" />
<link href="libs/highcharts-7.0.1/css/htmlwdgtgrid.css" rel="stylesheet" />
<script src="libs/highcharts-7.0.1/highcharts.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-3d.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-more.js"></script>
<script src="libs/highcharts-7.0.1/modules/stock.js"></script>
<script src="libs/highcharts-7.0.1/modules/map.js"></script>
<script src="libs/highcharts-7.0.1/modules/annotations.js"></script>
<script src="libs/highcharts-7.0.1/modules/boost.js"></script>
<script src="libs/highcharts-7.0.1/modules/data.js"></script>
<script src="libs/highcharts-7.0.1/modules/drag-panes.js"></script>
<script src="libs/highcharts-7.0.1/modules/drilldown.js"></script>
<script src="libs/highcharts-7.0.1/modules/item-series.js"></script>
<script src="libs/highcharts-7.0.1/modules/offline-exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-7.0.1/modules/exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/export-data.js"></script>
<script src="libs/highcharts-7.0.1/modules/funnel.js"></script>
<script src="libs/highcharts-7.0.1/modules/heatmap.js"></script>
<script src="libs/highcharts-7.0.1/modules/treemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/sankey.js"></script>
<script src="libs/highcharts-7.0.1/modules/solid-gauge.js"></script>
<script src="libs/highcharts-7.0.1/modules/streamgraph.js"></script>
<script src="libs/highcharts-7.0.1/modules/sunburst.js"></script>
<script src="libs/highcharts-7.0.1/modules/vector.js"></script>
<script src="libs/highcharts-7.0.1/modules/wordcloud.js"></script>
<script src="libs/highcharts-7.0.1/modules/xrange.js"></script>
<script src="libs/highcharts-7.0.1/modules/tilemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/venn.js"></script>
<script src="libs/highcharts-7.0.1/modules/gantt.js"></script>
<script src="libs/highcharts-7.0.1/modules/timeline.js"></script>
<script src="libs/highcharts-7.0.1/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-7.0.1/plugins/grouped-categories.js"></script>
<script src="libs/highcharts-7.0.1/plugins/motion.js"></script>
<script src="libs/highcharts-7.0.1/plugins/multicolor_series.js"></script>
<script src="libs/highcharts-7.0.1/custom/reset.js"></script>
<script src="libs/highcharts-7.0.1/custom/symbols-extra.js"></script>
<script src="libs/highcharts-7.0.1/custom/text-symbols.js"></script>
<script src="libs/highchart-binding-0.7.0/highchart.js"></script>
<script src="libs/plotly-binding-4.9.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.46.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.46.1/plotly-latest.min.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section"><i class="fa fa-check"></i>지은이 소개</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-1"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-2"><i class="fa fa-check"></i>이 책의 구성</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-3"><i class="fa fa-check"></i>이 책에서 다루지 않은 주제</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-4"><i class="fa fa-check"></i>도움이 될 만한 자료들</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-5"><i class="fa fa-check"></i>이 책의 지원 페이지</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#section-6"><i class="fa fa-check"></i>종목과 관련된 유의사항</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="section-7.html"><a href="section-7.html"><i class="fa fa-check"></i><b>1</b> 퀀트 투자의 심장: 데이터와 프로그래밍</a><ul>
<li class="chapter" data-level="1.1" data-path="section-7.html"><a href="section-7.html#section-8"><i class="fa fa-check"></i><b>1.1</b> 데이터 구하기</a></li>
<li class="chapter" data-level="1.2" data-path="section-7.html"><a href="section-7.html#section-9"><i class="fa fa-check"></i><b>1.2</b> 퀀트 투자와 프로그래밍</a></li>
<li class="chapter" data-level="1.3" data-path="section-7.html"><a href="section-7.html#r-"><i class="fa fa-check"></i><b>1.3</b> R 프로그램</a></li>
<li class="chapter" data-level="1.4" data-path="section-7.html"><a href="section-7.html#r--1"><i class="fa fa-check"></i><b>1.4</b> 퀀트 투자에 유용한 R 패키지</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-10.html"><a href="section-10.html"><i class="fa fa-check"></i><b>2</b> 크롤링을 위한 기본 지식</a><ul>
<li class="chapter" data-level="2.1" data-path="section-10.html"><a href="section-10.html#r-utf-8-"><i class="fa fa-check"></i><b>2.1</b> 인코딩의 이해와 R에서 UTF-8 설정하기</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-10.html"><a href="section-10.html#ascii"><i class="fa fa-check"></i><b>2.1.1</b> 인간과 컴퓨터 간 번역의 시작, ASCII</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-10.html"><a href="section-10.html#section-11"><i class="fa fa-check"></i><b>2.1.2</b> 한글 인코딩 방식의 종류</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-10.html"><a href="section-10.html#r-utf-8--1"><i class="fa fa-check"></i><b>2.1.3</b> R에서 UTF-8 설정하기</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-10.html"><a href="section-10.html#section-12"><i class="fa fa-check"></i><b>2.2</b> 웹의 동작 방식</a><ul>
<li class="chapter" data-level="2.2.1" data-path="section-10.html"><a href="section-10.html#http"><i class="fa fa-check"></i><b>2.2.1</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="section-10.html"><a href="section-10.html#html-css"><i class="fa fa-check"></i><b>2.3</b> HTML과 CSS</a><ul>
<li class="chapter" data-level="2.3.1" data-path="section-10.html"><a href="section-10.html#html--"><i class="fa fa-check"></i><b>2.3.1</b> HTML 기본 구조</a></li>
<li class="chapter" data-level="2.3.2" data-path="section-10.html"><a href="section-10.html#section-13"><i class="fa fa-check"></i><b>2.3.2</b> 태그와 속성</a></li>
<li class="chapter" data-level="2.3.3" data-path="section-10.html"><a href="section-10.html#h--p-"><i class="fa fa-check"></i><b>2.3.3</b> h 태그와 p 태그</a></li>
<li class="chapter" data-level="2.3.4" data-path="section-10.html"><a href="section-10.html#ul--ol-"><i class="fa fa-check"></i><b>2.3.4</b> 리스트를 나타내는 ul 태그와 ol 태그</a></li>
<li class="chapter" data-level="2.3.5" data-path="section-10.html"><a href="section-10.html#table-"><i class="fa fa-check"></i><b>2.3.5</b> table 태그</a></li>
<li class="chapter" data-level="2.3.6" data-path="section-10.html"><a href="section-10.html#a--src---"><i class="fa fa-check"></i><b>2.3.6</b> a 태그와 src 태그 및 속성</a></li>
<li class="chapter" data-level="2.3.7" data-path="section-10.html"><a href="section-10.html#div-"><i class="fa fa-check"></i><b>2.3.7</b> div 태그</a></li>
<li class="chapter" data-level="2.3.8" data-path="section-10.html"><a href="section-10.html#css"><i class="fa fa-check"></i><b>2.3.8</b> CSS</a></li>
<li class="chapter" data-level="2.3.9" data-path="section-10.html"><a href="section-10.html#id"><i class="fa fa-check"></i><b>2.3.9</b> 클래스와 id</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="section-10.html"><a href="section-10.html#section-14"><i class="fa fa-check"></i><b>2.4</b> 파이프 오퍼레이터(<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="2.5" data-path="section-10.html"><a href="section-10.html#section-15"><i class="fa fa-check"></i><b>2.5</b> 오류에 대한 예외처리</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="api-.html"><a href="api-.html"><i class="fa fa-check"></i><b>3</b> API를 이용한 데이터 수집</a><ul>
<li class="chapter" data-level="3.1" data-path="api-.html"><a href="api-.html#api--quandl--"><i class="fa fa-check"></i><b>3.1</b> API를 이용한 Quandl 데이터 다운로드</a></li>
<li class="chapter" data-level="3.2" data-path="api-.html"><a href="api-.html#getsymbols---api-"><i class="fa fa-check"></i><b>3.2</b> <code>getSymbols()</code> 함수를 이용한 API 다운로드</a><ul>
<li class="chapter" data-level="3.2.1" data-path="api-.html"><a href="api-.html#section-16"><i class="fa fa-check"></i><b>3.2.1</b> 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.2" data-path="api-.html"><a href="api-.html#section-17"><i class="fa fa-check"></i><b>3.2.2</b> 국내 종목 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.3" data-path="api-.html"><a href="api-.html#fred--"><i class="fa fa-check"></i><b>3.2.3</b> FRED 데이터 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-18.html"><a href="section-18.html"><i class="fa fa-check"></i><b>4</b> 크롤링 이해하기</a><ul>
<li class="chapter" data-level="4.1" data-path="section-18.html"><a href="section-18.html#get-post--"><i class="fa fa-check"></i><b>4.1</b> GET과 POST 방식 이해하기</a><ul>
<li class="chapter" data-level="4.1.1" data-path="section-18.html"><a href="section-18.html#get-"><i class="fa fa-check"></i><b>4.1.1</b> GET 방식</a></li>
<li class="chapter" data-level="4.1.2" data-path="section-18.html"><a href="section-18.html#post-"><i class="fa fa-check"></i><b>4.1.2</b> POST 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="section-18.html"><a href="section-18.html#section-19"><i class="fa fa-check"></i><b>4.2</b> 크롤링 예제</a><ul>
<li class="chapter" data-level="4.2.1" data-path="section-18.html"><a href="section-18.html#section-20"><i class="fa fa-check"></i><b>4.2.1</b> 금융 속보 크롤링</a></li>
<li class="chapter" data-level="4.2.2" data-path="section-18.html"><a href="section-18.html#section-21"><i class="fa fa-check"></i><b>4.2.2</b> 기업공시채널에서 오늘의 공시 불러오기</a></li>
<li class="chapter" data-level="4.2.3" data-path="section-18.html"><a href="section-18.html#section-22"><i class="fa fa-check"></i><b>4.2.3</b> 네이버 금융에서 주식티커 크롤링</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-23.html"><a href="section-23.html"><i class="fa fa-check"></i><b>5</b> 금융 데이터 수집하기 (기본)</a><ul>
<li class="chapter" data-level="5.1" data-path="section-23.html"><a href="section-23.html#section-24"><i class="fa fa-check"></i><b>5.1</b> 한국거래소의 산업별 현황 및 개별지표 크롤링</a><ul>
<li class="chapter" data-level="5.1.1" data-path="section-23.html"><a href="section-23.html#section-25"><i class="fa fa-check"></i><b>5.1.1</b> 산업별 현황 크롤링</a></li>
<li class="chapter" data-level="5.1.2" data-path="section-23.html"><a href="section-23.html#section-26"><i class="fa fa-check"></i><b>5.1.2</b> 개별종목 지표 크롤링</a></li>
<li class="chapter" data-level="5.1.3" data-path="section-23.html"><a href="section-23.html#section-27"><i class="fa fa-check"></i><b>5.1.3</b> 최근 영업일 기준 데이터 받기</a></li>
<li class="chapter" data-level="5.1.4" data-path="section-23.html"><a href="section-23.html#section-28"><i class="fa fa-check"></i><b>5.1.4</b> 거래소 데이터 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="section-23.html"><a href="section-23.html#wics---"><i class="fa fa-check"></i><b>5.2</b> WICS 기준 섹터정보 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-29.html"><a href="section-29.html"><i class="fa fa-check"></i><b>6</b> 금융 데이터 수집하기 (심화)</a><ul>
<li class="chapter" data-level="6.1" data-path="section-29.html"><a href="section-29.html#section-30"><i class="fa fa-check"></i><b>6.1</b> 수정주가 크롤링</a><ul>
<li class="chapter" data-level="6.1.1" data-path="section-29.html"><a href="section-29.html#section-31"><i class="fa fa-check"></i><b>6.1.1</b> 개별종목 주가 크롤링</a></li>
<li class="chapter" data-level="6.1.2" data-path="section-29.html"><a href="section-29.html#section-32"><i class="fa fa-check"></i><b>6.1.2</b> 전 종목 주가 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-29.html"><a href="section-29.html#section-33"><i class="fa fa-check"></i><b>6.2</b> 재무제표 및 가치지표 크롤링</a><ul>
<li class="chapter" data-level="6.2.1" data-path="section-29.html"><a href="section-29.html#section-34"><i class="fa fa-check"></i><b>6.2.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.2.2" data-path="section-29.html"><a href="section-29.html#section-35"><i class="fa fa-check"></i><b>6.2.2</b> 가치지표 계산하기</a></li>
<li class="chapter" data-level="6.2.3" data-path="section-29.html"><a href="section-29.html#section-36"><i class="fa fa-check"></i><b>6.2.3</b> 전 종목 재무제표 및 가치지표 다운로드</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="section-29.html"><a href="section-29.html#dart--"><i class="fa fa-check"></i><b>6.3</b> DART 데이터 수집하기</a><ul>
<li class="chapter" data-level="6.3.1" data-path="section-29.html"><a href="section-29.html#section-37"><i class="fa fa-check"></i><b>6.3.1</b> 인증키 발급받기</a></li>
<li class="chapter" data-level="6.3.2" data-path="section-29.html"><a href="section-29.html#section-38"><i class="fa fa-check"></i><b>6.3.2</b> 오늘의 공시 확인하기</a></li>
<li class="chapter" data-level="6.3.3" data-path="section-29.html"><a href="section-29.html#section-40"><i class="fa fa-check"></i><b>6.3.3</b> 사업보고서의 재무제표 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-42.html"><a href="section-42.html"><i class="fa fa-check"></i><b>7</b> 데이터 정리하기</a><ul>
<li class="chapter" data-level="7.1" data-path="section-42.html"><a href="section-42.html#section-43"><i class="fa fa-check"></i><b>7.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="7.2" data-path="section-42.html"><a href="section-42.html#section-44"><i class="fa fa-check"></i><b>7.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="7.3" data-path="section-42.html"><a href="section-42.html#section-45"><i class="fa fa-check"></i><b>7.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-46.html"><a href="section-46.html"><i class="fa fa-check"></i><b>8</b> 데이터 분석 및 시각화하기</a><ul>
<li class="chapter" data-level="8.1" data-path="section-46.html"><a href="section-46.html#section-47"><i class="fa fa-check"></i><b>8.1</b> 종목정보 데이터 분석</a><ul>
<li class="chapter" data-level="8.1.1" data-path="section-46.html"><a href="section-46.html#join--"><i class="fa fa-check"></i><b>8.1.1</b> <code>*_join</code>: 데이터 합치기</a></li>
<li class="chapter" data-level="8.1.2" data-path="section-46.html"><a href="section-46.html#glimpse---"><i class="fa fa-check"></i><b>8.1.2</b> <code>glimpse()</code>: 데이터 구조 확인하기</a></li>
<li class="chapter" data-level="8.1.3" data-path="section-46.html"><a href="section-46.html#rename---"><i class="fa fa-check"></i><b>8.1.3</b> <code>rename()</code>: 열 이름 바꾸기</a></li>
<li class="chapter" data-level="8.1.4" data-path="section-46.html"><a href="section-46.html#distinct---"><i class="fa fa-check"></i><b>8.1.4</b> distinct(): 고유한 값 확인</a></li>
<li class="chapter" data-level="8.1.5" data-path="section-46.html"><a href="section-46.html#select---"><i class="fa fa-check"></i><b>8.1.5</b> <code>select()</code>: 원하는 열만 선택</a></li>
<li class="chapter" data-level="8.1.6" data-path="section-46.html"><a href="section-46.html#mutate-----"><i class="fa fa-check"></i><b>8.1.6</b> <code>mutate()</code>: 열 생성 및 데이터 변형</a></li>
<li class="chapter" data-level="8.1.7" data-path="section-46.html"><a href="section-46.html#filter----"><i class="fa fa-check"></i><b>8.1.7</b> <code>filter()</code>: 조건을 충족하는 행 선택</a></li>
<li class="chapter" data-level="8.1.8" data-path="section-46.html"><a href="section-46.html#summarize---"><i class="fa fa-check"></i><b>8.1.8</b> <code>summarize()</code>: 요약 통곗값 계산</a></li>
<li class="chapter" data-level="8.1.9" data-path="section-46.html"><a href="section-46.html#arrange--"><i class="fa fa-check"></i><b>8.1.9</b> <code>arrange()</code>: 데이터 정렬</a></li>
<li class="chapter" data-level="8.1.10" data-path="section-46.html"><a href="section-46.html#row_number--"><i class="fa fa-check"></i><b>8.1.10</b> <code>row_number()</code>: 순위 계산</a></li>
<li class="chapter" data-level="8.1.11" data-path="section-46.html"><a href="section-46.html#ntile--"><i class="fa fa-check"></i><b>8.1.11</b> <code>ntile()</code>: 분위수 계산</a></li>
<li class="chapter" data-level="8.1.12" data-path="section-46.html"><a href="section-46.html#group_by---"><i class="fa fa-check"></i><b>8.1.12</b> <code>group_by()</code>: 그룹별로 데이터를 묶기</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="section-46.html"><a href="section-46.html#section-48"><i class="fa fa-check"></i><b>8.2</b> 종목정보 시각화</a><ul>
<li class="chapter" data-level="8.2.1" data-path="section-46.html"><a href="section-46.html#geom_point--"><i class="fa fa-check"></i><b>8.2.1</b> <code>geom_point()</code>: 산점도 나타내기</a></li>
<li class="chapter" data-level="8.2.2" data-path="section-46.html"><a href="section-46.html#geom_histogram--"><i class="fa fa-check"></i><b>8.2.2</b> <code>geom_histogram()</code>: 히스토그램 나타내기</a></li>
<li class="chapter" data-level="8.2.3" data-path="section-46.html"><a href="section-46.html#geom_boxplot---"><i class="fa fa-check"></i><b>8.2.3</b> <code>geom_boxplot()</code>: 박스 플롯 나타내기</a></li>
<li class="chapter" data-level="8.2.4" data-path="section-46.html"><a href="section-46.html#dplyr-ggplot--"><i class="fa fa-check"></i><b>8.2.4</b> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</a></li>
<li class="chapter" data-level="8.2.5" data-path="section-46.html"><a href="section-46.html#geom_bar---"><i class="fa fa-check"></i><b>8.2.5</b> <code>geom_bar()</code>: 막대 그래프 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="section-46.html"><a href="section-46.html#section-49"><i class="fa fa-check"></i><b>8.3</b> 주가 및 수익률 시각화</a><ul>
<li class="chapter" data-level="8.3.1" data-path="section-46.html"><a href="section-46.html#section-50"><i class="fa fa-check"></i><b>8.3.1</b> 주가 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.2" data-path="section-46.html"><a href="section-46.html#section-51"><i class="fa fa-check"></i><b>8.3.2</b> 인터랙티브 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.3" data-path="section-46.html"><a href="section-46.html#section-52"><i class="fa fa-check"></i><b>8.3.3</b> 연도별 수익률 나타내기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-53.html"><a href="section-53.html"><i class="fa fa-check"></i><b>9</b> 퀀트 전략을 이용한 종목선정 (기본)</a><ul>
<li class="chapter" data-level="9.1" data-path="section-53.html"><a href="section-53.html#section-54"><i class="fa fa-check"></i><b>9.1</b> 베타 이해하기</a><ul>
<li class="chapter" data-level="9.1.1" data-path="section-53.html"><a href="section-53.html#section-55"><i class="fa fa-check"></i><b>9.1.1</b> 베타 계산하기</a></li>
<li class="chapter" data-level="9.1.2" data-path="section-53.html"><a href="section-53.html#section-56"><i class="fa fa-check"></i><b>9.1.2</b> 베타 시각화</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="section-53.html"><a href="section-53.html#section-57"><i class="fa fa-check"></i><b>9.2</b> 저변동성 전략</a><ul>
<li class="chapter" data-level="9.2.1" data-path="section-53.html"><a href="section-53.html#section-58"><i class="fa fa-check"></i><b>9.2.1</b> 저변동성 포트폴리오 구하기: 일간 기준</a></li>
<li class="chapter" data-level="9.2.2" data-path="section-53.html"><a href="section-53.html#section-59"><i class="fa fa-check"></i><b>9.2.2</b> 저변동성 포트폴리오 구하기: 주간 기준</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="section-53.html"><a href="section-53.html#section-60"><i class="fa fa-check"></i><b>9.3</b> 모멘텀 전략</a><ul>
<li class="chapter" data-level="9.3.1" data-path="section-53.html"><a href="section-53.html#section-61"><i class="fa fa-check"></i><b>9.3.1</b> 모멘텀 포트폴리오 구하기: 12개월 모멘텀</a></li>
<li class="chapter" data-level="9.3.2" data-path="section-53.html"><a href="section-53.html#section-62"><i class="fa fa-check"></i><b>9.3.2</b> 모멘텀 포트폴리오 구하기: 위험조정 수익률</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="section-53.html"><a href="section-53.html#section-63"><i class="fa fa-check"></i><b>9.4</b> 밸류 전략</a><ul>
<li class="chapter" data-level="9.4.1" data-path="section-53.html"><a href="section-53.html#pbr"><i class="fa fa-check"></i><b>9.4.1</b> 밸류 포트폴리오 구하기: 저PBR</a></li>
<li class="chapter" data-level="9.4.2" data-path="section-53.html"><a href="section-53.html#section-64"><i class="fa fa-check"></i><b>9.4.2</b> 각 지표 결합하기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="section-53.html"><a href="section-53.html#section-65"><i class="fa fa-check"></i><b>9.5</b> 퀄리티 전략</a><ul>
<li class="chapter" data-level="9.5.1" data-path="section-53.html"><a href="section-53.html#f-score"><i class="fa fa-check"></i><b>9.5.1</b> F-Score</a></li>
<li class="chapter" data-level="9.5.2" data-path="section-53.html"><a href="section-53.html#section-66"><i class="fa fa-check"></i><b>9.5.2</b> 각 지표를 결합하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-67.html"><a href="section-67.html"><i class="fa fa-check"></i><b>10</b> 퀀트 전략을 이용한 종목선정 (심화)</a><ul>
<li class="chapter" data-level="10.1" data-path="section-67.html"><a href="section-67.html#section-68"><i class="fa fa-check"></i><b>10.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="10.2" data-path="section-67.html"><a href="section-67.html#section-69"><i class="fa fa-check"></i><b>10.2</b> 마법공식</a><ul>
<li class="chapter" data-level="10.2.1" data-path="section-67.html"><a href="section-67.html#section-70"><i class="fa fa-check"></i><b>10.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="10.2.2" data-path="section-67.html"><a href="section-67.html#section-71"><i class="fa fa-check"></i><b>10.2.2</b> 마법공식 이해하기</a></li>
<li class="chapter" data-level="10.2.3" data-path="section-67.html"><a href="section-67.html#section-72"><i class="fa fa-check"></i><b>10.2.3</b> 마법공식 구성하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="section-67.html"><a href="section-67.html#section-73"><i class="fa fa-check"></i><b>10.3</b> 이상치 데이터 제거 및 팩터의 결합</a><ul>
<li class="chapter" data-level="10.3.1" data-path="section-67.html"><a href="section-67.html#trim---"><i class="fa fa-check"></i><b>10.3.1</b> 트림(Trim): 이상치 데이터 삭제</a></li>
<li class="chapter" data-level="10.3.2" data-path="section-67.html"><a href="section-67.html#winsorizing---"><i class="fa fa-check"></i><b>10.3.2</b> 윈저라이징(Winsorizing): 이상치 데이터 대체</a></li>
<li class="chapter" data-level="10.3.3" data-path="section-67.html"><a href="section-67.html#section-74"><i class="fa fa-check"></i><b>10.3.3</b> 팩터의 결합 방법</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="section-67.html"><a href="section-67.html#section-75"><i class="fa fa-check"></i><b>10.4</b> 멀티팩터 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-76.html"><a href="section-76.html"><i class="fa fa-check"></i><b>11</b> 포트폴리오 구성</a><ul>
<li class="chapter" data-level="11.1" data-path="section-76.html"><a href="section-76.html#section-77"><i class="fa fa-check"></i><b>11.1</b> 최소분산 포트폴리오</a><ul>
<li class="chapter" data-level="11.1.1" data-path="section-76.html"><a href="section-76.html#slsqp---"><i class="fa fa-check"></i><b>11.1.1</b> <code>slsqp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-76.html"><a href="section-76.html#solve.qp---"><i class="fa fa-check"></i><b>11.1.2</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-76.html"><a href="section-76.html#optimalportfolio---"><i class="fa fa-check"></i><b>11.1.3</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.4" data-path="section-76.html"><a href="section-76.html#section-78"><i class="fa fa-check"></i><b>11.1.4</b> 결괏값들의 비교</a></li>
<li class="chapter" data-level="11.1.5" data-path="section-76.html"><a href="section-76.html#section-79"><i class="fa fa-check"></i><b>11.1.5</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.1.6" data-path="section-76.html"><a href="section-76.html#section-80"><i class="fa fa-check"></i><b>11.1.6</b> 각 자산별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="section-76.html"><a href="section-76.html#section-81"><i class="fa fa-check"></i><b>11.2</b> 최대분산효과 포트폴리오</a><ul>
<li class="chapter" data-level="11.2.1" data-path="section-76.html"><a href="section-76.html#solve.qp----1"><i class="fa fa-check"></i><b>11.2.1</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.2" data-path="section-76.html"><a href="section-76.html#optimalportfolio----1"><i class="fa fa-check"></i><b>11.2.2</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.3" data-path="section-76.html"><a href="section-76.html#section-82"><i class="fa fa-check"></i><b>11.2.3</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.2.4" data-path="section-76.html"><a href="section-76.html#section-83"><i class="fa fa-check"></i><b>11.2.4</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="section-76.html"><a href="section-76.html#section-84"><i class="fa fa-check"></i><b>11.3</b> 위험균형 포트폴리오</a><ul>
<li class="chapter" data-level="11.3.1" data-path="section-76.html"><a href="section-76.html#section-85"><i class="fa fa-check"></i><b>11.3.1</b> 주식 60%와 채권 40% 포트폴리오의 위험기여도</a></li>
<li class="chapter" data-level="11.3.2" data-path="section-76.html"><a href="section-76.html#rp---"><i class="fa fa-check"></i><b>11.3.2</b> <code>rp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.3.3" data-path="section-76.html"><a href="section-76.html#section-86"><i class="fa fa-check"></i><b>11.3.3</b> 위험예산 포트폴리오</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-87.html"><a href="section-87.html"><i class="fa fa-check"></i><b>12</b> 포트폴리오 백테스트</a><ul>
<li class="chapter" data-level="12.1" data-path="section-87.html"><a href="section-87.html#return.portfolio-"><i class="fa fa-check"></i><b>12.1</b> <code>Return.Portfolio()</code> 함수</a><ul>
<li class="chapter" data-level="12.1.1" data-path="section-87.html"><a href="section-87.html#section-88"><i class="fa fa-check"></i><b>12.1.1</b> 인자 목록 살펴보기</a></li>
<li class="chapter" data-level="12.1.2" data-path="section-87.html"><a href="section-87.html#section-89"><i class="fa fa-check"></i><b>12.1.2</b> 출력값 살펴보기</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="section-87.html"><a href="section-87.html#section-90"><i class="fa fa-check"></i><b>12.2</b> 전통적인 60대 40 포트폴리오 백테스트</a></li>
<li class="chapter" data-level="12.3" data-path="section-87.html"><a href="section-87.html#section-91"><i class="fa fa-check"></i><b>12.3</b> 시점 선택 전략 백테스트</a></li>
<li class="chapter" data-level="12.4" data-path="section-87.html"><a href="section-87.html#section-92"><i class="fa fa-check"></i><b>12.4</b> 동적 자산배분 백테스트</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-93.html"><a href="section-93.html"><i class="fa fa-check"></i><b>13</b> 성과 및 위험 평가</a><ul>
<li class="chapter" data-level="13.1" data-path="section-93.html"><a href="section-93.html#section-94"><i class="fa fa-check"></i><b>13.1</b> 결과 측정 지표</a><ul>
<li class="chapter" data-level="13.1.1" data-path="section-93.html"><a href="section-93.html#section-95"><i class="fa fa-check"></i><b>13.1.1</b> 수익률 및 변동성</a></li>
<li class="chapter" data-level="13.1.2" data-path="section-93.html"><a href="section-93.html#section-96"><i class="fa fa-check"></i><b>13.1.2</b> 낙폭과 최대낙폭</a></li>
<li class="chapter" data-level="13.1.3" data-path="section-93.html"><a href="section-93.html#section-97"><i class="fa fa-check"></i><b>13.1.3</b> 연도별 수익률</a></li>
<li class="chapter" data-level="13.1.4" data-path="section-93.html"><a href="section-93.html#section-98"><i class="fa fa-check"></i><b>13.1.4</b> 승률 및 롤링 윈도우 값</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="section-93.html"><a href="section-93.html#section-99"><i class="fa fa-check"></i><b>13.2</b> 팩터 회귀분석 및 테이블로 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://henryquant.blogspot.com/" target="blank">Henry's Quantopia</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-18" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> 크롤링 이해하기</h1>
<p>API를 이용하면 데이터를 매우 쉽게 수집할 수 있지만, 국내 주식 데이터를 다운로드 하기에는 한계가 있으며, 원하는 데이터가 API의 형태로 제공된다는 보장도 없습니다. 따라서 우리는 필요한 데이터를 얻기 위해 직접 찾아 나서야 합니다.</p>
<p>각종 금융 웹사이트에는 주가, 재무정보 등 우리가 원하는 대부분의 주식 정보가 제공되고 있으며, API를 활용할 수 없는 경우에도 크롤링을 통해 이러한 데이터를 수집할 수 있습니다. 크롤링 혹은 스크래핑이란 웹사이트에서 원하는 정보를 수집하는 기술입니다. 대부분의 금융 웹사이트는 간단한 형태로 작성되어 있어, 몇 가지 기술만 익히면 어렵지 않게 데이터를 크롤링할 수 있습니다. 이 CHAPTER에서는 크롤링에 대한 간단한 설명과 예제를 살펴보겠습니다.</p>
<p>크롤링을 할 때 주의해야 할 점이 있습니다. 특정 웹사이트의 페이지를 쉬지 않고 크롤링하는 행위를 무한 크롤링이라고 합니다. 무한 크롤링은 해당 웹사이트의 자원을 독점하게 되어 타인의 사용을 막게 되며 웹사이트에 부하를 주게 됩니다. 일부 웹사이트에서는 동일한 IP로 쉬지 않고 크롤링을 할 경우 접속을 막아버리는 경우도 있습니다. 따라서 하나의 페이지를 크롤링한 후 1~2초 가량 정지하고 다시 다음 페이지를 크롤링하는 것이 좋습니다.</p>
<div id="get-post--" class="section level2">
<h2><span class="header-section-number">4.1</span> GET과 POST 방식 이해하기</h2>
<p>우리가 인터넷에 접속해 서버에 파일을 요청하면, 서버는 이에 해당하는 파일을 우리에게 보내줍니다. 크롬과 같은 웹 브라우저는 이러한 과정을 사람이 수행하기 편하고 시각적으로 보기 편하도록 만들어진 것이며, 인터넷 주소는 서버의 주소를 기억하기 쉽게 만든 것입니다. 우리가 서버에 데이터를 요청하는 형태는 다양하지만 크롤링에서는 주로 GET과 POST 방식을 사용합니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="images/crawl_flow.png" alt="클라이언트와 서버 간의 요청/응답 과정" width="70%" />
<p class="caption">
그림 1.3: 클라이언트와 서버 간의 요청/응답 과정
</p>
</div>
<div id="get-" class="section level3">
<h3><span class="header-section-number">4.1.1</span> GET 방식</h3>
<p>GET 방식은 인터넷 주소를 기준으로 이에 해당하는 데이터나 파일을 요청하는 것입니다. 주로 클라이언트가 요청하는 쿼리를 앰퍼샌드(&amp;) 혹은 물음표(?) 형식으로 결합해 서버에 전달합니다.</p>
<p>한경컨센서스<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>에 접속한 후 상단 탭에서 [기업] 탭을 선택하면, 주소 끝부분에
?skinType=business가 추가되며 이에 해당하는 페이지의 내용을 보여줍니다. 즉, 해당 페이지는 GET 방식을 사용하고 있으며 입력 종류는 skinType, 이에 해당하는 [기업] 탭의 입력값은 business임을 알 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-3"></span>
<img src="images/crawl_hk.png" alt="한경 컨센서스 기업 REPORT 페이지" width="100%" />
<p class="caption">
그림 2.1: 한경 컨센서스 기업 REPORT 페이지
</p>
</div>
<p>이번에는 [파생] 탭을 선택해봅니다. 역시나 웹사이트 주소 끝부분이 ?skinType=derivative로 변경되며, 해당 주소에 맞는 내용이 나타납니다. 여러 다른 탭들을 클릭해보면 ?skinType= 뒷부분의 입력값이 변함에 따라 이에 해당하는 페이지로 내용
이 변경되는 것을 알 수 있습니다.</p>
<p>다시 [기업] 탭을 선택한 후 다음 페이지를 확인하기 위해 하단의 [2]를 클릭합니다. 기존 주소인 ?skinType=business 뒤에 추가로 sdate와 edate, now_page 쿼리가 추가됩니다. sdate는 검색 기간의 시작시점, edate는 검색 기간의 종료시점, now_
page는 현재 페이지를 의미하며, 원하는 데이터를 수기로 입력해도 이에 해당하는 페이지의 데이터를 보여줍니다. 이처럼 GET 방식으로 데이터를 요청하면 웹페이지 주소를 수정해 원하는 종류의 데이터를 받아올 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-4"></span>
<img src="images/crawl_hk2.png" alt="쿼리 추가로 인한 url의 변경" width="100%" />
<p class="caption">
그림 2.4: 쿼리 추가로 인한 url의 변경
</p>
</div>
</div>
<div id="post-" class="section level3">
<h3><span class="header-section-number">4.1.2</span> POST 방식</h3>
<p>POST 방식은 사용자가 필요한 값을 추가해서 요청하는 방법입니다. GET 방식과 달리 클라이언트가 요청하는 쿼리를 body에 넣어서 전송하므로 요청 내역을 직접 볼 수 없습니다.</p>
<p>한국거래소 상장공시시스템<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>에 접속해 [전체메뉴보기]를 클릭하고 [상장법인상세정보] 중
[상장종목현황]을 선택합니다. 웹페이지 주소가 바뀌며, 상장종목현황이 나타납니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-5"></span>
<img src="images/crawl_corp_list.png" alt="상장공시시스템의 상장종목현황 메뉴" width="70%" />
<p class="caption">
그림 4.1: 상장공시시스템의 상장종목현황 메뉴
</p>
</div>
<p>이번엔 조회일자를 [2017-12-28]로 선택한 후 [검색]을 클릭합니다. 페이지의 내용은 선택일 기준으로 변경되었지만, 주소는 변경되지 않고 그대로 남아 있습니다. GET 방식에서는 선택 항목에 따라 웹페이지 주소가 변경되었지만, POST 방식을 사용해 서버에 데이터를 요청하는 해당 웹사이트는 그렇지 않은 것을 알 수 있습니다.</p>
<p>POST 방식의 데이터 요청 과정을 살펴보려면 개발자 도구를 이용해야 하며, 크롬에서는 [F12]키를 눌러 개발자 도구 화면을 열 수 있습니다. 개발자 도구 화면에서 다시 한번 [검색]을 클릭해봅니다. [Network] 탭을 클릭하면, [검색]을 클릭함과 동시에 브라우저와 서버 간의 통신 과정을 살펴볼 수 있습니다. 이 중 listedIssueStatus.do라는 항목이 POST 형태임을 알 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-6"></span>
<img src="images/crawl_corp_list_2.png" alt="크롬 개발자도구의 Network 화면" width="100%" />
<p class="caption">
그림 4.2: 크롬 개발자도구의 Network 화면
</p>
</div>
<p>해당 메뉴를 클릭하면 통신 과정을 좀 더 자세히 알 수 있습니다. 가장 하단의 Form Data에는 서버에 데이터를 요청하는 내역이 있습니다. method에는 readListIssueStatus, selDate에는 2017-12-28이라는 값이 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-7"></span>
<img src="images/crawl_corp_list_3.png" alt="POST 방식의 서버 요청 내역" width="70%" />
<p class="caption">
그림 2.5: POST 방식의 서버 요청 내역
</p>
</div>
<p>이처럼 POST 방식은 요청하는 데이터에 대한 쿼리가 GET 방식처럼 URL을 통해 전송되는 것이 아닌 body를 통해 전송되므로, 이에 대한 정보는 웹 브라우저를 통해 확인할 수 없습니다.</p>
</div>
</div>
<div id="section-19" class="section level2">
<h2><span class="header-section-number">4.2</span> 크롤링 예제</h2>
<p>일반적인 크롤링은 httr 패키지의 <code>GET()</code> 혹은 <code>POST()</code> 함수를 이용해 데이터를 다운로드한 후 rvest 패키지의 함수들을 이용해 원하는 데이터를 찾는 과정으로 이루어집니다. 이 CHAPTER에서는 GET 방식으로 금융 실시간 속보의 제목을 추출하는 예제, POST 방식으로 기업공시채널에서 오늘의 공시를 추출하는 예제, 태그와 속성, 페이지 내비게이션 값을 결합해 국내 상장주식의 종목명 및 티커를 추출하는 예제를 학습해 보겠습니다.</p>
<div id="section-20" class="section level3">
<h3><span class="header-section-number">4.2.1</span> 금융 속보 크롤링</h3>
<p>크롤링의 간단한 예제로 금융 속보의 제목을 추출해보겠습니다. 먼저 네이버 금융에
접속한 후 [뉴스 → 실시간 속보]<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>를 선택합니다. 이 중 뉴스의 제목에 해당하는 텍스트만 추출하고자 합니다.</p>
<p>뉴스 제목 부분에 마우스 커서를 올려둔 후 마우스 오른쪽 버튼을 클릭하고 [검사]를 선택하면 개발자 도구 화면이 나타납니다. 여기서 해당 글자가 HTML 내에서 어떤 부분에 위치하는지 확인할 수 있습니다. 해당 제목은 dl 태그 → dd 태그의 articleSubject 클래스 → a 태그 중 title 속성에 위치하고 있습니다. 태그와 속성의 차이가 이해되지 않은 분은 CHAPTER 2를 다시 살펴보기 바랍니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-8"></span>
<img src="images/crawl_naver_news.png" alt="실시간 속보의 제목 부분 html" width="100%" />
<p class="caption">
그림 2.6: 실시간 속보의 제목 부분 html
</p>
</div>
<p>먼저 해당 페이지의 내용을 R로 불러옵니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rvest)
<span class="kw">library</span>(httr)

url =<span class="st"> &#39;https://finance.naver.com/news/news_list.nhn?mode=LSS2D&amp;section_id=101&amp;section_id2=258&#39;</span>
data =<span class="st"> </span><span class="kw">GET</span>(url)

<span class="kw">print</span>(data)</code></pre>
<p>먼저 url 변수에 해당 주소를 입력한 후 GET() 함수를 이용해 해당 페이지의 내용을 받아 data 변수에 저장합니다. data 변수를 확인해보면 Status가 200, 즉 데이터가 이상 없이 받아졌으며, 인코딩(charset)은 EUC-KR 타입으로 되어 있습니다.</p>
<p>우리는 개발자 도구 화면을 통해 제목에 해당하는 부분이 dl 태그 → dd 태그의 articleSubject 클래스 → a 태그 중 title 속성에 위치하고 있음을 살펴보았습니다. 이를 활용해 제목 부분만을 추출하는 방법은 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_title =<span class="st"> </span>data <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">read_html</span>(<span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;dl&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;.articleSubject&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;a&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&#39;title&#39;</span>)</code></pre>
<ol style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 이용해 해당 페이지의 HTML 내용을 읽어오며, 인코딩은 EUC-KR로 설정합니다.</li>
<li><code>html_nodes()</code> 함수는 해당 태그를 추출하는 함수이며 dl 태그에 해당하는 부분을 추출합니다.</li>
<li><code>html_nodes()</code> 함수를 이용해 articleSubject 클래스에 해당하는 부분을 추출할 수 있으며, 클래스 속성의 경우 이름 앞에 마침표(.)를 붙여주어야 합니다.</li>
<li><code>html_nodes()</code> 함수를 이용해 a 태그를 추출합니다.</li>
<li><code>html_attr()</code> 함수는 속성을 추출하는 함수이며 title에 해당하는 부분만을 추출합니다.</li>
</ol>
<p>위 과정을 거쳐 data_title에는 실시간 속보의 제목만이 저장됩니다. 이처럼 개발자 도구 화면을 통해 내가 추출하고자 하는 데이터가 HTML 중 어디에 위치하고 있는지 먼저 확인하면 어렵지 않게 해당 데이터를 읽어올 수 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(data_title)</code></pre>
<pre><code>##  [1] &quot;`저배당 블랙리스트 기업`서 국민연금&quot; 
##  [2] &quot;국민연금, 남양유업 &#39;공개중점관리기업&quot;
##  [3] &quot;[MBN Y 포럼 2020] \&quot;내 삶&quot;           
##  [4] &quot;&#39;경영권 분쟁&#39; 두 아들이 조문객 맞&quot;   
##  [5] &quot;中코로나 바이러스 폐렴 확산에 백신·&quot;
##  [6] &quot;국민연금, 남양유업 공개 중점관리기업&quot;
##  [7] &quot;하나금투 3월 5000억 증자…초대형&quot;    
##  [8] &quot;VI금융그룹 출범…&#39;내손안의 글로벌 &quot;  
##  [9] &quot;[시그널] 홍콩 VIAMC·韓 뱅커스&quot;      
## [10] &quot;주식거래계좌 작년 10년만에 최대 늘&quot;  
## [11] &quot;코스피200 기업중 34곳 회계 내부&quot;     
## [12] &quot;홍콩 VIAMC-한국 뱅커스트릿 컨소&quot;     
## [13] &quot;20일 장 마감 후 주요 종목뉴스&quot;       
## [14] &quot;[표]아시아 주요 증시 동향(1월 2&quot;     
## [15] &quot;전수조사에도… 제2 라임사태 재현 우&quot; 
## [16] &quot;2020 신학기 준비물, 학습 습관 &quot;      
## [17] &quot;[시그널] 남양유업, &#39;짠물배당&#39; 오&quot;    
## [18] &quot;[채권마감]연내 금리 동결 경계감 지&quot;  
## [19] &quot;[fn마켓워치]국민연금, 남양유업 공&quot;   
## [20] &quot;[fn마켓워치]홍콩 VIAMC-韓 뱅&quot;</code></pre>
</div>
<div id="section-21" class="section level3">
<h3><span class="header-section-number">4.2.2</span> 기업공시채널에서 오늘의 공시 불러오기</h3>
<p>한국거래소 상장공시시스템에 접속한 후 [오늘의 공시 → 전체 → 더보기]를 선택해 전체 공시내용을 확인할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-13"></span>
<img src="images/crawl_kind.png" alt="오늘의공시 확인하기" width="70%" />
<p class="caption">
그림 4.3: 오늘의공시 확인하기
</p>
</div>
<p>해당 페이지에서 날짜를 변경하면 페이지의 내용은 해당일의 공시로 변경되지만 URL은 변경되지 않습니다. 이처럼 POST 방식은 요청하는 데이터에 대한 쿼리가 body의 형태를 통해 전송되므로, 개발자 도구 화면을 통해 해당 쿼리에 대한 내용을 확인해야 합니다.</p>
<p>개발자 도구 화면을 연 상태에서 조회일자를 [2018-12-28]로 선택한 후 [검색]을 클릭하고 [Network] 탭의 todaydisclosure.do 항목을 살펴보면 Form Data를 통해 서버에 데이터를 요청하는 내역을 확인할 수 있습니다. 여러 항목 중 selDate 부분이 우리가 선택한 일자로 설정되어 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-14"></span>
<img src="images/crawl_kind_post.png" alt="POST 방식의 데이터 요청" width="100%" />
<p class="caption">
그림 2.9: POST 방식의 데이터 요청
</p>
</div>
<p>POST 방식으로 쿼리를 요청하는 방법을 코드로 나타내면 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(httr)
<span class="kw">library</span>(rvest)

<span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)

url =<span class="st"> &#39;http://kind.krx.co.kr/disclosure/todaydisclosure.do&#39;</span>
data =<span class="st"> </span><span class="kw">POST</span>(url, <span class="dt">body =</span> 
              <span class="kw">list</span>(
                <span class="dt">method =</span> <span class="st">&#39;searchTodayDisclosureSub&#39;</span>,
                <span class="dt">currentPageSize =</span> <span class="st">&#39;15&#39;</span>,
                <span class="dt">pageIndex =</span> <span class="st">&#39;1&#39;</span>,
                <span class="dt">orderMode =</span> <span class="st">&#39;0&#39;</span>,
                <span class="dt">orderStat =</span> <span class="st">&#39;D&#39;</span>,
                <span class="dt">forward =</span> <span class="st">&#39;todaydisclosure_sub&#39;</span>,
                <span class="dt">chose =</span> <span class="st">&#39;S&#39;</span>,
                <span class="dt">todayFlag =</span> <span class="st">&#39;Y&#39;</span>,
                <span class="dt">selDate =</span> <span class="st">&#39;2018-12-28&#39;</span>
                ))

data =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="dv">1</span>]]

<span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</code></pre>
<ol style="list-style-type: decimal">
<li>한글(korean)로 작성된 페이지를 크롤링하면 오류가 발생하는 경우가 종종 있으므로 <code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 영어(English)로 설정합니다.</li>
<li><code>POST()</code> 함수를 통해 해당 url에 원하는 쿼리를 요청하며, 쿼리는 body 내에 리스트 형태로 입력해줍니다. 해당 값은 개발자 도구 화면의 Form Data와 동일하게 입력해주며, marketType과 같이 값이 없는 항목은 입력하지 않아도 됩니다.</li>
<li><code>read_html()</code> 함수를 이용해 해당 페이지의 HTML 내용을 읽어옵니다.</li>
<li><code>html_table()</code> 함수는 테이블 형태의 데이터를 읽어오는 함수입니다. 셀 병합이
된 열이 있으므로 <code>fill=TRUE</code>를 추가합니다.</li>
<li>.[[1]]를 통해 첫 번째 리스트를 선택합니다.</li>
<li>한글을 읽기 위해 <code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 다시 Korean으로 변경합니다.</li>
</ol>
<p>저장된 데이터를 확인하면 화면과 동일한 내용이 출력됩니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">head</span>(data))</code></pre>
<pre><code>##      NA           NA                                          NA
## 1 18:32     화신테크                                최대주주변경
## 2 18:26 에스제이케이 증권 발행결과(자율공시)(제3자배정 유상증자)
## 3 18:11     아이엠텍               [정정]유상증자결정(제3자배정)
## 4 18:10 시그넷이브이                          유형자산 양수 결정
## 5 18:09                         자기주식매매신청내역(코스닥시장)
## 6 18:09                                 대량매매내역(코스닥시장)
##               NA                             NA
## 1       화신테크 공시차트\r\n\t\t\t\t\t주가차트
## 2   에스제이케이 공시차트\r\n\t\t\t\t\t주가차트
## 3       아이엠텍 공시차트\r\n\t\t\t\t\t주가차트
## 4   시그넷이브이 공시차트\r\n\t\t\t\t\t주가차트
## 5 코스닥시장본부                               
## 6 코스닥시장본부</code></pre>
<p>POST 형식의 경우 body에 들어가는 쿼리 내용을 바꾸어 원하는 데이터를 받을 수 있습니다. 만일 2019년 1월 8일 공시를 확인하고자 한다면 위의 코드에서 selDate만 2019-01-08로 변경해주면 됩니다. 아래 코드의 출력 결과물을 2019년 1월 8일 공시와 비교하면 동일한 결과임을 확인할 수 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)

url =<span class="st"> &#39;http://kind.krx.co.kr/disclosure/todaydisclosure.do&#39;</span>
data =<span class="st"> </span><span class="kw">POST</span>(url, <span class="dt">body =</span>
              <span class="kw">list</span>(
                <span class="dt">method =</span> <span class="st">&#39;searchTodayDisclosureSub&#39;</span>,
                <span class="dt">currentPageSize =</span> <span class="st">&#39;15&#39;</span>,
                <span class="dt">pageIndex =</span> <span class="st">&#39;1&#39;</span>,
                <span class="dt">orderMode =</span> <span class="st">&#39;0&#39;</span>,
                <span class="dt">orderStat =</span> <span class="st">&#39;D&#39;</span>,
                <span class="dt">forward =</span> <span class="st">&#39;todaydisclosure_sub&#39;</span>,
                <span class="dt">chose =</span> <span class="st">&#39;S&#39;</span>,
                <span class="dt">todayFlag =</span> <span class="st">&#39;Y&#39;</span>,
                <span class="dt">selDate =</span> <span class="st">&#39;2019-01-08&#39;</span>
                ))

data =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[[<span class="dv">1</span>]]

<span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">head</span>(data))</code></pre>
<pre><code>##      NA             NA
## 1 18:58   해덕파워웨이
## 2 18:57   해덕파워웨이
## 3 18:57           퓨전
## 4 18:56   해덕파워웨이
## 5 18:52 한국테크놀로지
## 6 18:52 한국테크놀로지
##                                                        NA             NA
## 1                                              소속부변경 코스닥시장본부
## 2 주권매매거래정지기간변경(상장적격성 실질심사 대상 결정) 코스닥시장본부
## 3                                            최대주주변경           퓨전
## 4            관리종목지정(상장적격성 실질심사 대상 결정 ) 코스닥시장본부
## 5                            전환사채권발행결정(제18회차) 한국테크놀로지
## 6                            전환사채권발행결정(제17회차) 한국테크놀로지
##                               NA
## 1 공시차트\r\n\t\t\t\t\t주가차트
## 2 공시차트\r\n\t\t\t\t\t주가차트
## 3 공시차트\r\n\t\t\t\t\t주가차트
## 4 공시차트\r\n\t\t\t\t\t주가차트
## 5 공시차트\r\n\t\t\t\t\t주가차트
## 6 공시차트\r\n\t\t\t\t\t주가차트</code></pre>
</div>
<div id="section-22" class="section level3">
<h3><span class="header-section-number">4.2.3</span> 네이버 금융에서 주식티커 크롤링</h3>
<p>태그와 속성, 페이지 내비게이션 값을 결합해 국내 상장주식의 종목명 및 티커를 추출하는 방법을 알아보겠습니다. 네이버 금융에서 [국내증시 → 시가총액] 페이지에는 코스피와 코스닥의 시가총액별 정보가 나타나 있습니다.</p>
<ul>
<li>코스피: <a href="https://finance.naver.com/sise/sise_market_sum.nhn?sosok=0&amp;page=1" class="uri">https://finance.naver.com/sise/sise_market_sum.nhn?sosok=0&amp;page=1</a></li>
<li>코스닥: <a href="https://finance.naver.com/sise/sise_market_sum.nhn?sosok=1&amp;page=1" class="uri">https://finance.naver.com/sise/sise_market_sum.nhn?sosok=1&amp;page=1</a></li>
</ul>
<p>또한 종목명을 클릭해 이동하는 페이지의 URL을 확인해보면, 끝 6자리가 각 종목의 거래소 티커임도 확인이 됩니다.</p>
<p>티커 정리를 위해 HTML에서 확인해야 할 부분은 총 두 가지입니다. 먼저 하단의 페이지 내비게이션을 통해 코스피와 코스닥 시가총액에 해당하는 페이지가 각각 몇 번째 페이지까지 있는지 알아야 합니다. 아래와 같은 항목 중 [맨뒤]에 해당하는 페이지가 가장 마지막 페이지입니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/crawl_page_navi.png" alt="페이지 네비게이션" width="70%" />
<p class="caption">
그림 4.4: 페이지 네비게이션
</p>
</div>
<p>[맨뒤]에 마우스 커서를 올려두고 마우스 오른쪽 버튼을 클릭한 후 [검사]를 선택하면 개발자 도구 화면이 열립니다. 여기서 해당 글자가 HTML 내에서 어떤 부분에 위치하는지 확인할 수 있습니다. 해당 링크는 pgRR 클래스 → a 태그 중 href 속성에 위치하며, page= 뒷부분의 숫자에 위치하는 페이지로 링크가 걸려 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-20"></span>
<img src="images/crawl_page_navi2.png" alt="HTML 내 페이지 네비게이션 부분" width="100%" />
<p class="caption">
그림 2.12: HTML 내 페이지 네비게이션 부분
</p>
</div>
<p>종목명 링크에 해당하는 주소 중 끝 6자리는 티커에 해당합니다. 따라서 각 링크들의 주소를 알아야 할 필요도 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-21"></span>
<img src="images/crawl_naver_corp.png" alt="네이버 금융 시가총액 페이지" width="100%" />
<p class="caption">
그림 4.5: 네이버 금융 시가총액 페이지
</p>
</div>
<p>삼성전자에 마우스 커서를 올려둔 후 마우스 오른쪽 버튼을 클릭하고 [검사]를 선택합니다. 개발자 도구 화면을 살펴보면 해당 링크가 tbody → td → a 태그의 href 속성에 위치하고 있음을 알 수 있습니다.</p>
<p>위 정보들을 이용해 데이터를 다운로드하겠습니다. 아래 코드에서 i = 0일 경우 코스피에 해당하는 URL이 생성되고, i = 1일 경우 코스닥에 해당하는 URL이 생성됩니다. 먼저 코스피에 해당하는 데이터를 다운로드하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(httr)
<span class="kw">library</span>(rvest)

i =<span class="st"> </span><span class="dv">0</span>
ticker =<span class="st"> </span><span class="kw">list</span>()
url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://finance.naver.com/sise/&#39;</span>,
             <span class="st">&#39;sise_market_sum.nhn?sosok=&#39;</span>,i,<span class="st">&#39;&amp;page=1&#39;</span>)
down_table =<span class="st"> </span><span class="kw">GET</span>(url)</code></pre>
<ol style="list-style-type: decimal">
<li>빈 리스트인 ticker 변수를 만들어줍니다.</li>
<li><code>paste0()</code> 함수를 이용해 코스피 시가총액 페이지의 url을 만듭니다.</li>
<li><code>GET()</code> 함수를 통해 해당 페이지 내용을 받아 down_table 변수에 저장합니다.</li>
</ol>
<p>가장 먼저 해야 할 작업은 마지막 페이지가 몇 번째 페이지인지 찾아내는 작업입니다. 우리는 이미 개발자 도구 화면을 통해 해당 정보가 pgRR 클래스의 a 태그 중 href 속성에 위치하고 있음을 알고 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">navi.final =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&#39;.pgRR&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&#39;a&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_attr</span>(., <span class="st">&#39;href&#39;</span>)</code></pre>
<ol style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 이용해 해당 페이지의 HTML 내용을 읽어오며, 인코딩은 EUC-KR로 설정합니다.</li>
<li><code>html_nodes()</code> 함수를 이용해 pgRR 클래스 정보만 불러오며, 클래스 속성이므로 앞에 마침표(.)를 붙입니다.</li>
<li><code>html_nodes()</code> 함수를 통해 a 태그 정보만 불러옵니다.</li>
<li><code>html_attr()</code> 함수를 통해 href 속성을 불러옵니다.</li>
</ol>
<p>이를 통해 navi.final에는 해당 부분에 해당하는 내용이 저장됩니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(navi.final)</code></pre>
<pre><code>## [1] &quot;/sise/sise_market_sum.nhn?sosok=0&amp;page=32&quot;</code></pre>
<p>이 중 우리가 알고 싶은 내용은 page= 뒤에 있는 숫자입니다. 해당 내용을 추출하는 코드는 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">navi.final =<span class="st"> </span>navi.final <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">strsplit</span>(., <span class="st">&#39;=&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">tail</span>(., <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">as.numeric</span>()</code></pre>
<ol style="list-style-type: decimal">
<li><code>strsplit()</code> 함수는 전체 문장을 특정 글자 기준으로 나눕니다. page= 뒷부분 의 데이터만 필요하므로 =를 기준으로 문장을 나눠줍니다.</li>
<li><code>unlist()</code> 함수를 통해 결과를 벡터 형태로 변환합니다.</li>
<li><code>tail()</code> 함수를 통해 뒤에서 첫 번째 데이터만 선택합니다.</li>
<li><code>as.numeric()</code> 함수를 통해 해당 값을 숫자 형태로 바꾸어줍니다.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(navi.final)</code></pre>
<pre><code>## [1] 32</code></pre>
<p>코스피 시가총액 페이지는 32번째 페이지까지 있으며, for loop 구문을 이용하면 1페이지부터 navi.final, 즉 32 페이지까지 모든 내용을 읽어올 수 있습니다. 먼저 코스피의 첫 번째 페이지에서 우리가 원하는 데이터를 추출하는 방법을 살펴보겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">i =<span class="st"> </span><span class="dv">0</span> <span class="co"># 코스피</span>
j =<span class="st"> </span><span class="dv">1</span> <span class="co"># 첫번째 페이지</span>
url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://finance.naver.com/sise/&#39;</span>,
             <span class="st">&#39;sise_market_sum.nhn?sosok=&#39;</span>,i,<span class="st">&quot;&amp;page=&quot;</span>,j)
down_table =<span class="st"> </span><span class="kw">GET</span>(url)</code></pre>
<ol style="list-style-type: decimal">
<li>i와 j에 각각 0과 1을 입력해 코스피 첫 번째 페이지에 해당하는 url을 생성합니다.</li>
<li><code>GET()</code> 함수를 이용해 해당 페이지의 데이터를 다운로드합니다.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)

table =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&quot;EUC-KR&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>)
table =<span class="st"> </span>table[[<span class="dv">2</span>]]

<span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</code></pre>
<ol style="list-style-type: decimal">
<li><code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 English로 설정합니다.</li>
<li><code>read_html()</code> 함수를 통해 HTML 정보를 읽어옵니다.</li>
<li><code>html_table()</code> 함수를 통해 테이블 정보를 읽어오며, fill=TRUE를 추가해줍니다.</li>
<li>table 변수에는 리스트 형태로 총 세 가지 테이블이 저장되어 있습니다. 첫 번째 리스트에는 거래량, 시가, 고가 등 적용 항목이 저장되어 있고 세 번째 리스트에는 페이지 내비게이션 테이블이 저장되어 있으므로, 우리에게 필요한 두 번째 리스트만을 table 변수에 다시 저장합니다.</li>
<li>한글을 읽기 위해 <code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 다시 Korean으로 변경합니다.</li>
</ol>
<p>저장된 테이블 내용을 확인하면 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">head</span>(table))</code></pre>
<pre><code>##    N           종목명  현재가 전일비 등락률 액면가  시가총액 상장주식수
## 1 NA                                                                   
## 2  1         삼성전자  62,400  1,100 +1.79%    100 3,725,144  5,969,783
## 3  2       SK하이닉스  99,900    900 +0.91%  5,000   727,274    728,002
## 4  3       삼성전자우  52,200  1,300 +2.55%    100   429,547    822,887
## 5  4            NAVER 187,500  3,500 -1.83%    100   309,025    164,813
## 6  5 삼성바이오로직스 438,000  1,000 +0.23%  2,500   289,803     66,165
##   외국인비율     거래량    PER   ROE 토론실
## 1         NA              &lt;NA&gt;  &lt;NA&gt;     NA
## 2      57.15 12,456,323  10.36 19.63     NA
## 3      50.59  1,777,524   4.68 38.53     NA
## 4      91.91  2,688,224   8.67   N/A     NA
## 5      58.63    387,623  47.63 12.97     NA
## 6      10.03     66,090 129.32  5.51     NA</code></pre>
<p>이 중 마지막 열인 토론실은 필요 없는 열이며, 첫 번째 행과 같이 아무런 정보가 없는 행도 있습니다. 이를 다음과 같이 정리해줍니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">table[, <span class="kw">ncol</span>(table)] =<span class="st"> </span><span class="ot">NULL</span>
table =<span class="st"> </span><span class="kw">na.omit</span>(table)
<span class="kw">print</span>(<span class="kw">head</span>(table))</code></pre>
<pre><code>##    N           종목명  현재가 전일비 등락률 액면가  시가총액 상장주식수
## 2  1         삼성전자  62,400  1,100 +1.79%    100 3,725,144  5,969,783
## 3  2       SK하이닉스  99,900    900 +0.91%  5,000   727,274    728,002
## 4  3       삼성전자우  52,200  1,300 +2.55%    100   429,547    822,887
## 5  4            NAVER 187,500  3,500 -1.83%    100   309,025    164,813
## 6  5 삼성바이오로직스 438,000  1,000 +0.23%  2,500   289,803     66,165
## 10 6           현대차 118,000    500 -0.42%  5,000   252,128    213,668
##    외국인비율     거래량    PER   ROE
## 2       57.15 12,456,323  10.36 19.63
## 3       50.59  1,777,524   4.68 38.53
## 4       91.91  2,688,224   8.67   N/A
## 5       58.63    387,623  47.63 12.97
## 6       10.03     66,090 129.32  5.51
## 10      39.66    445,234  22.05  2.20</code></pre>
<p>이제 필요한 정보는 6자리 티커입니다. 티커 역시 개발자 도구 화면을 통해 tbody → td → a 태그의 href 속성에 위치하고 있음을 알고 있습니다. 티커를 추출하는 코드는 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">symbol =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(., <span class="st">&#39;tbody&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(., <span class="st">&#39;td&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_nodes</span>(., <span class="st">&#39;a&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">html_attr</span>(., <span class="st">&#39;href&#39;</span>)

<span class="kw">print</span>(<span class="kw">head</span>(symbol, <span class="dv">10</span>))</code></pre>
<pre><code>##  [1] &quot;/item/main.nhn?code=005930&quot;  &quot;/item/board.nhn?code=005930&quot;
##  [3] &quot;/item/main.nhn?code=000660&quot;  &quot;/item/board.nhn?code=000660&quot;
##  [5] &quot;/item/main.nhn?code=005935&quot;  &quot;/item/board.nhn?code=005935&quot;
##  [7] &quot;/item/main.nhn?code=035420&quot;  &quot;/item/board.nhn?code=035420&quot;
##  [9] &quot;/item/main.nhn?code=207940&quot;  &quot;/item/board.nhn?code=207940&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 통해 HTML 정보를 읽어오며, 인코딩은 EUC-KR로 설정합니다.</li>
<li><code>html_nodes()</code> 함수를 통해 tbody 태그 정보를 불러옵니다.</li>
<li>다시 <code>html_nodes()</code> 함수를 통해 td와 a 태그 정보를 불러옵니다.</li>
<li><code>html_attr()</code> 함수를 이용해 href 속성을 불러옵니다.</li>
</ol>
<p>이를 통해 symbol에는 href 속성에 해당하는 링크 주소들이 저장됩니다. 이 중 마지막 6자리 글자만 추출하는 코드는 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">symbol =<span class="st"> </span><span class="kw">sapply</span>(symbol, <span class="cf">function</span>(x) {
        <span class="kw">substr</span>(x, <span class="kw">nchar</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="kw">nchar</span>(x)) 
      })

<span class="kw">print</span>(<span class="kw">head</span>(symbol, <span class="dv">10</span>))</code></pre>
<pre><code>##  /item/main.nhn?code=005930 /item/board.nhn?code=005930 
##                    &quot;005930&quot;                    &quot;005930&quot; 
##  /item/main.nhn?code=000660 /item/board.nhn?code=000660 
##                    &quot;000660&quot;                    &quot;000660&quot; 
##  /item/main.nhn?code=005935 /item/board.nhn?code=005935 
##                    &quot;005935&quot;                    &quot;005935&quot; 
##  /item/main.nhn?code=035420 /item/board.nhn?code=035420 
##                    &quot;035420&quot;                    &quot;035420&quot; 
##  /item/main.nhn?code=207940 /item/board.nhn?code=207940 
##                    &quot;207940&quot;                    &quot;207940&quot;</code></pre>
<p><code>sapply()</code> 함수를 통해 symbol 변수의 내용들에 <code>function()</code>을 적용하며, <code>substr()</code> 함수 내에 <code>nchar()</code> 함수를 적용해 마지막 6자리 글자만 추출합니다.</p>
<p>결과를 살펴보면 티커에 해당하는 마지막 6글자만 추출되지만 동일한 내용이 두 번 연속해 추출됩니다. 이는 main.nhn?code=에 해당하는 부분은 종목명에 설정된 링크, board.nhn?code=에 해당하는 부분은 토론실에 설정된 링크이기 때문입니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">symbol =<span class="st"> </span><span class="kw">unique</span>(symbol)
<span class="kw">print</span>(<span class="kw">head</span>(symbol, <span class="dv">10</span>))</code></pre>
<pre><code>##  [1] &quot;005930&quot; &quot;000660&quot; &quot;005935&quot; &quot;035420&quot; &quot;207940&quot; &quot;005380&quot; &quot;051910&quot;
##  [8] &quot;012330&quot; &quot;068270&quot; &quot;051900&quot;</code></pre>
<p><code>unique()</code> 함수를 이용해 중복되는 티커를 제거하면 우리가 원하는 티커 부분만 깔끔하게 정리됩니다. 해당 내용을 위에서 구한 테이블에 입력한 후 데이터를 다듬는 과정은 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">table<span class="op">$</span>N =<span class="st"> </span>symbol
<span class="kw">colnames</span>(table)[<span class="dv">1</span>] =<span class="st"> &#39;종목코드&#39;</span>
 
<span class="kw">rownames</span>(table) =<span class="st"> </span><span class="ot">NULL</span>
ticker[[j]] =<span class="st"> </span>table</code></pre>
<ol style="list-style-type: decimal">
<li>위에서 구한 티커를 N열에 입력합니다.</li>
<li>해당 열 이름을 종목코드로 변경합니다.</li>
<li><code>na.omit()</code> 함수를 통해 특정 행을 삭제했으므로, 행 이름을 초기화해줍니다.</li>
<li>ticker의 j번째 리스트에 정리된 데이터를 입력합니다.</li>
</ol>
<p>위의 코드에서 i와 j 값을 for loop 구문에 이용하면 코스피와 코스닥 전 종목의 티커가 정리된 테이블을 만들 수 있습니다. 이를 전체 코드로 나타내면 다음과 같습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data =<span class="st"> </span><span class="kw">list</span>()

<span class="co"># i = 0 은 코스피, i = 1 은 코스닥 종목</span>
<span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">0</span><span class="op">:</span><span class="dv">1</span>) {

  ticker =<span class="st"> </span><span class="kw">list</span>()
  url =
<span class="st">    </span><span class="kw">paste0</span>(<span class="st">&#39;https://finance.naver.com/sise/&#39;</span>,
             <span class="st">&#39;sise_market_sum.nhn?sosok=&#39;</span>,i,<span class="st">&#39;&amp;page=1&#39;</span>)
  
  down_table =<span class="st"> </span><span class="kw">GET</span>(url)
  
  <span class="co"># 최종 페이지 번호 찾아주기</span>
  navi.final =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&quot;EUC-KR&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&quot;.pgRR&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_attr</span>(.,<span class="st">&quot;href&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">strsplit</span>(., <span class="st">&quot;=&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">tail</span>(., <span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">as.numeric</span>()
  
  <span class="co"># 첫번째 부터 마지막 페이지까지 for loop를 이용하여 테이블 추출하기</span>
  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>navi.final) {
    
    <span class="co"># 각 페이지에 해당하는 url 생성</span>
    url =<span class="st"> </span><span class="kw">paste0</span>(
      <span class="st">&#39;https://finance.naver.com/sise/&#39;</span>,
      <span class="st">&#39;sise_market_sum.nhn?sosok=&#39;</span>,i,<span class="st">&quot;&amp;page=&quot;</span>,j)
    down_table =<span class="st"> </span><span class="kw">GET</span>(url)
 
    <span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)
    <span class="co"># 한글 오류 방지를 위해 영어로 로케일 언어 변경</span>
 
    table =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&quot;EUC-KR&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_table</span>(<span class="dt">fill =</span> <span class="ot">TRUE</span>)
    table =<span class="st"> </span>table[[<span class="dv">2</span>]] <span class="co"># 원하는 테이블 추출</span>
 
    <span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)
    <span class="co"># 한글을 읽기위해 로케일 언어 재변경</span>
 
    table[, <span class="kw">ncol</span>(table)] =<span class="st"> </span><span class="ot">NULL</span> <span class="co"># 토론식 부분 삭제</span>
    table =<span class="st"> </span><span class="kw">na.omit</span>(table) <span class="co"># 빈 행 삭제</span>
    
    <span class="co"># 6자리 티커만 추출</span>
    symbol =<span class="st"> </span><span class="kw">read_html</span>(down_table, <span class="dt">encoding =</span> <span class="st">&quot;EUC-KR&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&quot;tbody&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&quot;td&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_nodes</span>(., <span class="st">&quot;a&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">      </span><span class="kw">html_attr</span>(., <span class="st">&quot;href&quot;</span>)
 
    symbol =<span class="st"> </span><span class="kw">sapply</span>(symbol, <span class="cf">function</span>(x) {
      <span class="kw">substr</span>(x, <span class="kw">nchar</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">5</span>, <span class="kw">nchar</span>(x)) 
      }) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unique</span>()
    
    <span class="co"># 테이블에 티커 넣어준 후, 테이블 정리</span>
    table<span class="op">$</span>N =<span class="st"> </span>symbol
    <span class="kw">colnames</span>(table)[<span class="dv">1</span>] =<span class="st"> &quot;종목코드&quot;</span>

    <span class="kw">rownames</span>(table) =<span class="st"> </span><span class="ot">NULL</span>
    ticker[[j]] =<span class="st"> </span>table
 
    <span class="kw">Sys.sleep</span>(<span class="fl">0.5</span>) <span class="co"># 페이지 당 0.5초의 슬립 적용</span>
  }
  
  <span class="co"># do.call을 통해 리스트를 데이터 프레임으로 묶기</span>
  ticker =<span class="st"> </span><span class="kw">do.call</span>(rbind, ticker)
  data[[i <span class="op">+</span><span class="st"> </span><span class="dv">1</span>]] =<span class="st"> </span>ticker
}

<span class="co"># 코스피와 코스닥 테이블 묶기</span>
data =<span class="st"> </span><span class="kw">do.call</span>(rbind, data)</code></pre>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p><a href="http://hkconsensus.hankyung.com/" class="uri">http://hkconsensus.hankyung.com/</a><a href="section-18.html#fnref8" class="footnote-back">↩</a></p></li>
<li id="fn9"><p><a href="http://kind.krx.co.kr/" class="uri">http://kind.krx.co.kr/</a><a href="section-18.html#fnref9" class="footnote-back">↩</a></p></li>
<li id="fn10"><p><a href="https://finance.naver.com/news/news_list.nhn?mode=LSS2D&amp;section_id=101&amp;section_id2=258" class="uri">https://finance.naver.com/news/news_list.nhn?mode=LSS2D&amp;section_id=101&amp;section_id2=258</a><a href="section-18.html#fnref10" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="api-.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-23.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"split_bib": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
