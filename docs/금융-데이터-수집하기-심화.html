<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기</title>
  <meta name="description" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="hyunyulhenry/quant_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  
  
  

<meta name="author" content="이현열" />


<meta name="date" content="2020-05-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="금융-데이터-수집하기-기본.html"/>
<link rel="next" href="데이터-정리하기.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-7.0.1/css/motion.css" rel="stylesheet" />
<link href="libs/highcharts-7.0.1/css/htmlwdgtgrid.css" rel="stylesheet" />
<script src="libs/highcharts-7.0.1/highcharts.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-3d.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-more.js"></script>
<script src="libs/highcharts-7.0.1/modules/stock.js"></script>
<script src="libs/highcharts-7.0.1/modules/map.js"></script>
<script src="libs/highcharts-7.0.1/modules/annotations.js"></script>
<script src="libs/highcharts-7.0.1/modules/boost.js"></script>
<script src="libs/highcharts-7.0.1/modules/data.js"></script>
<script src="libs/highcharts-7.0.1/modules/drag-panes.js"></script>
<script src="libs/highcharts-7.0.1/modules/drilldown.js"></script>
<script src="libs/highcharts-7.0.1/modules/item-series.js"></script>
<script src="libs/highcharts-7.0.1/modules/offline-exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-7.0.1/modules/exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/export-data.js"></script>
<script src="libs/highcharts-7.0.1/modules/funnel.js"></script>
<script src="libs/highcharts-7.0.1/modules/heatmap.js"></script>
<script src="libs/highcharts-7.0.1/modules/treemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/sankey.js"></script>
<script src="libs/highcharts-7.0.1/modules/solid-gauge.js"></script>
<script src="libs/highcharts-7.0.1/modules/streamgraph.js"></script>
<script src="libs/highcharts-7.0.1/modules/sunburst.js"></script>
<script src="libs/highcharts-7.0.1/modules/vector.js"></script>
<script src="libs/highcharts-7.0.1/modules/wordcloud.js"></script>
<script src="libs/highcharts-7.0.1/modules/xrange.js"></script>
<script src="libs/highcharts-7.0.1/modules/tilemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/venn.js"></script>
<script src="libs/highcharts-7.0.1/modules/gantt.js"></script>
<script src="libs/highcharts-7.0.1/modules/timeline.js"></script>
<script src="libs/highcharts-7.0.1/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-7.0.1/plugins/grouped-categories.js"></script>
<script src="libs/highcharts-7.0.1/plugins/motion.js"></script>
<script src="libs/highcharts-7.0.1/plugins/multicolor_series.js"></script>
<script src="libs/highcharts-7.0.1/custom/reset.js"></script>
<script src="libs/highcharts-7.0.1/custom/symbols-extra.js"></script>
<script src="libs/highcharts-7.0.1/custom/text-symbols.js"></script>
<script src="libs/highchart-binding-0.7.0/highchart.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#지은이-소개"><i class="fa fa-check"></i>지은이 소개</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#머리말"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-구성"><i class="fa fa-check"></i>이 책의 구성</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책에서-다루지-않은-주제"><i class="fa fa-check"></i>이 책에서 다루지 않은 주제</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#도움이-될-만한-자료들"><i class="fa fa-check"></i>도움이 될 만한 자료들</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-지원-페이지"><i class="fa fa-check"></i>이 책의 지원 페이지</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#종목과-관련된-유의사항"><i class="fa fa-check"></i>종목과 관련된 유의사항</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html"><i class="fa fa-check"></i><b>1</b> 퀀트 투자의 심장: 데이터와 프로그래밍</a><ul>
<li class="chapter" data-level="1.1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#데이터-구하기"><i class="fa fa-check"></i><b>1.1</b> 데이터 구하기</a></li>
<li class="chapter" data-level="1.2" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자와-프로그래밍"><i class="fa fa-check"></i><b>1.2</b> 퀀트 투자와 프로그래밍</a></li>
<li class="chapter" data-level="1.3" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#r-프로그램"><i class="fa fa-check"></i><b>1.3</b> R 프로그램</a></li>
<li class="chapter" data-level="1.4" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자에-유용한-r-패키지"><i class="fa fa-check"></i><b>1.4</b> 퀀트 투자에 유용한 R 패키지</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html"><i class="fa fa-check"></i><b>2</b> 크롤링을 위한 기본 지식</a><ul>
<li class="chapter" data-level="2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인코딩의-이해와-r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1</b> 인코딩의 이해와 R에서 UTF-8 설정하기</a><ul>
<li class="chapter" data-level="2.1.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인간과-컴퓨터-간-번역의-시작-ascii"><i class="fa fa-check"></i><b>2.1.1</b> 인간과 컴퓨터 간 번역의 시작, ASCII</a></li>
<li class="chapter" data-level="2.1.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#한글-인코딩-방식의-종류"><i class="fa fa-check"></i><b>2.1.2</b> 한글 인코딩 방식의 종류</a></li>
<li class="chapter" data-level="2.1.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1.3</b> R에서 UTF-8 설정하기</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#웹의-동작-방식"><i class="fa fa-check"></i><b>2.2</b> 웹의 동작 방식</a><ul>
<li class="chapter" data-level="2.2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#http"><i class="fa fa-check"></i><b>2.2.1</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html과-css"><i class="fa fa-check"></i><b>2.3</b> HTML과 CSS</a><ul>
<li class="chapter" data-level="2.3.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html-기본-구조"><i class="fa fa-check"></i><b>2.3.1</b> HTML 기본 구조</a></li>
<li class="chapter" data-level="2.3.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#태그와-속성"><i class="fa fa-check"></i><b>2.3.2</b> 태그와 속성</a></li>
<li class="chapter" data-level="2.3.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#h-태그와-p-태그"><i class="fa fa-check"></i><b>2.3.3</b> h 태그와 p 태그</a></li>
<li class="chapter" data-level="2.3.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#리스트를-나타내는-ul-태그와-ol-태그"><i class="fa fa-check"></i><b>2.3.4</b> 리스트를 나타내는 ul 태그와 ol 태그</a></li>
<li class="chapter" data-level="2.3.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#table-태그"><i class="fa fa-check"></i><b>2.3.5</b> table 태그</a></li>
<li class="chapter" data-level="2.3.6" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#a-태그와-src-태그-및-속성"><i class="fa fa-check"></i><b>2.3.6</b> a 태그와 src 태그 및 속성</a></li>
<li class="chapter" data-level="2.3.7" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#div-태그"><i class="fa fa-check"></i><b>2.3.7</b> div 태그</a></li>
<li class="chapter" data-level="2.3.8" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#css"><i class="fa fa-check"></i><b>2.3.8</b> CSS</a></li>
<li class="chapter" data-level="2.3.9" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#클래스와-id"><i class="fa fa-check"></i><b>2.3.9</b> 클래스와 id</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#파이프-오퍼레이터"><i class="fa fa-check"></i><b>2.4</b> 파이프 오퍼레이터(<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="2.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#오류에-대한-예외처리"><i class="fa fa-check"></i><b>2.5</b> 오류에 대한 예외처리</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html"><i class="fa fa-check"></i><b>3</b> API를 이용한 데이터 수집</a><ul>
<li class="chapter" data-level="3.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#api를-이용한-quandl-데이터-다운로드"><i class="fa fa-check"></i><b>3.1</b> API를 이용한 Quandl 데이터 다운로드</a></li>
<li class="chapter" data-level="3.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#getsymbols-함수를-이용한-api-다운로드"><i class="fa fa-check"></i><b>3.2</b> <code>getSymbols()</code> 함수를 이용한 API 다운로드</a><ul>
<li class="chapter" data-level="3.2.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#주가-다운로드"><i class="fa fa-check"></i><b>3.2.1</b> 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#국내-종목-주가-다운로드"><i class="fa fa-check"></i><b>3.2.2</b> 국내 종목 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#fred-데이터-다운로드"><i class="fa fa-check"></i><b>3.2.3</b> FRED 데이터 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html"><i class="fa fa-check"></i><b>4</b> 크롤링 이해하기</a><ul>
<li class="chapter" data-level="4.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get과-post-방식-이해하기"><i class="fa fa-check"></i><b>4.1</b> GET과 POST 방식 이해하기</a><ul>
<li class="chapter" data-level="4.1.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get-방식"><i class="fa fa-check"></i><b>4.1.1</b> GET 방식</a></li>
<li class="chapter" data-level="4.1.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#post-방식"><i class="fa fa-check"></i><b>4.1.2</b> POST 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#크롤링-예제"><i class="fa fa-check"></i><b>4.2</b> 크롤링 예제</a><ul>
<li class="chapter" data-level="4.2.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#금융-속보-크롤링"><i class="fa fa-check"></i><b>4.2.1</b> 금융 속보 크롤링</a></li>
<li class="chapter" data-level="4.2.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#기업공시채널에서-오늘의-공시-불러오기"><i class="fa fa-check"></i><b>4.2.2</b> 기업공시채널에서 오늘의 공시 불러오기</a></li>
<li class="chapter" data-level="4.2.3" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#네이버-금융에서-주식티커-크롤링"><i class="fa fa-check"></i><b>4.2.3</b> 네이버 금융에서 주식티커 크롤링</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html"><i class="fa fa-check"></i><b>5</b> 금융 데이터 수집하기 (기본)</a><ul>
<li class="chapter" data-level="5.1" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#한국거래소의-산업별-현황-및-개별지표-크롤링"><i class="fa fa-check"></i><b>5.1</b> 한국거래소의 산업별 현황 및 개별지표 크롤링</a><ul>
<li class="chapter" data-level="5.1.1" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#산업별-현황-크롤링"><i class="fa fa-check"></i><b>5.1.1</b> 산업별 현황 크롤링</a></li>
<li class="chapter" data-level="5.1.2" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#개별종목-지표-크롤링"><i class="fa fa-check"></i><b>5.1.2</b> 개별종목 지표 크롤링</a></li>
<li class="chapter" data-level="5.1.3" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#최근-영업일-기준-데이터-받기"><i class="fa fa-check"></i><b>5.1.3</b> 최근 영업일 기준 데이터 받기</a></li>
<li class="chapter" data-level="5.1.4" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#거래소-데이터-정리하기"><i class="fa fa-check"></i><b>5.1.4</b> 거래소 데이터 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="금융-데이터-수집하기-기본.html"><a href="금융-데이터-수집하기-기본.html#wics-기준-섹터정보-크롤링"><i class="fa fa-check"></i><b>5.2</b> WICS 기준 섹터정보 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html"><i class="fa fa-check"></i><b>6</b> 금융 데이터 수집하기 (심화)</a><ul>
<li class="chapter" data-level="6.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#수정주가-크롤링"><i class="fa fa-check"></i><b>6.1</b> 수정주가 크롤링</a><ul>
<li class="chapter" data-level="6.1.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#개별종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.1</b> 개별종목 주가 크롤링</a></li>
<li class="chapter" data-level="6.1.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.2</b> 전 종목 주가 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-및-가치지표-크롤링"><i class="fa fa-check"></i><b>6.2</b> 재무제표 및 가치지표 크롤링</a><ul>
<li class="chapter" data-level="6.2.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-다운로드"><i class="fa fa-check"></i><b>6.2.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.2.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#가치지표-계산하기"><i class="fa fa-check"></i><b>6.2.2</b> 가치지표 계산하기</a></li>
<li class="chapter" data-level="6.2.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-재무제표-및-가치지표-다운로드"><i class="fa fa-check"></i><b>6.2.3</b> 전 종목 재무제표 및 가치지표 다운로드</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#dart의-open-api를-이용한-데이터-수집하기"><i class="fa fa-check"></i><b>6.3</b> DART의 Open API를 이용한 데이터 수집하기</a><ul>
<li class="chapter" data-level="6.3.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#api-key발급-및-추가하기"><i class="fa fa-check"></i><b>6.3.1</b> API Key발급 및 추가하기</a></li>
<li class="chapter" data-level="6.3.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#고유번호-다운로드"><i class="fa fa-check"></i><b>6.3.2</b> 고유번호 다운로드</a></li>
<li class="chapter" data-level="6.3.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#공시검색"><i class="fa fa-check"></i><b>6.3.3</b> 공시검색</a></li>
<li class="chapter" data-level="6.3.4" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#사업보고서-주요-정보"><i class="fa fa-check"></i><b>6.3.4</b> 사업보고서 주요 정보</a></li>
<li class="chapter" data-level="6.3.5" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#상장기업-재무정보"><i class="fa fa-check"></i><b>6.3.5</b> 상장기업 재무정보</a></li>
<li class="chapter" data-level="6.3.6" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#단일회사-전체-재무제표"><i class="fa fa-check"></i><b>6.3.6</b> 단일회사 전체 재무제표</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html"><i class="fa fa-check"></i><b>7</b> 데이터 정리하기</a><ul>
<li class="chapter" data-level="7.1" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#주가-정리하기"><i class="fa fa-check"></i><b>7.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="7.2" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#재무제표-정리하기"><i class="fa fa-check"></i><b>7.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="7.3" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#가치지표-정리하기"><i class="fa fa-check"></i><b>7.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html"><i class="fa fa-check"></i><b>8</b> 데이터 분석 및 시각화하기</a><ul>
<li class="chapter" data-level="8.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-데이터-분석"><i class="fa fa-check"></i><b>8.1</b> 종목정보 데이터 분석</a><ul>
<li class="chapter" data-level="8.1.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#join-데이터-합치기"><i class="fa fa-check"></i><b>8.1.1</b> <code>*_join</code>: 데이터 합치기</a></li>
<li class="chapter" data-level="8.1.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#glimpse-데이터-구조-확인하기"><i class="fa fa-check"></i><b>8.1.2</b> <code>glimpse()</code>: 데이터 구조 확인하기</a></li>
<li class="chapter" data-level="8.1.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#rename-열-이름-바꾸기"><i class="fa fa-check"></i><b>8.1.3</b> <code>rename()</code>: 열 이름 바꾸기</a></li>
<li class="chapter" data-level="8.1.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#distinct-고유한-값-확인"><i class="fa fa-check"></i><b>8.1.4</b> distinct(): 고유한 값 확인</a></li>
<li class="chapter" data-level="8.1.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#select-원하는-열만-선택"><i class="fa fa-check"></i><b>8.1.5</b> <code>select()</code>: 원하는 열만 선택</a></li>
<li class="chapter" data-level="8.1.6" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#mutate-열-생성-및-데이터-변형"><i class="fa fa-check"></i><b>8.1.6</b> <code>mutate()</code>: 열 생성 및 데이터 변형</a></li>
<li class="chapter" data-level="8.1.7" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#filter-조건을-충족하는-행-선택"><i class="fa fa-check"></i><b>8.1.7</b> <code>filter()</code>: 조건을 충족하는 행 선택</a></li>
<li class="chapter" data-level="8.1.8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#summarize-요약-통곗값-계산"><i class="fa fa-check"></i><b>8.1.8</b> <code>summarize()</code>: 요약 통곗값 계산</a></li>
<li class="chapter" data-level="8.1.9" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#arrange-데이터-정렬"><i class="fa fa-check"></i><b>8.1.9</b> <code>arrange()</code>: 데이터 정렬</a></li>
<li class="chapter" data-level="8.1.10" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#row_number-순위-계산"><i class="fa fa-check"></i><b>8.1.10</b> <code>row_number()</code>: 순위 계산</a></li>
<li class="chapter" data-level="8.1.11" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#ntile-분위수-계산"><i class="fa fa-check"></i><b>8.1.11</b> <code>ntile()</code>: 분위수 계산</a></li>
<li class="chapter" data-level="8.1.12" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#group_by-그룹별로-데이터를-묶기"><i class="fa fa-check"></i><b>8.1.12</b> <code>group_by()</code>: 그룹별로 데이터를 묶기</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#ggplot-기초"><i class="fa fa-check"></i><b>8.2</b> <code>ggplot()</code> 기초</a><ul>
<li class="chapter" data-level="8.2.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#diamonds-데이터셋"><i class="fa fa-check"></i><b>8.2.1</b> diamonds 데이터셋</a></li>
<li class="chapter" data-level="8.2.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#data-aesthetics-geometrics"><i class="fa fa-check"></i><b>8.2.2</b> Data, Aesthetics, Geometrics</a></li>
<li class="chapter" data-level="8.2.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#facets"><i class="fa fa-check"></i><b>8.2.3</b> Facets</a></li>
<li class="chapter" data-level="8.2.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#statistics"><i class="fa fa-check"></i><b>8.2.4</b> Statistics</a></li>
<li class="chapter" data-level="8.2.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#coordinates"><i class="fa fa-check"></i><b>8.2.5</b> Coordinates</a></li>
<li class="chapter" data-level="8.2.6" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#theme"><i class="fa fa-check"></i><b>8.2.6</b> Theme</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-시각화"><i class="fa fa-check"></i><b>8.3</b> 종목정보 시각화</a><ul>
<li class="chapter" data-level="8.3.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_point-산점도-나타내기"><i class="fa fa-check"></i><b>8.3.1</b> <code>geom_point()</code>: 산점도 나타내기</a></li>
<li class="chapter" data-level="8.3.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_histogram-히스토그램-나타내기"><i class="fa fa-check"></i><b>8.3.2</b> <code>geom_histogram()</code>: 히스토그램 나타내기</a></li>
<li class="chapter" data-level="8.3.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_boxplot-박스-플롯-나타내기"><i class="fa fa-check"></i><b>8.3.3</b> <code>geom_boxplot()</code>: 박스 플롯 나타내기</a></li>
<li class="chapter" data-level="8.3.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#dplyr과-ggplot을-연결하여-사용하기"><i class="fa fa-check"></i><b>8.3.4</b> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</a></li>
<li class="chapter" data-level="8.3.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_bar-막대-그래프-나타내기"><i class="fa fa-check"></i><b>8.3.5</b> <code>geom_bar()</code>: 막대 그래프 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-및-수익률-시각화"><i class="fa fa-check"></i><b>8.4</b> 주가 및 수익률 시각화</a><ul>
<li class="chapter" data-level="8.4.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-그래프-나타내기"><i class="fa fa-check"></i><b>8.4.1</b> 주가 그래프 나타내기</a></li>
<li class="chapter" data-level="8.4.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#인터랙티브-그래프-나타내기"><i class="fa fa-check"></i><b>8.4.2</b> 인터랙티브 그래프 나타내기</a></li>
<li class="chapter" data-level="8.4.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#연도별-수익률-나타내기"><i class="fa fa-check"></i><b>8.4.3</b> 연도별 수익률 나타내기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html"><i class="fa fa-check"></i><b>9</b> 퀀트 전략을 이용한 종목선정 (기본)</a><ul>
<li class="chapter" data-level="9.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-이해하기"><i class="fa fa-check"></i><b>9.1</b> 베타 이해하기</a><ul>
<li class="chapter" data-level="9.1.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-계산하기"><i class="fa fa-check"></i><b>9.1.1</b> 베타 계산하기</a></li>
<li class="chapter" data-level="9.1.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-시각화"><i class="fa fa-check"></i><b>9.1.2</b> 베타 시각화</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-전략"><i class="fa fa-check"></i><b>9.2</b> 저변동성 전략</a><ul>
<li class="chapter" data-level="9.2.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-일간-기준"><i class="fa fa-check"></i><b>9.2.1</b> 저변동성 포트폴리오 구하기: 일간 기준</a></li>
<li class="chapter" data-level="9.2.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-주간-기준"><i class="fa fa-check"></i><b>9.2.2</b> 저변동성 포트폴리오 구하기: 주간 기준</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-전략"><i class="fa fa-check"></i><b>9.3</b> 모멘텀 전략</a><ul>
<li class="chapter" data-level="9.3.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-12개월-모멘텀"><i class="fa fa-check"></i><b>9.3.1</b> 모멘텀 포트폴리오 구하기: 12개월 모멘텀</a></li>
<li class="chapter" data-level="9.3.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-위험조정-수익률"><i class="fa fa-check"></i><b>9.3.2</b> 모멘텀 포트폴리오 구하기: 위험조정 수익률</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-전략"><i class="fa fa-check"></i><b>9.4</b> 밸류 전략</a><ul>
<li class="chapter" data-level="9.4.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-포트폴리오-구하기-저pbr"><i class="fa fa-check"></i><b>9.4.1</b> 밸류 포트폴리오 구하기: 저PBR</a></li>
<li class="chapter" data-level="9.4.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표-결합하기"><i class="fa fa-check"></i><b>9.4.2</b> 각 지표 결합하기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#퀄리티-전략"><i class="fa fa-check"></i><b>9.5</b> 퀄리티 전략</a><ul>
<li class="chapter" data-level="9.5.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#f-score"><i class="fa fa-check"></i><b>9.5.1</b> F-Score</a></li>
<li class="chapter" data-level="9.5.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표를-결합하기"><i class="fa fa-check"></i><b>9.5.2</b> 각 지표를 결합하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html"><i class="fa fa-check"></i><b>10</b> 퀀트 전략을 이용한 종목선정 (심화)</a><ul>
<li class="chapter" data-level="10.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#섹터-중립-포트폴리오"><i class="fa fa-check"></i><b>10.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="10.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식"><i class="fa fa-check"></i><b>10.2</b> 마법공식</a><ul>
<li class="chapter" data-level="10.2.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#퀄리티와-밸류-간의-관계"><i class="fa fa-check"></i><b>10.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="10.2.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-이해하기"><i class="fa fa-check"></i><b>10.2.2</b> 마법공식 이해하기</a></li>
<li class="chapter" data-level="10.2.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-구성하기"><i class="fa fa-check"></i><b>10.2.3</b> 마법공식 구성하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#이상치-데이터-제거-및-팩터의-결합"><i class="fa fa-check"></i><b>10.3</b> 이상치 데이터 제거 및 팩터의 결합</a><ul>
<li class="chapter" data-level="10.3.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#트림trim-이상치-데이터-삭제"><i class="fa fa-check"></i><b>10.3.1</b> 트림(Trim): 이상치 데이터 삭제</a></li>
<li class="chapter" data-level="10.3.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#윈저라이징winsorizing-이상치-데이터-대체"><i class="fa fa-check"></i><b>10.3.2</b> 윈저라이징(Winsorizing): 이상치 데이터 대체</a></li>
<li class="chapter" data-level="10.3.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#팩터의-결합-방법"><i class="fa fa-check"></i><b>10.3.3</b> 팩터의 결합 방법</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#멀티팩터-포트폴리오"><i class="fa fa-check"></i><b>10.4</b> 멀티팩터 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html"><i class="fa fa-check"></i><b>11</b> 포트폴리오 구성</a><ul>
<li class="chapter" data-level="11.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소분산-포트폴리오"><i class="fa fa-check"></i><b>11.1</b> 최소분산 포트폴리오</a><ul>
<li class="chapter" data-level="11.1.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#slsqp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.1</b> <code>slsqp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.2</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.3</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#결괏값들의-비교"><i class="fa fa-check"></i><b>11.1.4</b> 결괏값들의 비교</a></li>
<li class="chapter" data-level="11.1.5" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건"><i class="fa fa-check"></i><b>11.1.5</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.1.6" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산별-제약조건의-추가"><i class="fa fa-check"></i><b>11.1.6</b> 각 자산별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최대분산효과-포트폴리오"><i class="fa fa-check"></i><b>11.2</b> 최대분산효과 포트폴리오</a><ul>
<li class="chapter" data-level="11.2.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.2</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건-1"><i class="fa fa-check"></i><b>11.2.3</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.2.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산-별-제약조건의-추가"><i class="fa fa-check"></i><b>11.2.4</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험균형-포트폴리오"><i class="fa fa-check"></i><b>11.3</b> 위험균형 포트폴리오</a><ul>
<li class="chapter" data-level="11.3.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#주식-60와-채권-40-포트폴리오의-위험기여도"><i class="fa fa-check"></i><b>11.3.1</b> 주식 60%와 채권 40% 포트폴리오의 위험기여도</a></li>
<li class="chapter" data-level="11.3.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#rp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.3.2</b> <code>rp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.3.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험예산-포트폴리오"><i class="fa fa-check"></i><b>11.3.3</b> 위험예산 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#인덱스-포트폴리오-구성하기"><i class="fa fa-check"></i><b>11.4</b> 인덱스 포트폴리오 구성하기</a><ul>
<li class="chapter" data-level="11.4.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#시가총액비중-계산하기"><i class="fa fa-check"></i><b>11.4.1</b> 시가총액비중 계산하기</a></li>
<li class="chapter" data-level="11.4.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#인덱스-포트폴리오-복제하기"><i class="fa fa-check"></i><b>11.4.2</b> 인덱스 포트폴리오 복제하기</a></li>
<li class="chapter" data-level="11.4.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#팩터를-이용한-인핸스드-포트폴리오-구성하기"><i class="fa fa-check"></i><b>11.4.3</b> 팩터를 이용한 인핸스드 포트폴리오 구성하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html"><i class="fa fa-check"></i><b>12</b> 포트폴리오 백테스트</a><ul>
<li class="chapter" data-level="12.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#return.portfolio-함수"><i class="fa fa-check"></i><b>12.1</b> <code>Return.Portfolio()</code> 함수</a><ul>
<li class="chapter" data-level="12.1.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#인자-목록-살펴보기"><i class="fa fa-check"></i><b>12.1.1</b> 인자 목록 살펴보기</a></li>
<li class="chapter" data-level="12.1.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#출력값-살펴보기"><i class="fa fa-check"></i><b>12.1.2</b> 출력값 살펴보기</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#전통적인-60대-40-포트폴리오-백테스트"><i class="fa fa-check"></i><b>12.2</b> 전통적인 60대 40 포트폴리오 백테스트</a></li>
<li class="chapter" data-level="12.3" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#시점-선택-전략-백테스트"><i class="fa fa-check"></i><b>12.3</b> 시점 선택 전략 백테스트</a></li>
<li class="chapter" data-level="12.4" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#동적-자산배분-백테스트"><i class="fa fa-check"></i><b>12.4</b> 동적 자산배분 백테스트</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html"><i class="fa fa-check"></i><b>13</b> 성과 및 위험 평가</a><ul>
<li class="chapter" data-level="13.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#결과-측정-지표"><i class="fa fa-check"></i><b>13.1</b> 결과 측정 지표</a><ul>
<li class="chapter" data-level="13.1.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#수익률-및-변동성"><i class="fa fa-check"></i><b>13.1.1</b> 수익률 및 변동성</a></li>
<li class="chapter" data-level="13.1.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#낙폭과-최대낙폭"><i class="fa fa-check"></i><b>13.1.2</b> 낙폭과 최대낙폭</a></li>
<li class="chapter" data-level="13.1.3" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#연도별-수익률"><i class="fa fa-check"></i><b>13.1.3</b> 연도별 수익률</a></li>
<li class="chapter" data-level="13.1.4" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#승률-및-롤링-윈도우-값"><i class="fa fa-check"></i><b>13.1.4</b> 승률 및 롤링 윈도우 값</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#팩터-회귀분석-및-테이블로-나타내기"><i class="fa fa-check"></i><b>13.2</b> 팩터 회귀분석 및 테이블로 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://henryquant.blogspot.com/" target="blank">Henry's Quantopia</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="금융-데이터-수집하기-심화" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> 금융 데이터 수집하기 (심화)</h1>
<p>지난 CHAPTER에서 수집한 주식티커를 바탕으로 이번 CHAPTER에서는 퀀트 투자의 핵심 자료인 수정주가, 재무제표, 가치지표를 크롤링하는 방법을 알아보겠습니다.</p>
<div id="수정주가-크롤링" class="section level2">
<h2><span class="header-section-number">6.1</span> 수정주가 크롤링</h2>
<p>주가 데이터는 투자를 함에 있어 반드시 필요한 데이터이며, 인터넷에서 주가를 수집할 수 있는 방법은 매우 많습니다. 먼저 API를 이용한 데이터 수집에서 살펴본 것과 같이, <code>getSymbols()</code> 함수를 이용해 데이터를 받을 수 있습니다. 그러나 야후 파이낸스에서 제공하는 데이터 중 미국 주가는 이상 없이 다운로드되지만, 국내 중소형주는 주가가 없는 경우가 있습니다.</p>
<p>또한 단순 주가를 구할 수 있는 방법은 많지만, 투자에 필요한 수정주가를 구할 수 있는 방법은 찾기 힘듭니다. 다행히 네이버 금융에서 제공하는 정보를 통해 모든 종목의 수정주가를 매우 손쉽게 구할 수 있습니다.</p>
<div id="개별종목-주가-크롤링" class="section level3">
<h3><span class="header-section-number">6.1.1</span> 개별종목 주가 크롤링</h3>
<p>먼저 네이버 금융에서 특정종목(예: 삼성전자)의 [차트] 탭<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a>을 선택합니다.<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> 해당 차트는 주가 데이터를 받아 그래프를 그려주는 형태입니다. 따라서 해당 데이터가 어디에서 오는지 알기 위해 개발자 도구 화면을 이용합니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="images/crawl_practice_price2.png" alt="네이버금융 차트의 통신기록" width="70%" />
<p class="caption">
그림 1.3: 네이버금융 차트의 통신기록
</p>
</div>
<p>화면을 연 상태에서 [일봉] 탭을 선택하면 sise.nhn, schedule.nhn, notice.nhn 총 세 가지 항목이 생성됩니다. 이 중 sise.nhn 항목의 Request URL이 주가 데이터를 요청하는 주소입니다. 해당 URL에 접속해보겠습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="images/crawl_practice_price3.png" alt="주가 데이터 페이지" width="70%" />
<p class="caption">
그림 2.1: 주가 데이터 페이지
</p>
</div>
<p>각 날짜별로 시가, 고가, 저가, 종가, 거래량이 있으며, 주가는 모두 수정주가 기준입니다. 또한 해당 데이터가 item 태그 내 data 속성에 위치하고 있습니다.</p>
<p>URL에서 symbol= 뒤에 6자리 티커만 변경하면 해당 종목의 주가 데이터가 있는 페이지로 이동할 수 있으며, 우리가 원하는 모든 종목의 주가 데이터를 크롤링할 수 있습니다.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb120-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb120-2" data-line-number="2"></a>
<a class="sourceLine" id="cb120-3" data-line-number="3">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb120-4" data-line-number="4"><span class="kw">print</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</a></code></pre></div>
<pre><code>## [1] 5930</code></pre>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" data-line-number="1">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb122-2" data-line-number="2"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a></code></pre></div>
<p>먼저 저장해두었던 csv 파일을 불러옵니다. 종목코드를 살펴보면 005930이어야 할 삼성전자의 티커가 5930으로 입력되어 있습니다. 이는 파일을 불러오는 과정에서 0으로 시작하는 숫자들이 지워졌기 때문입니다. stringr 패키지의 <code>str_pad()</code> 함수를 사용해 6자리가 되지 않는 문자는 왼쪽에 0을 추가해 강제로 6자리로 만들어주도록 합니다.</p>
<p>다음은 첫 번째 종목인 삼성전자의 주가를 크롤링한 후 가공하는 방법입니다.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"></a>
<a class="sourceLine" id="cb123-3" data-line-number="3"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb123-4" data-line-number="4">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb125-2" data-line-number="2">name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i]</a>
<a class="sourceLine" id="cb125-3" data-line-number="3"></a>
<a class="sourceLine" id="cb125-4" data-line-number="4">price =<span class="st"> </span><span class="kw">xts</span>(<span class="ot">NA</span>, <span class="dt">order.by =</span> <span class="kw">Sys.Date</span>())</a>
<a class="sourceLine" id="cb125-5" data-line-number="5"><span class="kw">print</span>(price)</a></code></pre></div>
<pre><code>##            [,1]
## 2020-05-31   NA</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_price 폴더를 생성합니다.</li>
<li>i = 1을 입력합니다. 향후 for loop 구문을 통해 i 값만 변경하면 모든 종목의 주가를 다운로드할 수 있습니다.</li>
<li>name에 해당 티커를 입력합니다.</li>
<li><code>xts()</code> 함수를 이용해 빈 시계열 데이터를 생성하며, 인덱스는 <code>Sys.Date()</code>를 통해 현재 날짜를 입력합니다.</li>
</ol>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb127-3" data-line-number="3"></a>
<a class="sourceLine" id="cb127-4" data-line-number="4">url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb127-5" data-line-number="5">  <span class="st">&#39;https://fchart.stock.naver.com/sise.nhn?symbol=&#39;</span>,</a>
<a class="sourceLine" id="cb127-6" data-line-number="6">  name,<span class="st">&#39;&amp;timeframe=day&amp;count=500&amp;requestType=0&#39;</span>)</a>
<a class="sourceLine" id="cb127-7" data-line-number="7">data =<span class="st"> </span><span class="kw">GET</span>(url)</a>
<a class="sourceLine" id="cb127-8" data-line-number="8">data_html =<span class="st"> </span><span class="kw">read_html</span>(data, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-9" data-line-number="9"><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;item&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-10" data-line-number="10"><span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&#39;data&#39;</span>) </a>
<a class="sourceLine" id="cb127-11" data-line-number="11"></a>
<a class="sourceLine" id="cb127-12" data-line-number="12"><span class="kw">print</span>(<span class="kw">head</span>(data_html))</a></code></pre></div>
<pre><code>## [1] &quot;20180516|49200|50200|49150|49850|15918683&quot;
## [2] &quot;20180517|50300|50500|49400|49400|10365440&quot;
## [3] &quot;20180518|49900|49900|49350|49500|6706570&quot; 
## [4] &quot;20180521|49650|50200|49100|50000|9020998&quot; 
## [5] &quot;20180523|50600|52000|50400|51800|17095490&quot;
## [6] &quot;20180524|52000|52000|51100|51400|8289275&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>paste0()</code> 함수를 이용해 원하는 종목의 url을 생성합니다. url 중 티커에 해당하는 6자리 부분만 위에서 입력한 name으로 설정해주면 됩니다.</li>
<li><code>GET()</code> 함수를 통해 페이지의 데이터를 불러옵니다.</li>
<li><code>read_html()</code> 함수를 통해 HTML 정보를 읽어옵니다.</li>
<li><code>html_nodes()</code>와 <code>html_attr()</code> 함수를 통해 item 태그 및 data 속성의 데이터를 추출합니다.</li>
</ol>
<p>결과적으로 날짜 및 주가, 거래량 데이터가 추출됩니다. 해당 데이터는 |으로 구분되어 있으며, 이를 테이블 형태로 바꿀 필요가 있습니다.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb129-2" data-line-number="2"></a>
<a class="sourceLine" id="cb129-3" data-line-number="3">price =<span class="st"> </span><span class="kw">read_delim</span>(data_html, <span class="dt">delim =</span> <span class="st">&#39;|&#39;</span>)</a>
<a class="sourceLine" id="cb129-4" data-line-number="4"><span class="kw">print</span>(<span class="kw">head</span>(price))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   `20180516` `49200` `50200` `49150` `49850` `15918683`
##        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;
## 1   20180517   50300   50500   49400   49400   10365440
## 2   20180518   49900   49900   49350   49500    6706570
## 3   20180521   49650   50200   49100   50000    9020998
## 4   20180523   50600   52000   50400   51800   17095490
## 5   20180524   52000   52000   51100   51400    8289275
## 6   20180525   51000   52800   50800   52700   15207266</code></pre>
<p>readr 패키지의 <code>read_delim()</code> 함수를 쓰면 구분자로 이루어진 데이터를 테이블로 쉽게 변경할 수 있습니다. 데이터를 확인해보면 테이블 형태로 변경되었으며 각 열은 날짜, 시가, 고가, 저가, 종가, 거래량을 의미합니다. 이 중 우리가 필요한 날짜와 종가를 선택한 후 데이터 클렌징을 해줍니다.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb131-2" data-line-number="2"><span class="kw">library</span>(timetk)</a>
<a class="sourceLine" id="cb131-3" data-line-number="3"></a>
<a class="sourceLine" id="cb131-4" data-line-number="4">price =<span class="st"> </span>price[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)] </a>
<a class="sourceLine" id="cb131-5" data-line-number="5">price =<span class="st"> </span><span class="kw">data.frame</span>(price)</a>
<a class="sourceLine" id="cb131-6" data-line-number="6"><span class="kw">colnames</span>(price) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>)</a>
<a class="sourceLine" id="cb131-7" data-line-number="7">price[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">ymd</span>(price[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb131-8" data-line-number="8">price =<span class="st"> </span><span class="kw">tk_xts</span>(price, <span class="dt">date_var =</span> Date)</a>
<a class="sourceLine" id="cb131-9" data-line-number="9"> </a>
<a class="sourceLine" id="cb131-10" data-line-number="10"><span class="kw">print</span>(<span class="kw">tail</span>(price))</a></code></pre></div>
<pre><code>##            Price
## 2020-05-22 48750
## 2020-05-25 48850
## 2020-05-26 49250
## 2020-05-27 49900
## 2020-05-28 50400
## 2020-05-29 50700</code></pre>
<ol style="list-style-type: decimal">
<li>날짜에 해당하는 첫 번째 열과, 종가에 해당하는 다섯 번째 열만 선택해 저장합니다.</li>
<li>티블 형태의 데이터를 데이터 프레임 형태로 변경합니다.</li>
<li>열 이름을 Date와 Price로 변경합니다.</li>
<li>lubridate 패키지의 <code>ymd()</code> 함수를 이용하면 yyyymmdd 형태가 yyyy-mm-dd로 변경되며 데이터 형태 또한 Date 타입으로 변경됩니다.</li>
<li><code>timetk</code> 패키지의 <code>tk_xts()</code> 함수를 이용해 시계열 형태로 변경하며, 인덱스는 Date 열을 설정합니다. 형태를 변경한 후 해당 열은 자동으로 삭제됩니다.</li>
</ol>
<p>데이터를 확인해보면 우리에게 필요한 형태로 정리되었습니다.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1"><span class="kw">write.csv</span>(price, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name,</a>
<a class="sourceLine" id="cb133-2" data-line-number="2">                        <span class="st">&#39;_price.csv&#39;</span>))</a></code></pre></div>
<p>마지막으로 해당 데이터를 data 폴더의 KOR_price 폴더 내에 티커_price.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-주가-크롤링" class="section level3">
<h3><span class="header-section-number">6.1.2</span> 전 종목 주가 크롤링</h3>
<p>위의 코드에서 for loop 구문을 이용해 i 값만 변경해주면 모든 종목의 주가를 다운로드할 수 있습니다. 전 종목 주가를 다운로드하는 전체 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb134-3" data-line-number="3"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb134-4" data-line-number="4"><span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb134-5" data-line-number="5"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb134-7" data-line-number="7"></a>
<a class="sourceLine" id="cb134-8" data-line-number="8">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb134-9" data-line-number="9"><span class="kw">print</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb134-10" data-line-number="10">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb134-11" data-line-number="11"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb134-12" data-line-number="12"></a>
<a class="sourceLine" id="cb134-13" data-line-number="13"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb134-14" data-line-number="14">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</a>
<a class="sourceLine" id="cb134-15" data-line-number="15"></a>
<a class="sourceLine" id="cb134-16" data-line-number="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(KOR_ticker) ) {</a>
<a class="sourceLine" id="cb134-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb134-18" data-line-number="18">  price =<span class="st"> </span><span class="kw">xts</span>(<span class="ot">NA</span>, <span class="dt">order.by =</span> <span class="kw">Sys.Date</span>()) <span class="co"># 빈 시계열 데이터 생성</span></a>
<a class="sourceLine" id="cb134-19" data-line-number="19">  name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i] <span class="co"># 티커 부분 선택</span></a>
<a class="sourceLine" id="cb134-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb134-21" data-line-number="21">  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></a>
<a class="sourceLine" id="cb134-22" data-line-number="22">  <span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb134-23" data-line-number="23">    <span class="co"># url 생성</span></a>
<a class="sourceLine" id="cb134-24" data-line-number="24">    url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb134-25" data-line-number="25">      <span class="st">&#39;https://fchart.stock.naver.com/sise.nhn?symbol=&#39;</span></a>
<a class="sourceLine" id="cb134-26" data-line-number="26">      ,name,<span class="st">&#39;&amp;timeframe=day&amp;count=500&amp;requestType=0&#39;</span>)</a>
<a class="sourceLine" id="cb134-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb134-28" data-line-number="28">    <span class="co"># 이 후 과정은 위와 동일함</span></a>
<a class="sourceLine" id="cb134-29" data-line-number="29">    <span class="co"># 데이터 다운로드</span></a>
<a class="sourceLine" id="cb134-30" data-line-number="30">    data =<span class="st"> </span><span class="kw">GET</span>(url)</a>
<a class="sourceLine" id="cb134-31" data-line-number="31">    data_html =<span class="st"> </span><span class="kw">read_html</span>(data, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-32" data-line-number="32"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;item&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb134-33" data-line-number="33"><span class="st">      </span><span class="kw">html_attr</span>(<span class="st">&quot;data&quot;</span>) </a>
<a class="sourceLine" id="cb134-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb134-35" data-line-number="35">    <span class="co"># 데이터 나누기</span></a>
<a class="sourceLine" id="cb134-36" data-line-number="36">    price =<span class="st"> </span><span class="kw">read_delim</span>(data_html, <span class="dt">delim =</span> <span class="st">&#39;|&#39;</span>)</a>
<a class="sourceLine" id="cb134-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb134-38" data-line-number="38">    <span class="co"># 필요한 열만 선택 후 클렌징</span></a>
<a class="sourceLine" id="cb134-39" data-line-number="39">    price =<span class="st"> </span>price[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)] </a>
<a class="sourceLine" id="cb134-40" data-line-number="40">    price =<span class="st"> </span><span class="kw">data.frame</span>(price)</a>
<a class="sourceLine" id="cb134-41" data-line-number="41">    <span class="kw">colnames</span>(price) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>)</a>
<a class="sourceLine" id="cb134-42" data-line-number="42">    price[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">ymd</span>(price[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb134-43" data-line-number="43">    </a>
<a class="sourceLine" id="cb134-44" data-line-number="44">    <span class="kw">rownames</span>(price) =<span class="st"> </span>price[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb134-45" data-line-number="45">    price[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb134-46" data-line-number="46">    </a>
<a class="sourceLine" id="cb134-47" data-line-number="47">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb134-48" data-line-number="48">    </a>
<a class="sourceLine" id="cb134-49" data-line-number="49">    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></a>
<a class="sourceLine" id="cb134-50" data-line-number="50">    <span class="kw">warning</span>(<span class="kw">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</a>
<a class="sourceLine" id="cb134-51" data-line-number="51">  })</a>
<a class="sourceLine" id="cb134-52" data-line-number="52">  </a>
<a class="sourceLine" id="cb134-53" data-line-number="53">  <span class="co"># 다운로드 받은 파일을 생성한 폴더 내 csv 파일로 저장</span></a>
<a class="sourceLine" id="cb134-54" data-line-number="54">  <span class="kw">write.csv</span>(price, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name,</a>
<a class="sourceLine" id="cb134-55" data-line-number="55">                          <span class="st">&#39;_price.csv&#39;</span>))</a>
<a class="sourceLine" id="cb134-56" data-line-number="56">  </a>
<a class="sourceLine" id="cb134-57" data-line-number="57">  <span class="co"># 타임슬립 적용</span></a>
<a class="sourceLine" id="cb134-58" data-line-number="58">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb134-59" data-line-number="59">}</a></code></pre></div>
<p>위 코드에서 추가된 점은 다음과 같습니다. 페이지 오류, 통신 오류 등 오류가 발생할 경우 for loop 구문은 멈춰버리는데 전체 데이터를 처음부터 다시 받는 일은 매우 귀찮은 작업입니다. 따라서 <code>tryCatch()</code> 함수를 이용해 오류가 발생할 때 해당 티커를 출력한 후 다음 루프로 넘어가게 합니다.</p>
<p>또한 오류가 발생하면 <code>xts()</code> 함수를 통해 만들어둔 빈 데이터를 저장하게 됩니다. 마지막으로 무한 크롤링을 방지하기 위해 한 번의 루프가 끝날 때마다 2초의 타임슬립을 적용했습니다.</p>
<p>위 코드가 모두 돌아가는 데는 수 시간이 걸립니다. 작업이 끝난 후 data/KOR_price 폴더를 확인해보면 전 종목 주가가 csv 형태로 저장되어 있습니다.</p>
</div>
</div>
<div id="재무제표-및-가치지표-크롤링" class="section level2">
<h2><span class="header-section-number">6.2</span> 재무제표 및 가치지표 크롤링</h2>
<p>주가와 더불어 재무제표와 가치지표 역시 투자에 있어 핵심이 되는 데이터입니다. 해당 데이터 역시 여러 웹사이트에서 구할 수 있지만, 국내 데이터 제공업체인 FnGuide에서 운영하는 Company Guide 웹사이트<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a>에서 손쉽게 구할 수 있습니다.</p>
<div id="재무제표-다운로드" class="section level3">
<h3><span class="header-section-number">6.2.1</span> 재무제표 다운로드</h3>
<p>먼저 개별종목의 재무제표를 탭을 선택하면 포괄손익계산서, 재무상태표, 현금흐름표 항목이 보이게 되며, 티커에 해당하는 A005930 뒤의 주소는 불필요한 내용이므로, 이를 제거한 주소로 접속합니다. A 뒤의 6자리 티커만 변경한다면 해당 종목의 재무제표 페이지로 이동하게 됩니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>우리가 원하는 재무제표 항목들은 모두 테이블 형태로 제공되고 있으므로 html_table() 함수를 이용해 추출할 수 있습니다.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb135-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb135-3" data-line-number="3"></a>
<a class="sourceLine" id="cb135-4" data-line-number="4"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb135-5" data-line-number="5">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</a>
<a class="sourceLine" id="cb135-6" data-line-number="6"></a>
<a class="sourceLine" id="cb135-7" data-line-number="7"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)</a>
<a class="sourceLine" id="cb135-8" data-line-number="8"></a>
<a class="sourceLine" id="cb135-9" data-line-number="9">url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930&#39;</span>)</a>
<a class="sourceLine" id="cb135-10" data-line-number="10"></a>
<a class="sourceLine" id="cb135-11" data-line-number="11">data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb135-12" data-line-number="12">           <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb135-13" data-line-number="13"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb135-14" data-line-number="14">data =<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-15" data-line-number="15"><span class="st">  </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb135-16" data-line-number="16"><span class="st">  </span><span class="kw">html_table</span>()</a>
<a class="sourceLine" id="cb135-17" data-line-number="17"></a>
<a class="sourceLine" id="cb135-18" data-line-number="18"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" data-line-number="1"><span class="kw">lapply</span>(data, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb136-2" data-line-number="2">  <span class="kw">head</span>(x, <span class="dv">3</span>)})</a></code></pre></div>
<pre><code>## [[1]]
##   IFRS(연결)   2017/12   2018/12   2019/12 2020/03
## 1     매출액 2,395,754 2,437,714 2,304,009 553,252
## 2   매출원가 1,292,907 1,323,944 1,472,395 348,067
## 3 매출총이익 1,102,847 1,113,770   831,613 205,185
##   전년동기 전년동기(%)
## 1  523,855         5.6
## 2  327,465         6.3
## 3  196,391         4.5
## 
## [[2]]
##   IFRS(연결) 2019/06 2019/09 2019/12 2020/03 전년동기
## 1     매출액 561,271 620,035 598,848 553,252  523,855
## 2   매출원가 359,447 399,939 385,545 348,067  327,465
## 3 매출총이익 201,824 220,096 213,302 205,185  196,391
##   전년동기(%)
## 1         5.6
## 2         6.3
## 3         4.5
## 
## [[3]]
##                          IFRS(연결)   2017/12   2018/12
## 1                              자산 3,017,521 3,393,572
## 2 유동자산계산에 참여한 계정 펼치기 1,469,825 1,746,974
## 3                          재고자산   249,834   289,847
##     2019/12   2020/03
## 1 3,525,645 3,574,575
## 2 1,813,853 1,867,397
## 3   267,665   284,549
## 
## [[4]]
##                          IFRS(연결)   2019/06   2019/09
## 1                              자산 3,429,401 3,533,860
## 2 유동자산계산에 참여한 계정 펼치기 1,734,335 1,860,421
## 3                          재고자산   312,470   309,088
##     2019/12   2020/03
## 1 3,525,645 3,574,575
## 2 1,813,853 1,867,397
## 3   267,665   284,549
## 
## [[5]]
##                     IFRS(연결) 2017/12 2018/12 2019/12
## 1     영업활동으로인한현금흐름 621,620 670,319 453,829
## 2                   당기순손익 421,867 443,449 217,389
## 3 법인세비용차감전계속사업이익                        
##   2020/03
## 1 118,299
## 2  48,849
## 3        
## 
## [[6]]
##                     IFRS(연결) 2019/06 2019/09 2019/12
## 1     영업활동으로인한현금흐름  65,949 138,266 197,171
## 2                   당기순손익  51,806  62,877  52,270
## 3 법인세비용차감전계속사업이익                        
##   2020/03
## 1 118,299
## 2  48,849
## 3</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_fs 폴더를 생성합니다.</li>
<li><code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 English로 설정합니다.</li>
<li>url을 입력한 후 <code>GET()</code> 함수를 통해 페이지 내용을 받아오며, <code>user_agent()</code> 항목에 웹브라우저 구별을 입력해줍니다. 해당 사이트는 크롤러와 같이 정체가 불분명한 웹브라우저를 통한 접속이 막혀 있어, 마치 모질라 혹은 크롬을 통해 접속한 것 처럼 데이터를 요청합니다. 다양한 웹브라저 리스트는 아래 링크에 나와있습니다.</li>
</ol>
<pre><code>http://www.useragentstring.com/pages/useragentstring.php</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 통해 HTML 내용을 읽어오며, <code>html_table()</code> 함수를 통해 테이블 내용만 추출합니다.</li>
<li>로케일 언어를 다시 Korean으로 설정합니다.</li>
</ol>
<p>위의 과정을 거치면 data 변수에는 리스트 형태로 총 6개의 테이블이 들어오게 되며, 그 내용은 표 <a href="금융-데이터-수집하기-심화.html#tab:fstable">6.1</a>와 같습니다.</p>
<table>
<caption><span id="tab:fstable">표 6.1: </span>재무제표 테이블 내역</caption>
<thead>
<tr class="header">
<th align="center">순서</th>
<th align="center">내용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">포괄손익계산서 (연간)</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">포괄손익계산서 (분기)</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">재무상태표 (연간)</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">재무상태표 (분기)</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">현금흐름표 (연간)</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">현금흐름표 (분기)</td>
</tr>
</tbody>
</table>
<p>이 중 연간 기준 재무제표에 해당하는 첫 번째, 세 번째, 다섯 번째 테이블을 선택합니다.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">data_IS =<span class="st"> </span>data[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb139-2" data-line-number="2">data_BS =<span class="st"> </span>data[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb139-3" data-line-number="3">data_CF =<span class="st"> </span>data[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb139-4" data-line-number="4"></a>
<a class="sourceLine" id="cb139-5" data-line-number="5"><span class="kw">print</span>(<span class="kw">names</span>(data_IS))</a></code></pre></div>
<pre><code>## [1] &quot;IFRS(연결)&quot;  &quot;2017/12&quot;     &quot;2018/12&quot;    
## [4] &quot;2019/12&quot;     &quot;2020/03&quot;     &quot;전년동기&quot;   
## [7] &quot;전년동기(%)&quot;</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">data_IS =<span class="st"> </span>data_IS[, <span class="dv">1</span><span class="op">:</span>(<span class="kw">ncol</span>(data_IS)<span class="op">-</span><span class="dv">2</span>)]</a></code></pre></div>
<p>포괄손익계산서 테이블(data_IS)에는 전년동기, 전년동기(%) 열이 있는데 통일성을 위해 해당 열을 삭제합니다. 이제 테이블을 묶은 후 클렌징하겠습니다.</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">data_fs =<span class="st"> </span><span class="kw">rbind</span>(data_IS, data_BS, data_CF)</a>
<a class="sourceLine" id="cb142-2" data-line-number="2">data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</a>
<a class="sourceLine" id="cb142-3" data-line-number="3">                    <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb142-4" data-line-number="4">data_fs =<span class="st"> </span>data_fs[<span class="op">!</span><span class="kw">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</a>
<a class="sourceLine" id="cb142-5" data-line-number="5"></a>
<a class="sourceLine" id="cb142-6" data-line-number="6"><span class="kw">rownames</span>(data_fs) =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb142-7" data-line-number="7"><span class="kw">rownames</span>(data_fs) =<span class="st"> </span>data_fs[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb142-8" data-line-number="8">data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb142-9" data-line-number="9"></a>
<a class="sourceLine" id="cb142-10" data-line-number="10">data_fs =<span class="st"> </span>data_fs[, <span class="kw">substr</span>(<span class="kw">colnames</span>(data_fs), <span class="dv">6</span>,<span class="dv">7</span>) <span class="op">==</span><span class="st"> &#39;12&#39;</span>]</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>rbind()</code> 함수를 이용해 세 테이블을 행으로 묶은 후 data_fs에 저장합니다.</li>
<li>첫 번째 열인 계정명에는 ‘계산에 참여한 계정 펼치기’라는 글자가 들어간 항목이 있습니다. 이는 페이지 내에서 펼치기 역할을 하는 (+) 항목에 해당하며 <code>gsub()</code> 함수를 이용해 해당 글자를 삭제합니다.</li>
<li>중복되는 계정명이 다수 있는데 대부분 불필요한 항목입니다. <code>!duplicated()</code> 함수를 사용해 중복되지 않는 계정명만 선택합니다.</li>
<li>행 이름을 초기화한 후 첫 번째 열의 계정명을 행 이름으로 변경합니다. 그 후 첫 번째 열은 삭제합니다.</li>
<li>간혹 12월 결산법인이 아닌 종목이거나 연간 재무제표임에도 불구하고 분기 재무제표가 들어간 경우가 있습니다. 비교의 통일성을 위해 <code>substr()</code> 함수를 이용해 끝 글자가 12인 열, 즉 12월 결산 데이터만 선택합니다.</li>
</ol>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">head</span>(data_fs))</a></code></pre></div>
<pre><code>##                    2017/12   2018/12   2019/12
## 매출액           2,395,754 2,437,714 2,304,009
## 매출원가         1,292,907 1,323,944 1,472,395
## 매출총이익       1,102,847 1,113,770   831,613
## 판매비와관리비     566,397   524,903   553,928
## 인건비              67,972    64,514    64,226
## 유무형자산상각비    13,366    14,477    20,408</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">sapply</span>(data_fs, typeof)</a></code></pre></div>
<pre><code>##     2017/12     2018/12     2019/12 
## &quot;character&quot; &quot;character&quot; &quot;character&quot;</code></pre>
<p>데이터를 확인해보면 연간 기준 재무제표가 정리되었습니다. 문자형 데이터이므로 숫자형으로 변경합니다.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb147-2" data-line-number="2"></a>
<a class="sourceLine" id="cb147-3" data-line-number="3">data_fs =<span class="st"> </span><span class="kw">sapply</span>(data_fs, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb147-4" data-line-number="4">  <span class="kw">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-5" data-line-number="5"><span class="st">    </span><span class="kw">as.numeric</span>()</a>
<a class="sourceLine" id="cb147-6" data-line-number="6">}) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb147-7" data-line-number="7"><span class="st">  </span><span class="kw">data.frame</span>(., <span class="dt">row.names =</span> <span class="kw">rownames</span>(data_fs))</a>
<a class="sourceLine" id="cb147-8" data-line-number="8"></a>
<a class="sourceLine" id="cb147-9" data-line-number="9"><span class="kw">print</span>(<span class="kw">head</span>(data_fs))</a></code></pre></div>
<pre><code>##                  X2017.12 X2018.12 X2019.12
## 매출액            2395754  2437714  2304009
## 매출원가          1292907  1323944  1472395
## 매출총이익        1102847  1113770   831613
## 판매비와관리비     566397   524903   553928
## 인건비              67972    64514    64226
## 유무형자산상각비    13366    14477    20408</code></pre>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">sapply</span>(data_fs, typeof)</a></code></pre></div>
<pre><code>## X2017.12 X2018.12 X2019.12 
## &quot;double&quot; &quot;double&quot; &quot;double&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>sapply()</code> 함수를 이용해 각 열에 stringr 패키지의 <code>str_replace_allr()</code> 함수를 적용해 콤마(,)를 제거한 후 <code>as.numeric()</code> 함수를 통해 숫자형 데이터로 변경합니다.</li>
<li><code>data.frame()</code> 함수를 이용해 데이터 프레임 형태로 만들어주며, 행 이름은 기존 내용을 그대로 유지합니다.</li>
</ol>
<p>정리된 데이터를 출력해보면 문자형이던 데이터가 숫자형으로 변경되었습니다.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw">write.csv</span>(data_fs, <span class="st">&#39;data/KOR_fs/005930_fs.csv&#39;</span>)</a></code></pre></div>
<p>data 폴더의 KOR_fs 폴더 내에 티커_fs.csv 이름으로 저장합니다.</p>
</div>
<div id="가치지표-계산하기" class="section level3">
<h3><span class="header-section-number">6.2.2</span> 가치지표 계산하기</h3>
<p>위에서 구한 재무제표 데이터를 이용해 가치지표를 계산할 수 있습니다. 흔히 사용되는 가치지표는 <strong>PER, PBR, PCR, PSR</strong>이며 분자는 주가, 분모는 재무제표 데이터가 사용됩니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-17">표 6.2: </span>가치지표의 종류
</caption>
<thead>
<tr>
<th style="text-align:center;">
순서
</th>
<th style="text-align:center;">
분모
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
PER
</td>
<td style="text-align:center;">
Earnings (순이익)
</td>
</tr>
<tr>
<td style="text-align:center;">
PBR
</td>
<td style="text-align:center;">
Book Value (순자산)
</td>
</tr>
<tr>
<td style="text-align:center;">
PCR
</td>
<td style="text-align:center;">
Cashflow (영업활동현금흐름)
</td>
</tr>
<tr>
<td style="text-align:center;">
PSR
</td>
<td style="text-align:center;">
Sales (매출액)
</td>
</tr>
</tbody>
</table>
<p>위에서 구한 재무제표 항목에서 분모 부분에 해당하는 데이터만 선택해보겠습니다.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb152-2" data-line-number="2">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">value_type =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>,</a>
<a class="sourceLine" id="cb154-2" data-line-number="2">               <span class="st">&#39;자본&#39;</span>,</a>
<a class="sourceLine" id="cb154-3" data-line-number="3">               <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>,</a>
<a class="sourceLine" id="cb154-4" data-line-number="4">               <span class="st">&#39;매출액&#39;</span>)</a>
<a class="sourceLine" id="cb154-5" data-line-number="5"></a>
<a class="sourceLine" id="cb154-6" data-line-number="6">value_index =<span class="st"> </span>data_fs[<span class="kw">match</span>(value_type, <span class="kw">rownames</span>(data_fs)),</a>
<a class="sourceLine" id="cb154-7" data-line-number="7">                      <span class="kw">ncol</span>(data_fs)]</a>
<a class="sourceLine" id="cb154-8" data-line-number="8"><span class="kw">print</span>(value_index)</a></code></pre></div>
<pre><code>## [1]  215051 2628804  453829 2304009</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_value 폴더를 생성합니다.</li>
<li>분모에 해당하는 항목을 저장한 후 <code>match()</code> 함수를 이용해 해당 항목이 위치하는 지점을 찾습니다. <code>ncol()</code> 함수를 이용해 맨 오른쪽, 즉 최근년도 재무제표 데이터를 선택합니다.</li>
</ol>
<p>다음으로 분자 부분에 해당하는 현재 주가를 수집해야 합니다. 이 역시 Company Guide 접속 화면에서 구할 수 있습니다. 불필요한 부분을 제거한 URL은 다음과 같습니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>위의 주소 역시 A 뒤의 6자리 티커만 변경하면 해당 종목의 스냅샷 페이지로 이동하게 됩니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/crawl_practice_comp_price.png" alt="Company Guide 스냅샷 화면" width="70%" />
<p class="caption">
그림 2.12: Company Guide 스냅샷 화면
</p>
</div>
<p>주가추이 부분에 우리가 원하는 현재 주가가 있습니다. 해당 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb156-1" data-line-number="1">/<span class="co">/*[@id=&quot;svdMainChartTxt11&quot;]</span></a></code></pre></div>
<style type="text/css">
//*[@id="svdMainChartTxt11"]
</style>
<p>위에서 구한 주가의 Xpath를 이용해 해당 데이터를 크롤링하겠습니다.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb157-2" data-line-number="2"></a>
<a class="sourceLine" id="cb157-3" data-line-number="3">url =<span class="st"> &#39;http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930&#39;</span></a>
<a class="sourceLine" id="cb157-4" data-line-number="4">data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb157-5" data-line-number="5">           <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb157-6" data-line-number="6"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb157-7" data-line-number="7"></a>
<a class="sourceLine" id="cb157-8" data-line-number="8">price =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-9" data-line-number="9"><span class="st">  </span><span class="kw">html_node</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-10" data-line-number="10"><span class="st">  </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb157-11" data-line-number="11"><span class="st">  </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb157-12" data-line-number="12"></a>
<a class="sourceLine" id="cb157-13" data-line-number="13"><span class="kw">print</span>(price)</a></code></pre></div>
<pre><code>## [1] 50700</code></pre>
<ol style="list-style-type: decimal">
<li>url을 입력한 후, <code>GET()</code> 함수를 이용해 데이터를 불러오며, 역시나 user_agent를 추가해 줍니다.</li>
<li><code>read_html()</code> 함수를 이용해 HTML 데이터를 불러온 후 <code>html_node()</code> 함수에 앞서 구한 Xpath를 입력해 해당 지점의 데이터를 추출합니다.</li>
<li><code>html_text()</code> 함수를 통해 텍스트 데이터만을 추출하며, readr 패키지의 <code>parse_number()</code> 함수를 적용합니다. 해당 함수는 문자형 데이터에서 콤마와 같은 불필요한 문자를 제거한 후 숫자형 데이터로 변경해줍니다.</li>
</ol>
<p>가치지표를 계산하려면 발행주식수 역시 필요합니다. 예를 들어 PER를 계산하는 방법은 다음과 같습니다.</p>
<p><span class="math display">\[ PER = Price / EPS  = 주가 / 주당순이익\]</span></p>
<p>주당순이익은 순이익을 전체 주식수로 나눈 값이므로, 해당 값의 계산하려면 전체 주식수를 구해야 합니다. 전체 주식수 데이터 역시 웹페이지에 있으므로 앞서 주가를 크롤링한 방법과 동일한 방법으로 구할 수 있습니다. 전체 주식수 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb159-1" data-line-number="1">/<span class="co">/*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]</span></a></code></pre></div>
<style type="text/css">
//*[@id="svdMainGrid1"]/table/tbody/tr[7]/td[1]
</style>
<p>이를 이용해 발행주식수 중 보통주를 선택하는 방법은 다음과 같습니다.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">share =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-2" data-line-number="2"><span class="st">  </span><span class="kw">html_node</span>(</a>
<a class="sourceLine" id="cb160-3" data-line-number="3">    <span class="dt">xpath =</span></a>
<a class="sourceLine" id="cb160-4" data-line-number="4">      <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb160-5" data-line-number="5"><span class="st">  </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb160-6" data-line-number="6"></a>
<a class="sourceLine" id="cb160-7" data-line-number="7"><span class="kw">print</span>(share)</a></code></pre></div>
<pre><code>## [1] &quot;5,969,782,550/ 822,886,700&quot;</code></pre>
<p><code>read_html()</code> 함수와 <code>html_node()</code> 함수를 이용해, HTML 내에서 Xpath에 해당하는 데이터를 추출합니다. 그 후 <code>html_text()</code> 함수를 통해 텍스트 부분만 추출합니다. 해당 과정을 거치면 보통주/우선주의 형태로 발행주식주가 저장됩니다. 이 중 우리가 원하는 데이터는 / 앞에 있는 보통주 발행주식수입니다.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">share =<span class="st"> </span>share <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="st">  </span><span class="kw">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-4" data-line-number="4"><span class="st">  </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb162-5" data-line-number="5"><span class="st">  </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb162-6" data-line-number="6"></a>
<a class="sourceLine" id="cb162-7" data-line-number="7"><span class="kw">print</span>(share)</a></code></pre></div>
<pre><code>## [1] 5969782550</code></pre>
<ol style="list-style-type: decimal">
<li><code>strsplit()</code> 함수를 통해 /를 기준으로 데이터를 나눕니다. 해당 결과는 리스트 형태로 저장됩니다.</li>
<li><code>unlist()</code> 함수를 통해 리스트를 벡터 형태로 변환합니다.</li>
<li><code>.[1]</code>.[1]을 통해 보통주 발행주식수인 첫 번째 데이터를 선택합니다.</li>
<li><code>parse_number()</code> 함수를 통해 문자형 데이터를 숫자형으로 변환합니다.</li>
</ol>
<p>재무 데이터, 현재 주가, 발행주식수를 이용해 가치지표를 계산해보겠습니다.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">data_value =<span class="st"> </span>price <span class="op">/</span><span class="st"> </span>(value_index <span class="op">*</span><span class="st"> </span><span class="dv">100000000</span> <span class="op">/</span><span class="st"> </span>share)</a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="kw">names</span>(data_value) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</a>
<a class="sourceLine" id="cb164-3" data-line-number="3">data_value[data_value <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb164-4" data-line-number="4"></a>
<a class="sourceLine" id="cb164-5" data-line-number="5"><span class="kw">print</span>(data_value)</a></code></pre></div>
<pre><code>##    PER    PBR    PCR    PSR 
## 14.074  1.151  6.669  1.314</code></pre>
<p>분자에는 현재 주가를 입력하며, 분모에는 재무 데이터를 보통주 발행주식수로 나눈 값을 입력합니다. 단, 주가는 원 단위, 재무 데이터는 억 원 단위이므로, 둘 사이에 단위를 동일하게 맞춰주기 위해 분모에 억을 곱합니다. 또한 가치지표가 음수인 경우는 NA로 변경해줍니다.</p>
<p>결과를 확인해보면 4가지 가치지표가 잘 계산되었습니다.<a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a></p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1"><span class="kw">write.csv</span>(data_value, <span class="st">&#39;data/KOR_value/005930_value.csv&#39;</span>)</a></code></pre></div>
<p>data 폴더의 KOR_value 폴더 내에 티커_value.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-재무제표-및-가치지표-다운로드" class="section level3">
<h3><span class="header-section-number">6.2.3</span> 전 종목 재무제표 및 가치지표 다운로드</h3>
<p>위 코드에서 for loop 구문을 이용해 URL 중 6자리 티커에 해당하는 값만 변경해주면 모든 종목의 재무제표를 다운로드하고 이를 바탕으로 가치지표를 계산할 수 있습니다. 해당 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb167-2" data-line-number="2"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb167-4" data-line-number="4"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb167-5" data-line-number="5"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb167-6" data-line-number="6"></a>
<a class="sourceLine" id="cb167-7" data-line-number="7">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb167-8" data-line-number="8">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb167-9" data-line-number="9"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>,<span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb167-10" data-line-number="10"></a>
<a class="sourceLine" id="cb167-11" data-line-number="11"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb167-12" data-line-number="12">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</a>
<a class="sourceLine" id="cb167-13" data-line-number="13"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb167-14" data-line-number="14">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</a>
<a class="sourceLine" id="cb167-15" data-line-number="15"></a>
<a class="sourceLine" id="cb167-16" data-line-number="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(KOR_ticker) ) {</a>
<a class="sourceLine" id="cb167-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb167-18" data-line-number="18">  data_fs =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb167-19" data-line-number="19">  data_value =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb167-20" data-line-number="20">  name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i]</a>
<a class="sourceLine" id="cb167-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb167-22" data-line-number="22">  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></a>
<a class="sourceLine" id="cb167-23" data-line-number="23">  <span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb167-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb167-25" data-line-number="25">    <span class="kw">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;English&#39;</span>)</a>
<a class="sourceLine" id="cb167-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb167-27" data-line-number="27">    <span class="co"># url 생성</span></a>
<a class="sourceLine" id="cb167-28" data-line-number="28">    url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb167-29" data-line-number="29">      <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/&#39;</span></a>
<a class="sourceLine" id="cb167-30" data-line-number="30">      ,<span class="st">&#39;SVD_Finance.asp?pGB=1&amp;gicode=A&#39;</span>,</a>
<a class="sourceLine" id="cb167-31" data-line-number="31">      name)</a>
<a class="sourceLine" id="cb167-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb167-33" data-line-number="33">    <span class="co"># 이 후 과정은 위와 동일함</span></a>
<a class="sourceLine" id="cb167-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb167-35" data-line-number="35">    <span class="co"># 데이터 다운로드 후 테이블 추출</span></a>
<a class="sourceLine" id="cb167-36" data-line-number="36">    data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb167-37" data-line-number="37">               <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb167-38" data-line-number="38"><span class="st">                          AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-39" data-line-number="39"><span class="st">      </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-40" data-line-number="40"><span class="st">      </span><span class="kw">html_table</span>()</a>
<a class="sourceLine" id="cb167-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb167-42" data-line-number="42">    <span class="kw">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;Korean&#39;</span>)</a>
<a class="sourceLine" id="cb167-43" data-line-number="43">    </a>
<a class="sourceLine" id="cb167-44" data-line-number="44">    <span class="co"># 3개 재무제표를 하나로 합치기</span></a>
<a class="sourceLine" id="cb167-45" data-line-number="45">    data_IS =<span class="st"> </span>data[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb167-46" data-line-number="46">    data_BS =<span class="st"> </span>data[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb167-47" data-line-number="47">    data_CF =<span class="st"> </span>data[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb167-48" data-line-number="48">    </a>
<a class="sourceLine" id="cb167-49" data-line-number="49">    data_IS =<span class="st"> </span>data_IS[, <span class="dv">1</span><span class="op">:</span>(<span class="kw">ncol</span>(data_IS)<span class="op">-</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb167-50" data-line-number="50">    data_fs =<span class="st"> </span><span class="kw">rbind</span>(data_IS, data_BS, data_CF)</a>
<a class="sourceLine" id="cb167-51" data-line-number="51">    </a>
<a class="sourceLine" id="cb167-52" data-line-number="52">    <span class="co"># 데이터 클랜징</span></a>
<a class="sourceLine" id="cb167-53" data-line-number="53">    data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</a>
<a class="sourceLine" id="cb167-54" data-line-number="54">                        <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb167-55" data-line-number="55">    data_fs =<span class="st"> </span>data_fs[<span class="op">!</span><span class="kw">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</a>
<a class="sourceLine" id="cb167-56" data-line-number="56">    </a>
<a class="sourceLine" id="cb167-57" data-line-number="57">    <span class="kw">rownames</span>(data_fs) =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb167-58" data-line-number="58">    <span class="kw">rownames</span>(data_fs) =<span class="st"> </span>data_fs[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb167-59" data-line-number="59">    data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb167-60" data-line-number="60">    </a>
<a class="sourceLine" id="cb167-61" data-line-number="61">    <span class="co"># 12월 재무제표만 선택</span></a>
<a class="sourceLine" id="cb167-62" data-line-number="62">    data_fs =</a>
<a class="sourceLine" id="cb167-63" data-line-number="63"><span class="st">      </span>data_fs[, <span class="kw">substr</span>(<span class="kw">colnames</span>(data_fs), <span class="dv">6</span>,<span class="dv">7</span>) <span class="op">==</span><span class="st"> &quot;12&quot;</span>]</a>
<a class="sourceLine" id="cb167-64" data-line-number="64">    </a>
<a class="sourceLine" id="cb167-65" data-line-number="65">    data_fs =<span class="st"> </span><span class="kw">sapply</span>(data_fs, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb167-66" data-line-number="66">      <span class="kw">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-67" data-line-number="67"><span class="st">        </span><span class="kw">as.numeric</span>()</a>
<a class="sourceLine" id="cb167-68" data-line-number="68">    }) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-69" data-line-number="69"><span class="st">      </span><span class="kw">data.frame</span>(., <span class="dt">row.names =</span> <span class="kw">rownames</span>(data_fs))</a>
<a class="sourceLine" id="cb167-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb167-71" data-line-number="71">    </a>
<a class="sourceLine" id="cb167-72" data-line-number="72">    <span class="co"># 가치지표 분모부분</span></a>
<a class="sourceLine" id="cb167-73" data-line-number="73">    value_type =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>, </a>
<a class="sourceLine" id="cb167-74" data-line-number="74">                   <span class="st">&#39;자본&#39;</span>, </a>
<a class="sourceLine" id="cb167-75" data-line-number="75">                   <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>, </a>
<a class="sourceLine" id="cb167-76" data-line-number="76">                   <span class="st">&#39;매출액&#39;</span>) </a>
<a class="sourceLine" id="cb167-77" data-line-number="77">    </a>
<a class="sourceLine" id="cb167-78" data-line-number="78">    <span class="co"># 해당 재무데이터만 선택</span></a>
<a class="sourceLine" id="cb167-79" data-line-number="79">    value_index =<span class="st"> </span>data_fs[<span class="kw">match</span>(value_type, <span class="kw">rownames</span>(data_fs)),</a>
<a class="sourceLine" id="cb167-80" data-line-number="80">                          <span class="kw">ncol</span>(data_fs)]</a>
<a class="sourceLine" id="cb167-81" data-line-number="81">    </a>
<a class="sourceLine" id="cb167-82" data-line-number="82">    <span class="co"># Snapshot 페이지 불러오기</span></a>
<a class="sourceLine" id="cb167-83" data-line-number="83">    url =</a>
<a class="sourceLine" id="cb167-84" data-line-number="84"><span class="st">      </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb167-85" data-line-number="85">        <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Main.asp&#39;</span>,</a>
<a class="sourceLine" id="cb167-86" data-line-number="86">        <span class="st">&#39;?pGB=1&amp;gicode=A&#39;</span>,name)</a>
<a class="sourceLine" id="cb167-87" data-line-number="87">    data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb167-88" data-line-number="88">               <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb167-89" data-line-number="89"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb167-90" data-line-number="90">    </a>
<a class="sourceLine" id="cb167-91" data-line-number="91">    <span class="co"># 현재 주가 크롤링</span></a>
<a class="sourceLine" id="cb167-92" data-line-number="92">    price =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-93" data-line-number="93"><span class="st">      </span><span class="kw">html_node</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-94" data-line-number="94"><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-95" data-line-number="95"><span class="st">      </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb167-96" data-line-number="96">    </a>
<a class="sourceLine" id="cb167-97" data-line-number="97">    <span class="co"># 보통주 발행주식수 크롤링</span></a>
<a class="sourceLine" id="cb167-98" data-line-number="98">    share =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-99" data-line-number="99"><span class="st">      </span><span class="kw">html_node</span>(</a>
<a class="sourceLine" id="cb167-100" data-line-number="100">        <span class="dt">xpath =</span></a>
<a class="sourceLine" id="cb167-101" data-line-number="101">        <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-102" data-line-number="102"><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-103" data-line-number="103"><span class="st">      </span><span class="kw">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-104" data-line-number="104"><span class="st">      </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-105" data-line-number="105"><span class="st">      </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb167-106" data-line-number="106"><span class="st">      </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb167-107" data-line-number="107">    </a>
<a class="sourceLine" id="cb167-108" data-line-number="108">    <span class="co"># 가치지표 계산</span></a>
<a class="sourceLine" id="cb167-109" data-line-number="109">    data_value =<span class="st"> </span>price <span class="op">/</span><span class="st"> </span>(value_index <span class="op">*</span><span class="st"> </span><span class="dv">100000000</span><span class="op">/</span><span class="st"> </span>share)</a>
<a class="sourceLine" id="cb167-110" data-line-number="110">    <span class="kw">names</span>(data_value) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</a>
<a class="sourceLine" id="cb167-111" data-line-number="111">    data_value[data_value <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb167-112" data-line-number="112">    </a>
<a class="sourceLine" id="cb167-113" data-line-number="113">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb167-114" data-line-number="114">    </a>
<a class="sourceLine" id="cb167-115" data-line-number="115">    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></a>
<a class="sourceLine" id="cb167-116" data-line-number="116">    data_fs &lt;&lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb167-117" data-line-number="117">    data_value &lt;&lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb167-118" data-line-number="118">    <span class="kw">warning</span>(<span class="kw">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</a>
<a class="sourceLine" id="cb167-119" data-line-number="119">  })</a>
<a class="sourceLine" id="cb167-120" data-line-number="120">  </a>
<a class="sourceLine" id="cb167-121" data-line-number="121">  <span class="co"># 다운로드 받은 파일을 생성한 각각의 폴더 내 csv 파일로 저장</span></a>
<a class="sourceLine" id="cb167-122" data-line-number="122">  </a>
<a class="sourceLine" id="cb167-123" data-line-number="123">  <span class="co"># 재무제표 저장</span></a>
<a class="sourceLine" id="cb167-124" data-line-number="124">  <span class="kw">write.csv</span>(data_fs, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_fs/&#39;</span>, name, <span class="st">&#39;_fs.csv&#39;</span>))</a>
<a class="sourceLine" id="cb167-125" data-line-number="125">  </a>
<a class="sourceLine" id="cb167-126" data-line-number="126">  <span class="co"># 가치지표 저장</span></a>
<a class="sourceLine" id="cb167-127" data-line-number="127">  <span class="kw">write.csv</span>(data_value, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_value/&#39;</span>, name,</a>
<a class="sourceLine" id="cb167-128" data-line-number="128">                               <span class="st">&#39;_value.csv&#39;</span>))</a>
<a class="sourceLine" id="cb167-129" data-line-number="129">  </a>
<a class="sourceLine" id="cb167-130" data-line-number="130">  <span class="co"># 2초간 타임슬립 적용</span></a>
<a class="sourceLine" id="cb167-131" data-line-number="131">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb167-132" data-line-number="132">}</a></code></pre></div>
<p>전 종목 주가 데이터를 받는 과정과 동일하게 KOR_ticker.csv 파일을 불러온 후 for loop를 통해 i 값이 변함에 따라 티커를 변경해가며 모든 종목의 재무제표 및 가치지표를 다운로드합니다. <code>tryCatch()</code> 함수를 이용해 오류가 발생하면 NA로 이루어진 빈 데이터를 저장한 후 다음 루프로 넘어가게 됩니다. data/KOR_fs 폴더에는 전 종목의 재무제표 데이터가 저장되고, data/KOR_value 폴더에는 전 종목의 가치지표 데이터가 csv 형태로 저장됩니다.</p>
</div>
</div>
<div id="dart의-open-api를-이용한-데이터-수집하기" class="section level2">
<h2><span class="header-section-number">6.3</span> DART의 Open API를 이용한 데이터 수집하기</h2>
<p>DART(Data Analysis, Retrieval and Transfer System)는 금융감독원 전자공시시스템으로써, 상장법인 등이 공시서류를 인터넷으로 제출하고, 투자자 등 이용자는 제출 즉시 인터넷을 통해 조회할 수 있도록 하는 종합적 기업공시 시스템입니다. 홈페이지에서도 각종 공시내역을 확인할 수 있지만, 해당 사이트에서 제공하는 API를 이용할 경우 더욱 쉽게 공시 내용을 수집할 수 있습니다.</p>
<div id="api-key발급-및-추가하기" class="section level3">
<h3><span class="header-section-number">6.3.1</span> API Key발급 및 추가하기</h3>
<p>먼저 <a href="https://opendart.fss.or.kr/에" class="uri">https://opendart.fss.or.kr/에</a> 접속한 후 [인증키 신청/관리] → [인증키 신청]을 통해 API Key를 발급 받습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-28"></span>
<img src="images/dart_api_key.png" alt="OpenAPI 인증키 신청" width="70%" />
<p class="caption">
그림 6.1: OpenAPI 인증키 신청
</p>
</div>
<p>계정을 생성하고 이메일을 통해 이용자 등록을 한 후 로그인을 합니다. 그 후 [오픈API 이용현황]을 살펴보면 <strong>API Key</strong> 부분에 발급받은 Key가 있으며, 금일 몇번의 API를 요청했는지가 일일이용현황에 나옵니다. 하루 총 10,000번까지 데이터를 요청할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-29"></span>
<img src="images/dart_api_status.png" alt="OpenAPI 이용현황" width="70%" />
<p class="caption">
그림 6.2: OpenAPI 이용현황
</p>
</div>
<p>다음으로 발급받은 API Key를 <strong>.Renviron</strong> 파일에 추가하도록 합니다. 해당 파일에는 여러 패스워드를 추가해 안전하게 관리할 수 있습니다.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="kw">file.edit</span>(<span class="st">&quot;~/.Renviron&quot;</span>)</a></code></pre></div>
<p><strong>.Renviron</strong> 파일이 열리면 다음과 같이 입력을 해줍니다.</p>
<pre><code>dart_api_key = &#39;발급받은 API&#39;</code></pre>
<p>파일을 저장한 후 해당 파일을 적용하기 위해 <strong>R을 Session을 재시작합니다.</strong> 그 후 아래 명령어를 실행하여 API Key를 불러오도록 합니다. (재시작하지 않으면 Key를 불러올 수 없습니다.)</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">dart_api =<span class="st"> </span><span class="kw">Sys.getenv</span>(<span class="st">&quot;dart_api_key&quot;</span>)</a></code></pre></div>
</div>
<div id="고유번호-다운로드" class="section level3">
<h3><span class="header-section-number">6.3.2</span> 고유번호 다운로드</h3>
<p>Open API에서 각 기업의 데이터를 받기 위해서는 종목에 해당하는 고유번호를 알아야 합니다. 이에 대한 개발가이드는 아래 페이지에 나와 있습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019018" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019018</a></p>
<p>위 페이지의 내용을 코드로 나타내보도록 합니다.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb171-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb171-3" data-line-number="3"></a>
<a class="sourceLine" id="cb171-4" data-line-number="4">codezip_url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb171-5" data-line-number="5">  <span class="st">&#39;https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=&#39;</span>,dart_api)</a>
<a class="sourceLine" id="cb171-6" data-line-number="6"></a>
<a class="sourceLine" id="cb171-7" data-line-number="7">codezip_data =<span class="st"> </span><span class="kw">GET</span>(codezip_url)</a>
<a class="sourceLine" id="cb171-8" data-line-number="8"><span class="kw">print</span>(codezip_data)</a></code></pre></div>
<pre><code>## Response [https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=b1a630e527b0e5ff5bd58ed81b49825017fa80b8]
##   Date: 2020-05-31 03:47
##   Status: 200
##   Content-Type: application/x-msdownload
##   Size: 1.38 MB
## &lt;BINARY BODY&gt;</code></pre>
<pre><code>## NULL</code></pre>
<ol style="list-style-type: decimal">
<li><strong><a href="https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=" class="uri">https://opendart.fss.or.kr/api/corpCode.xml?crtfc_key=</a></strong> 뒤에 본인의 API 키를 입력합니다.</li>
<li><code>GET()</code> 함수를 통해 해당 페이지 내용을 받습니다.</li>
</ol>
<p>다운로드 받은 내용을 확인해보면 <BINARY BODY>, 즉 바이너리 형태의 데이터가 첨부되어 있습니다. 이에 대해 좀더 자세히 알아보도록 하겠습니다.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1">codezip_data<span class="op">$</span>headers[[<span class="st">&quot;content-disposition&quot;</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;: attachment; filename=CORPCODE.zip&quot;</code></pre>
<p>headers의 “content-disposition” 부분을 확인해보면 <strong>CORPCODE.zip</strong> 파일이 첨부되어 있습니다. 해당 파일의 압축을 풀어 첨부된 내용을 확인합니다.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" data-line-number="1">tf =<span class="st"> </span><span class="kw">tempfile</span>(<span class="dt">fileext =</span> <span class="st">&#39;.zip&#39;</span>)</a>
<a class="sourceLine" id="cb176-2" data-line-number="2"></a>
<a class="sourceLine" id="cb176-3" data-line-number="3"><span class="kw">writeBin</span>(</a>
<a class="sourceLine" id="cb176-4" data-line-number="4">  <span class="kw">content</span>(codezip_data, <span class="dt">as =</span> <span class="st">&quot;raw&quot;</span>),</a>
<a class="sourceLine" id="cb176-5" data-line-number="5">  <span class="kw">file.path</span>(tf)</a>
<a class="sourceLine" id="cb176-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb176-7" data-line-number="7"></a>
<a class="sourceLine" id="cb176-8" data-line-number="8">nm =<span class="st"> </span><span class="kw">unzip</span>(tf, <span class="dt">list =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb176-9" data-line-number="9"><span class="kw">print</span>(nm)</a></code></pre></div>
<pre><code>##           Name   Length                Date
## 1 CORPCODE.xml 16026472 2020-05-27 11:24:00</code></pre>
<ol style="list-style-type: decimal">
<li><code>tempfile()</code> 함수 통해 빈 .zip 파일을 만듭니다.</li>
<li><code>writeBin()</code> 함수는 바이너리 형태의 파일을 저장하는 함수이며, <code>content()</code>를 통해 첨부 파일 내용을 raw 형태로 저장합니다. 파일명은 위에서 만든 tf로 합니다.</li>
<li><code>unzip()</code> 함수를 통해 zip 내 파일 리스트를 확인합니다.</li>
</ol>
<p>zip 파일 내에는 CORPCODE.xml 파일이 있으며, <code>read_xml()</code> 함수를 통해 이를 불러오도록 합니다.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1">code_data =<span class="st"> </span><span class="kw">read_xml</span>(<span class="kw">unzip</span>(tf, nm<span class="op">$</span>Name))</a>
<a class="sourceLine" id="cb178-2" data-line-number="2"><span class="kw">print</span>(code_data)</a></code></pre></div>
<pre><code>## {xml_document}
## &lt;result&gt;
##  [1] &lt;list&gt;\n  &lt;corp_code&gt;00434003&lt;/corp_code&gt;\n  &lt;co ...
##  [2] &lt;list&gt;\n  &lt;corp_code&gt;00434456&lt;/corp_code&gt;\n  &lt;co ...
##  [3] &lt;list&gt;\n  &lt;corp_code&gt;00430964&lt;/corp_code&gt;\n  &lt;co ...
##  [4] &lt;list&gt;\n  &lt;corp_code&gt;00432403&lt;/corp_code&gt;\n  &lt;co ...
##  [5] &lt;list&gt;\n  &lt;corp_code&gt;00388953&lt;/corp_code&gt;\n  &lt;co ...
##  [6] &lt;list&gt;\n  &lt;corp_code&gt;00179984&lt;/corp_code&gt;\n  &lt;co ...
##  [7] &lt;list&gt;\n  &lt;corp_code&gt;00420143&lt;/corp_code&gt;\n  &lt;co ...
##  [8] &lt;list&gt;\n  &lt;corp_code&gt;00401111&lt;/corp_code&gt;\n  &lt;co ...
##  [9] &lt;list&gt;\n  &lt;corp_code&gt;00435534&lt;/corp_code&gt;\n  &lt;co ...
## [10] &lt;list&gt;\n  &lt;corp_code&gt;00430186&lt;/corp_code&gt;\n  &lt;co ...
## [11] &lt;list&gt;\n  &lt;corp_code&gt;00430201&lt;/corp_code&gt;\n  &lt;co ...
## [12] &lt;list&gt;\n  &lt;corp_code&gt;00430210&lt;/corp_code&gt;\n  &lt;co ...
## [13] &lt;list&gt;\n  &lt;corp_code&gt;00430229&lt;/corp_code&gt;\n  &lt;co ...
## [14] &lt;list&gt;\n  &lt;corp_code&gt;00140432&lt;/corp_code&gt;\n  &lt;co ...
## [15] &lt;list&gt;\n  &lt;corp_code&gt;00426208&lt;/corp_code&gt;\n  &lt;co ...
## [16] &lt;list&gt;\n  &lt;corp_code&gt;00433262&lt;/corp_code&gt;\n  &lt;co ...
## [17] &lt;list&gt;\n  &lt;corp_code&gt;00433749&lt;/corp_code&gt;\n  &lt;co ...
## [18] &lt;list&gt;\n  &lt;corp_code&gt;00433785&lt;/corp_code&gt;\n  &lt;co ...
## [19] &lt;list&gt;\n  &lt;corp_code&gt;00196079&lt;/corp_code&gt;\n  &lt;co ...
## [20] &lt;list&gt;\n  &lt;corp_code&gt;00435048&lt;/corp_code&gt;\n  &lt;co ...
## ...</code></pre>
<p>해당 파일은 HTML 형식으로 되어 있으며 중요부분은 다음과 같습니다.</p>
<ul>
<li>corp_code: 고유번호</li>
<li>corp_name: 종목명</li>
<li>corp_stock: 거래소 상장 티커</li>
</ul>
<p>HTML의 태그를 이용해 각 부분을 추출한 후 하나의 데이터로 합치도록 하겠습니다.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1">corp_code =<span class="st"> </span>code_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&#39;corp_code&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb180-2" data-line-number="2">corp_name =<span class="st"> </span>code_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&#39;corp_name&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb180-3" data-line-number="3">corp_stock =<span class="st"> </span>code_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_nodes</span>(<span class="st">&#39;stock_code&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb180-4" data-line-number="4"></a>
<a class="sourceLine" id="cb180-5" data-line-number="5">corp_list =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb180-6" data-line-number="6">  <span class="st">&#39;code&#39;</span> =<span class="st"> </span>corp_code,</a>
<a class="sourceLine" id="cb180-7" data-line-number="7">  <span class="st">&#39;name&#39;</span> =<span class="st"> </span>corp_name,</a>
<a class="sourceLine" id="cb180-8" data-line-number="8">  <span class="st">&#39;stock&#39;</span> =<span class="st"> </span>corp_stock,</a>
<a class="sourceLine" id="cb180-9" data-line-number="9">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb180-10" data-line-number="10">)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>html_nodes()</code> 함수를 이용해 고유번호, 종목명, 상장티커를 선택한 후, <code>html_text()</code> 함수를 이용해 문자열만 추출하도록 합니다.</li>
<li><code>data.frame()</code> 함수를 통해 데이터프레임 형식으로 묶어주도록 합니다.</li>
</ol>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="kw">nrow</span>(corp_list)</a></code></pre></div>
<pre><code>## [1] 80662</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1"><span class="kw">head</span>(corp_list)</a></code></pre></div>
<pre><code>##       code                               name stock
## 1 00434003                               다코      
## 2 00434456                           일산약품      
## 3 00430964                         굿앤엘에스      
## 4 00432403                           한라판지      
## 5 00388953 크레디피아제이십오차유동화전문회사      
## 6 00179984                       연방건설산업</code></pre>
<p>종목수를 확인해보면 80662 개가 확인되며, 이 중 stock 열이 빈 종목은 거래소에 상장되지 않은 종목입니다. 따라서 해당 데이터는 삭제하여 거래소 상장 종목만을 남긴 후, csv 파일로 저장하도록 합니다.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">corp_list =<span class="st"> </span>corp_list[corp_list<span class="op">$</span>stock <span class="op">!=</span><span class="st"> &quot; &quot;</span>, ]</a>
<a class="sourceLine" id="cb185-2" data-line-number="2"></a>
<a class="sourceLine" id="cb185-3" data-line-number="3"><span class="kw">write.csv</span>(corp_list, <span class="st">&#39;data/corp_list.csv&#39;</span>)</a></code></pre></div>
</div>
<div id="공시검색" class="section level3">
<h3><span class="header-section-number">6.3.3</span> 공시검색</h3>
<div id="전체-공시-검색" class="section level4">
<h4><span class="header-section-number">6.3.3.1</span> 전체 공시 검색</h4>
<p>먼저 공시검색 API에 대한 이해를 위해 전체 종목의 공시를 수집하도록 하며, 해당 개발가이드는 아래 페이지에 나와 있습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019001" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS001&amp;apiId=2019001</a></p>
<p>각종 요청인자를 통해 url을 생성 후 전송하여, 요청에 맞는 데이터를 받을 수 있습니다. 공시 검색에 해당하는 인자는 다음과 같습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-39"></span>
<img src="images/dart_api_input.png" alt="OpenAPI 요청 인자 예시" width="70%" />
<p class="caption">
그림 6.3: OpenAPI 요청 인자 예시
</p>
</div>
<p>페이지 하단에서 인자를 입력 후 [검색]을 누르면 각 인자에 맞게 생성된 url과 그 결과를 볼 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-40"></span>
<img src="images/dart_api_exam.png" alt="OpenAPI 테스트 예시" width="70%" />
<p class="caption">
그림 6.4: OpenAPI 테스트 예시
</p>
</div>
<p>먼저 시작일과 종료일을 토대로 최근 공시 100건에 해당하는 url을 생성하도록 하겠습니다.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb186-2" data-line-number="2"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb186-3" data-line-number="3"><span class="kw">library</span>(jsonlite)</a>
<a class="sourceLine" id="cb186-4" data-line-number="4"></a>
<a class="sourceLine" id="cb186-5" data-line-number="5">bgn_date =<span class="st"> </span>(<span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">7</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb186-6" data-line-number="6">end_date =<span class="st"> </span>(<span class="kw">Sys.Date</span>() ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb186-7" data-line-number="7">notice_url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/list.json?crtfc_key=&#39;</span>,dart_api,<span class="st">&#39;&amp;bgn_de=&#39;</span>,</a>
<a class="sourceLine" id="cb186-8" data-line-number="8">                    bgn_date,<span class="st">&#39;&amp;end_de=&#39;</span>,end_date,<span class="st">&#39;&amp;page_no=1&amp;page_count=100&#39;</span>)</a></code></pre></div>
<p>bgn_date에는 현재로부터 일주일 전을, end_date는 오늘 날짜를, 페이지별 건수에 해당하는 page_count에는 100을 입력하도록 합니다. 그 후 홈페이지에 나와있는 예시에 맞게 url을 작성해주도록 합니다. XML 보다는 JSON 형식으로 url을 생성 후 요청하는 것이 데이터 처리 측면에서 훨씬 효율적입니다.</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">notice_data =<span class="st"> </span><span class="kw">fromJSON</span>(notice_url) </a>
<a class="sourceLine" id="cb187-2" data-line-number="2">notice_data =<span class="st"> </span>notice_data[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb187-3" data-line-number="3"></a>
<a class="sourceLine" id="cb187-4" data-line-number="4"><span class="kw">head</span>(notice_data)</a></code></pre></div>
<pre><code>##   corp_code     corp_name stock_code corp_cls
## 1  01243550 IBKS제7호스팩     276920        K
## 2  00201432    비츠로시스     054220        K
## 3  00199252    에이치엘비     028300        K
## 4  00609634        아이엠     101390        K
## 5  01070149      올리패스     244460        K
## 6  01267550    나라소프트     288490        N
##                                                                          report_nm
## 1                                                 기타시장안내(상장폐지 우려 예고)
## 2                                             기타시장안내(최대주주의의무보유관련)
## 3                                   유상증자또는주식관련사채등의청약결과(자율공시)
## 4                                                 [기재정정]타인에대한채무보증결정
## 5 투자판단관련주요경영사항(비마약성진통제(OLP-1002) 호주 임상 1b상 시험 계획 신청)
## 6                                                   주식명의개서정지(주주명부폐쇄)
##         rcept_no         flr_nm rcept_dt rm
## 1 20200529900833 코스닥시장본부 20200529 코
## 2 20200529900829 코스닥시장본부 20200529 코
## 3 20200529900828     에이치엘비 20200529 코
## 4 20200529900826         아이엠 20200529 코
## 5 20200529900825       올리패스 20200529 코
## 6 20200529600823     나라소프트 20200529 넥</code></pre>
<p><code>fromJSON()</code> 함수를 통해 JSON 데이터를 받은 후 list를 확인해보면 우리가 원하는 공시정보, 즉 일주일 전부터 100건의 공시 정보가 다운로드 되어 있습니다.</p>
</div>
<div id="특정-기업의-공시-검색" class="section level4">
<h4><span class="header-section-number">6.3.3.2</span> 특정 기업의 공시 검색</h4>
<p>이번에는 고유번호를 추가하여 원하는 기업의 공시만 확인해보록 하겠습니다. 고유번호는 위에서 다운받은 <strong>corp_list.csv</strong> 파일을 통해 확인해볼 수 있으며, 예시로 살펴볼 삼성전자의 고유번호는 00126380 입니다.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">bgn_date =<span class="st"> </span>(<span class="kw">Sys.Date</span>() <span class="op">-</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">30</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb189-2" data-line-number="2">end_date =<span class="st"> </span>(<span class="kw">Sys.Date</span>() ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_remove_all</span>(<span class="st">&#39;-&#39;</span>)</a>
<a class="sourceLine" id="cb189-3" data-line-number="3">corp_code =<span class="st"> &#39;00126380&#39;</span></a>
<a class="sourceLine" id="cb189-4" data-line-number="4"></a>
<a class="sourceLine" id="cb189-5" data-line-number="5">notice_url_ss =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">  <span class="st">&#39;https://opendart.fss.or.kr/api/list.json?crtfc_key=&#39;</span>,dart_api,</a>
<a class="sourceLine" id="cb189-7" data-line-number="7">  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code, </a>
<a class="sourceLine" id="cb189-8" data-line-number="8">  <span class="st">&#39;&amp;bgn_de=&#39;</span>, bgn_date,<span class="st">&#39;&amp;end_de=&#39;</span>,</a>
<a class="sourceLine" id="cb189-9" data-line-number="9">  end_date,<span class="st">&#39;&amp;page_no=1&amp;page_count=100&#39;</span>)</a></code></pre></div>
<p>시작일을 과거 30일로 수정하였으며, 기존 url에 <strong>&amp;corp_code=</strong> 부분을 추가하였습니다.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">notice_data_ss =<span class="st"> </span><span class="kw">fromJSON</span>(notice_url_ss) </a>
<a class="sourceLine" id="cb190-2" data-line-number="2">notice_data_ss =<span class="st"> </span>notice_data_ss[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb190-3" data-line-number="3"></a>
<a class="sourceLine" id="cb190-4" data-line-number="4"><span class="kw">head</span>(notice_data_ss)</a></code></pre></div>
<pre><code>##   corp_code corp_name stock_code corp_cls
## 1  00126380  삼성전자     005930        Y
## 2  00126380  삼성전자     005930        Y
## 3  00126380  삼성전자     005930        Y
## 4  00126380  삼성전자     005930        Y
## 5  00126380  삼성전자     005930        Y
## 6  00126380  삼성전자     005930        Y
##                                report_nm       rcept_no
## 1                 기업지배구조보고서공시 20200529800642
## 2                 특수관계인과의보험거래 20200527000418
## 3                 기타경영사항(자율공시) 20200527800457
## 4 임원ㆍ주요주주특정증권등소유상황보고서 20200521000265
## 5 임원ㆍ주요주주특정증권등소유상황보고서 20200520000263
## 6                   분기보고서 (2020.03) 20200515001451
##     flr_nm rcept_dt rm
## 1 삼성전자 20200529 유
## 2 삼성전자 20200527 공
## 3 삼성전자 20200527 유
## 4   이규호 20200521   
## 5   김태영 20200520   
## 6 삼성전자 20200515</code></pre>
<p>역시나 JSON 형태로 손쉽게 공시정보를 다운로드 받을 수 있습니다. 이 중 rcept_no는 공시번호에 해당하며, 해당 데이터를 이용해 공시에 해당하는 url에 접속을 할 수도 있습니다.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">notice_url_exam =<span class="st"> </span>notice_data_ss[<span class="dv">1</span>, <span class="st">&#39;rcept_no&#39;</span>]</a>
<a class="sourceLine" id="cb192-2" data-line-number="2">notice_dart_url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb192-3" data-line-number="3">  <span class="st">&#39;http://dart.fss.or.kr/dsaf001/main.do?rcpNo=&#39;</span>,notice_url_exam)</a>
<a class="sourceLine" id="cb192-4" data-line-number="4"></a>
<a class="sourceLine" id="cb192-5" data-line-number="5"><span class="kw">print</span>(notice_dart_url)</a></code></pre></div>
<pre><code>## [1] &quot;http://dart.fss.or.kr/dsaf001/main.do?rcpNo=20200529800642&quot;</code></pre>
<p>dart 홈페이지의 공시에 해당하는 url과 첫번째 공시에 해당하는 공시번호를 합쳐주도록 합니다.</p>
<p>위 url에 접속하여 해당 공시를 좀 더 자세하게 확인할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-47"></span>
<img src="images/dart_api_web.png" alt="공시 정보의 확인" width="70%" />
<p class="caption">
그림 6.5: 공시 정보의 확인
</p>
</div>
</div>
</div>
<div id="사업보고서-주요-정보" class="section level3">
<h3><span class="header-section-number">6.3.4</span> 사업보고서 주요 정보</h3>
<p>API를 이용하여 사업보고서의 주요 정보 역시 다운로드 받을 수 있으며, 제공하는 목록은 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/main.do?apiGrpCd=DS002" class="uri">https://opendart.fss.or.kr/guide/main.do?apiGrpCd=DS002</a></p>
<p>이 중 예시로써 [배당에 관한 사항]을 다운로드 받도록 하며, 개발가이드 페이지는 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS002&amp;apiId=2019005" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS002&amp;apiId=2019005</a></p>
<p>url 생성에 필요한 요청 인자는 다음과 같습니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-48">표 6.3: </span>배당에 관한 사항 주요 인자
</caption>
<thead>
<tr>
<th style="text-align:left;">
키
</th>
<th style="text-align:left;">
명칭
</th>
<th style="text-align:left;">
설명
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
crtfc_key
</td>
<td style="text-align:left;">
API 인증키
</td>
<td style="text-align:left;">
발급받은 인증키
</td>
</tr>
<tr>
<td style="text-align:left;">
corp_code
</td>
<td style="text-align:left;">
고유번호
</td>
<td style="text-align:left;">
공시대상회사의 고유번호(8자리)
</td>
</tr>
<tr>
<td style="text-align:left;">
bsns_year
</td>
<td style="text-align:left;">
사업년도
</td>
<td style="text-align:left;">
사업연도(4자리)
</td>
</tr>
<tr>
<td style="text-align:left;">
reprt_code
</td>
<td style="text-align:left;">
보고서 코드
</td>
<td style="text-align:left;">
<li>
1분기보고서 : 11013
</li>
<li>
반기보고서 : 11012
</li>
<li>
3분기보고서 : 11014
</li>
<li>
사업보고서 : 11011
</li>
</td>
</tr>
</tbody>
</table>
<p>이를 바탕으로 삼성전자의 2019년 사업보고서를 통해 배당에 관한 사항을 살펴보도록 하겠습니다.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">corp_code =<span class="st"> &#39;00126380&#39;</span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2">bsns_year =<span class="st"> &#39;2019&#39;</span></a>
<a class="sourceLine" id="cb194-3" data-line-number="3">reprt_code =<span class="st"> &#39;11011&#39;</span></a>
<a class="sourceLine" id="cb194-4" data-line-number="4"></a>
<a class="sourceLine" id="cb194-5" data-line-number="5">url_div =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/alotMatter.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb194-6" data-line-number="6">       dart_api, </a>
<a class="sourceLine" id="cb194-7" data-line-number="7">       <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</a>
<a class="sourceLine" id="cb194-8" data-line-number="8">       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb194-9" data-line-number="9">       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</a>
<a class="sourceLine" id="cb194-10" data-line-number="10">       )</a></code></pre></div>
<p>API 인증키, 고유번호, 사업년도, 보고서 코드에 각각 해당하는 데이터를 입력하여 url 생성하도록 합니다.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1">div_data_ss =<span class="st"> </span><span class="kw">fromJSON</span>(url_div) </a>
<a class="sourceLine" id="cb195-2" data-line-number="2">div_data_ss =<span class="st"> </span>div_data_ss[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb195-3" data-line-number="3"></a>
<a class="sourceLine" id="cb195-4" data-line-number="4"><span class="kw">head</span>(div_data_ss)</a></code></pre></div>
<pre><code>##         rcept_no corp_cls corp_code corp_name
## 1 20200330003851        Y  00126380  삼성전자
## 2 20200330003851        Y  00126380  삼성전자
## 3 20200330003851        Y  00126380  삼성전자
## 4 20200330003851        Y  00126380  삼성전자
## 5 20200330003851        Y  00126380  삼성전자
## 6 20200330003851        Y  00126380  삼성전자
##                         se     thstrm     frmtrm
## 1         주당액면가액(원)        100        100
## 2 (연결)당기순이익(백만원) 21,505,054 43,890,877
## 3 (별도)당기순이익(백만원) 15,353,323 32,815,127
## 4     (연결)주당순이익(원)      3,166      6,461
## 5   현금배당금총액(백만원)  9,619,243  9,619,243
## 6   주식배당금총액(백만원)          -          -
##         lwfr stock_knd
## 1        100      &lt;NA&gt;
## 2 41,344,569      &lt;NA&gt;
## 3 28,800,837      &lt;NA&gt;
## 4      5,997      &lt;NA&gt;
## 5  5,826,302      &lt;NA&gt;
## 6          -      &lt;NA&gt;</code></pre>
<p>JSON 파일을 다운로드 받은 후 데이터를 확인해보면, 사업보고서 중 배당에 관한 사항만이 나타나 있습니다. 위 url의 <strong>alotMatter</strong> 부분을 각 사업보고서에 해당하는 값으로 변경해주면 다른 정보 역시 동일한 방법으로 수집이 가능합니다.</p>
</div>
<div id="상장기업-재무정보" class="section level3">
<h3><span class="header-section-number">6.3.5</span> 상장기업 재무정보</h3>
<p>Open API에서는 상장기업의 재무정보 중 주요계정, 전체 재무제표, 원본파일을 제공하고 있습니다. 이 중 주요계정 및 전체 재무제표를 다운로드 받는법에 대해 알아보도록 하겠습니다.</p>
<div id="단일회사-및-다중회사-주요계정" class="section level4">
<h4><span class="header-section-number">6.3.5.1</span> 단일회사 및 다중회사 주요계정</h4>
<p>API를 통해 단일회사의 주요계정을, 혹은 한번에 여러 회사의 주요계정을 받을수 있습니다. 각각의 개발가이드는 다음과 같습니다.</p>
<ul>
<li>단일회사 주요계정: <a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019016" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019016</a></li>
<li>다중회사 주요계정: <a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019017" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019017</a></li>
</ul>
<p>먼저 단일회사(삼성전자)의 주요계정을 다운로드 받도록 하겠습니다.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1">corp_code =<span class="st"> &#39;00126380&#39;</span></a>
<a class="sourceLine" id="cb197-2" data-line-number="2">bsns_year =<span class="st"> &#39;2019&#39;</span></a>
<a class="sourceLine" id="cb197-3" data-line-number="3">reprt_code =<span class="st"> &#39;11011&#39;</span></a>
<a class="sourceLine" id="cb197-4" data-line-number="4"></a>
<a class="sourceLine" id="cb197-5" data-line-number="5">url_single =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb197-6" data-line-number="6">  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcnt.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb197-7" data-line-number="7">  dart_api, </a>
<a class="sourceLine" id="cb197-8" data-line-number="8">  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</a>
<a class="sourceLine" id="cb197-9" data-line-number="9">  <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb197-10" data-line-number="10">  <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</a>
<a class="sourceLine" id="cb197-11" data-line-number="11">  )</a></code></pre></div>
<p>url을 생성하는 방법이 기존 <a href="금융-데이터-수집하기-심화.html#사업보고서-주요-정보">사업보고서 주요 정보</a> 에서 살펴본 바와 매우 비슷하며, <strong>/api</strong> 뒷부분을 [fnlttSinglAcnt.json] 으로 변경하기만 하면 됩니다.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1">fs_data_single =<span class="st"> </span><span class="kw">fromJSON</span>(url_single) </a>
<a class="sourceLine" id="cb198-2" data-line-number="2">fs_data_single =<span class="st"> </span>fs_data_single[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb198-3" data-line-number="3"></a>
<a class="sourceLine" id="cb198-4" data-line-number="4"><span class="kw">head</span>(fs_data_single)</a></code></pre></div>
<pre><code>##         rcept_no reprt_code bsns_year corp_code
## 1 20200330003851      11011      2019  00126380
## 2 20200330003851      11011      2019  00126380
## 3 20200330003851      11011      2019  00126380
## 4 20200330003851      11011      2019  00126380
## 5 20200330003851      11011      2019  00126380
## 6 20200330003851      11011      2019  00126380
##   stock_code fs_div        fs_nm sj_div      sj_nm
## 1     005930    CFS 연결재무제표     BS 재무상태표
## 2     005930    CFS 연결재무제표     BS 재무상태표
## 3     005930    CFS 연결재무제표     BS 재무상태표
## 4     005930    CFS 연결재무제표     BS 재무상태표
## 5     005930    CFS 연결재무제표     BS 재무상태표
## 6     005930    CFS 연결재무제표     BS 재무상태표
##   account_nm thstrm_nm       thstrm_dt
## 1   유동자산  제 51 기 2019.12.31 현재
## 2 비유동자산  제 51 기 2019.12.31 현재
## 3   자산총계  제 51 기 2019.12.31 현재
## 4   유동부채  제 51 기 2019.12.31 현재
## 5 비유동부채  제 51 기 2019.12.31 현재
## 6   부채총계  제 51 기 2019.12.31 현재
##         thstrm_amount frmtrm_nm       frmtrm_dt
## 1 181,385,260,000,000  제 50 기 2018.12.31 현재
## 2 171,179,237,000,000  제 50 기 2018.12.31 현재
## 3 352,564,497,000,000  제 50 기 2018.12.31 현재
## 4  63,782,764,000,000  제 50 기 2018.12.31 현재
## 5  25,901,312,000,000  제 50 기 2018.12.31 현재
## 6  89,684,076,000,000  제 50 기 2018.12.31 현재
##         frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 1 174,697,424,000,000     제 49 기 2017.12.31 현재
## 2 164,659,820,000,000     제 49 기 2017.12.31 현재
## 3 339,357,244,000,000     제 49 기 2017.12.31 현재
## 4  69,081,510,000,000     제 49 기 2017.12.31 현재
## 5  22,522,557,000,000     제 49 기 2017.12.31 현재
## 6  91,604,067,000,000     제 49 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 1 146,982,464,000,000   1
## 2 154,769,626,000,000   3
## 3 301,752,090,000,000   5
## 4  67,175,114,000,000   7
## 5  20,085,548,000,000   9
## 6  87,260,662,000,000  11</code></pre>
<p>연결재무제표와 재무상태표에 해당하는 주요 내용이 수집되었으며, 각 열에 해당하는 내용은 페이지의 개발가이드의 [응답 결과]에서 확인할 수 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-53"></span>
<img src="images/dart_single_result.png" alt="단일회사 주요계정 응답 결과" width="70%" />
<p class="caption">
그림 6.6: 단일회사 주요계정 응답 결과
</p>
</div>
<p>이번에는 url을 수정하여 여러 회사의 주요계정을 한번에 받도록 하겠으며, 그 예로써 삼성전자, 셀트리온, KT의 데이터를 다운로드 받도록 합니다.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1">corp_code =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;00126380,00413046,00190321&#39;</span>)</a>
<a class="sourceLine" id="cb200-2" data-line-number="2">bsns_year =<span class="st"> &#39;2019&#39;</span></a>
<a class="sourceLine" id="cb200-3" data-line-number="3">reprt_code =<span class="st"> &#39;11011&#39;</span></a>
<a class="sourceLine" id="cb200-4" data-line-number="4"></a>
<a class="sourceLine" id="cb200-5" data-line-number="5">url_multiple =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb200-6" data-line-number="6">  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttMultiAcnt.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb200-7" data-line-number="7">  dart_api, </a>
<a class="sourceLine" id="cb200-8" data-line-number="8">  <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</a>
<a class="sourceLine" id="cb200-9" data-line-number="9">  <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb200-10" data-line-number="10">  <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code</a>
<a class="sourceLine" id="cb200-11" data-line-number="11">  )</a></code></pre></div>
<p>먼저 corp에 원하는 기업들의 고유번호를 나열해주며, url 중 [fnlttSinglAcnt]을 [fnlttMultiAcnt]로 수정합니다.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1">fs_data_multiple =<span class="st"> </span><span class="kw">fromJSON</span>(url_multiple) </a>
<a class="sourceLine" id="cb201-2" data-line-number="2">fs_data_multiple =<span class="st"> </span>fs_data_multiple[[<span class="st">&#39;list&#39;</span>]]</a></code></pre></div>
<p>3개 기업의 주요계정이 하나의 데이터 프레임으로 다운로드 됩니다. 마지막으로 각 회사별로 데이터를 나눠주도록 하겠습니다.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1">fs_data_list =<span class="st"> </span>fs_data_multiple <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">split</span>(<span class="dt">f =</span> .<span class="op">$</span>corp_code)</a>
<a class="sourceLine" id="cb202-2" data-line-number="2"></a>
<a class="sourceLine" id="cb202-3" data-line-number="3"><span class="kw">lapply</span>(fs_data_list, head, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## $`00126380`
##         rcept_no reprt_code bsns_year corp_code
## 1 20200330003851      11011      2019  00126380
## 2 20200330003851      11011      2019  00126380
##   stock_code fs_div        fs_nm sj_div      sj_nm
## 1     005930    CFS 연결재무제표     BS 재무상태표
## 2     005930    CFS 연결재무제표     BS 재무상태표
##   account_nm thstrm_nm       thstrm_dt
## 1   유동자산  제 51 기 2019.12.31 현재
## 2 비유동자산  제 51 기 2019.12.31 현재
##         thstrm_amount frmtrm_nm       frmtrm_dt
## 1 181,385,260,000,000  제 50 기 2018.12.31 현재
## 2 171,179,237,000,000  제 50 기 2018.12.31 현재
##         frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 1 174,697,424,000,000     제 49 기 2017.12.31 현재
## 2 164,659,820,000,000     제 49 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 1 146,982,464,000,000   1
## 2 154,769,626,000,000   3
## 
## $`00190321`
##          rcept_no reprt_code bsns_year corp_code
## 27 20200330004658      11011      2019  00190321
## 28 20200330004658      11011      2019  00190321
##    stock_code fs_div        fs_nm sj_div      sj_nm
## 27     030200    CFS 연결재무제표     BS 재무상태표
## 28     030200    CFS 연결재무제표     BS 재무상태표
##    account_nm thstrm_nm       thstrm_dt
## 27   유동자산  제 38 기 2019.12.31 현재
## 28 비유동자산  제 38 기 2019.12.31 현재
##         thstrm_amount frmtrm_nm       frmtrm_dt
## 27 11,898,255,000,000  제 37 기 2018.12.31 현재
## 28 22,163,037,000,000  제 37 기 2018.12.31 현재
##         frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 27 11,894,252,000,000     제 36 기 2017.12.31 현재
## 28 20,294,578,000,000     제 36 기 2017.12.31 현재
##      bfefrmtrm_amount ord
## 27  9,672,412,000,000   1
## 28 20,058,498,000,000   3
## 
## $`00413046`
##          rcept_no reprt_code bsns_year corp_code
## 53 20200410002837      11011      2019  00413046
## 54 20200410002837      11011      2019  00413046
##    stock_code fs_div        fs_nm sj_div      sj_nm
## 53     068270    CFS 연결재무제표     BS 재무상태표
## 54     068270    CFS 연결재무제표     BS 재무상태표
##    account_nm thstrm_nm       thstrm_dt
## 53   유동자산  제 29 기 2019.12.31 현재
## 54 비유동자산  제 29 기 2019.12.31 현재
##        thstrm_amount frmtrm_nm       frmtrm_dt
## 53 1,787,340,254,600  제 28 기 2018.12.31 현재
## 54 2,106,351,351,846  제 28 기 2018.12.31 현재
##        frmtrm_amount bfefrmtrm_nm    bfefrmtrm_dt
## 53 1,664,478,918,682     제 27 기 2017.12.31 현재
## 54 1,876,147,755,272     제 27 기 2017.12.31 현재
##     bfefrmtrm_amount ord
## 53 1,614,033,788,024   1
## 54 1,701,493,916,629   3</code></pre>
<p><code>split()</code> 함수 내 f 인자를 통해 corp_code, 즉 고유번호 단위로 각각의 리스트에 데이터가 저장됩니다.</p>
</div>
</div>
<div id="단일회사-전체-재무제표" class="section level3">
<h3><span class="header-section-number">6.3.6</span> 단일회사 전체 재무제표</h3>
<p>단일회사의 전체 재무제표 데이터 역시 다운로드 받을 수 있으며 개발가이드는 다음과 같습니다.</p>
<p><a href="https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019020" class="uri">https://opendart.fss.or.kr/guide/detail.do?apiGrpCd=DS003&amp;apiId=2019020</a></p>
<p>예제로써 삼성전자의 2019년 사업보고서에 나와있는 전체 재무제표를 다운로드 받도록 하겠습니다.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1">corp_code =<span class="st"> &#39;00126380&#39;</span></a>
<a class="sourceLine" id="cb204-2" data-line-number="2">bsns_year =<span class="st"> </span><span class="dv">2019</span></a>
<a class="sourceLine" id="cb204-3" data-line-number="3">reprt_code =<span class="st"> &#39;11011&#39;</span></a>
<a class="sourceLine" id="cb204-4" data-line-number="4"></a>
<a class="sourceLine" id="cb204-5" data-line-number="5">url_fs_all =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb204-6" data-line-number="6">  <span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb204-7" data-line-number="7">   dart_api, </a>
<a class="sourceLine" id="cb204-8" data-line-number="8">   <span class="st">&#39;&amp;corp_code=&#39;</span>, corp_code,</a>
<a class="sourceLine" id="cb204-9" data-line-number="9">   <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb204-10" data-line-number="10">   <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=CFS&#39;</span></a>
<a class="sourceLine" id="cb204-11" data-line-number="11">  )</a></code></pre></div>
<p>역시나 앞선 예제들과 거의 동일화며, url의 <strong>api/</strong> 뒷 부분을 [fnlttSinglAcntAll.json] 으로 변경해주도록 합니다. 연결재무제표와 일반재무제표를 구분하는 fs_div 인자는 연결재무제표를 의미하는 CFS로 선택해줍니다.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1">fs_data_all =<span class="st"> </span><span class="kw">fromJSON</span>(url_fs_all) </a>
<a class="sourceLine" id="cb205-2" data-line-number="2">fs_data_all =<span class="st"> </span>fs_data_all[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb205-3" data-line-number="3"></a>
<a class="sourceLine" id="cb205-4" data-line-number="4"><span class="kw">head</span>(fs_data_all)</a></code></pre></div>
<pre><code>##         rcept_no reprt_code bsns_year corp_code sj_div
## 1 20200330003851      11011      2019  00126380     BS
## 2 20200330003851      11011      2019  00126380     BS
## 3 20200330003851      11011      2019  00126380     BS
## 4 20200330003851      11011      2019  00126380     BS
## 5 20200330003851      11011      2019  00126380     BS
## 6 20200330003851      11011      2019  00126380     BS
##        sj_nm
## 1 재무상태표
## 2 재무상태표
## 3 재무상태표
## 4 재무상태표
## 5 재무상태표
## 6 재무상태표
##                                                                                     account_id
## 1                                                                      ifrs-full_CurrentAssets
## 2                                                             ifrs-full_CashAndCashEquivalents
## 3                                         dart_ShortTermDepositsNotClassifiedAsCashEquivalents
## 4                                                                        -표준계정코드 미사용-
## 5                                                                        -표준계정코드 미사용-
## 6 ifrs-full_CurrentFinancialAssetsAtFairValueThroughProfitOrLossMandatorilyMeasuredAtFairValue
##                      account_nm account_detail
## 1                      유동자산              -
## 2              현금및현금성자산              -
## 3                  단기금융상품              -
## 4          단기매도가능금융자산              -
## 5        단기상각후원가금융자산              -
## 6 단기당기손익-공정가치금융자산              -
##   thstrm_nm   thstrm_amount frmtrm_nm   frmtrm_amount
## 1  제 51 기 181385260000000  제 50 기 174697424000000
## 2  제 51 기  26885999000000  제 50 기  30340505000000
## 3  제 51 기  76252052000000  제 50 기  65893797000000
## 4  제 51 기                  제 50 기                
## 5  제 51 기   3914216000000  제 50 기   2703693000000
## 6  제 51 기   1727436000000  제 50 기   2001948000000
##   bfefrmtrm_nm bfefrmtrm_amount ord thstrm_add_amount
## 1     제 49 기  146982464000000   1              &lt;NA&gt;
## 2     제 49 기   30545130000000   2              &lt;NA&gt;
## 3     제 49 기   49447696000000   3              &lt;NA&gt;
## 4     제 49 기    3191375000000   4              &lt;NA&gt;
## 5     제 49 기                    5              &lt;NA&gt;
## 6     제 49 기                    6              &lt;NA&gt;</code></pre>
<p>총 210개의 재무제표 항목이 다운로드 됩니다. 이 중 thstrm_nm와 thstrm_amount는 당기(금년), frmtrm_nm과 frmtrm_amount는 전기, bfefrmtrm_nm과 bfefrmtrm_amount는 전전기를 의미합니다. 따라서 해당 열을 통해 최근 3년 재무제표 만을 선택할 수도 있습니다.</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">yr_count =<span class="st"> </span><span class="kw">str_detect</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb207-2" data-line-number="2">yr_name =<span class="st"> </span><span class="kw">seq</span>(bsns_year, (bsns_year <span class="op">-</span><span class="st"> </span>yr_count <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb207-3" data-line-number="3"></a>
<a class="sourceLine" id="cb207-4" data-line-number="4">fs_data_all =<span class="st"> </span>fs_data_all[, <span class="kw">c</span>(<span class="st">&#39;corp_code&#39;</span>, <span class="st">&#39;sj_nm&#39;</span>, <span class="st">&#39;account_nm&#39;</span>, <span class="st">&#39;account_detail&#39;</span>)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb207-5" data-line-number="5"><span class="st">  </span><span class="kw">cbind</span>(fs_data_all[, <span class="kw">str_which</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>)])</a>
<a class="sourceLine" id="cb207-6" data-line-number="6"></a>
<a class="sourceLine" id="cb207-7" data-line-number="7"><span class="kw">colnames</span>(fs_data_all)[<span class="kw">str_which</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;amount&#39;</span>)] =<span class="st"> </span>yr_name</a>
<a class="sourceLine" id="cb207-8" data-line-number="8"></a>
<a class="sourceLine" id="cb207-9" data-line-number="9"><span class="kw">head</span>(fs_data_all)</a></code></pre></div>
<pre><code>##   corp_code      sj_nm                    account_nm
## 1  00126380 재무상태표                      유동자산
## 2  00126380 재무상태표              현금및현금성자산
## 3  00126380 재무상태표                  단기금융상품
## 4  00126380 재무상태표          단기매도가능금융자산
## 5  00126380 재무상태표        단기상각후원가금융자산
## 6  00126380 재무상태표 단기당기손익-공정가치금융자산
##   account_detail            2019            2018
## 1              - 181385260000000 174697424000000
## 2              -  26885999000000  30340505000000
## 3              -  76252052000000  65893797000000
## 4              -                                
## 5              -   3914216000000   2703693000000
## 6              -   1727436000000   2001948000000
##              2017
## 1 146982464000000
## 2  30545130000000
## 3  49447696000000
## 4   3191375000000
## 5                
## 6</code></pre>
<ol style="list-style-type: decimal">
<li><code>str_detect()</code> 함수를 이용해 열 이름에 trm_amount 들어간 갯수를 확인합니다. 이는 최근 3개년 데이터가 없는 경우도 고려하기 위함입니다. (일반적으로 3이 반환될 것이며, 재무데이터가 2년치 밖에 없는 경우 2가 반환될 것입니다.)</li>
<li>위에서 계산된 갯수를 이용해 열이름에 들어갈 년도를 생성합니다.</li>
<li>corp_code(고유번호), sj_nm(재무제표명), account_nm(계정명), account_detail(계정상세) 및 연도별 금액에 해당하는 trm_amount가 포함된 열을 선택합니다.</li>
<li>연도별 데이터에 해당하는 열의 이름을 yr_name, 즉 각 연도로 변경합니다.</li>
</ol>
<div id="전-종목-전체-재무제표-데이터-수집하기" class="section level4">
<h4><span class="header-section-number">6.3.6.1</span> 전 종목 전체 재무제표 데이터 수집하기</h4>
<p>for loop 구문을 이용해 고유번호에 해당하는 corp_code 부분만 변경해주면 전 종목의 API를 통해 재무제표 데이터를 손쉽게 수집할 수도 있습니다. 단, 일부 종목(대부분 금융주)의 경우 API로 파일이 제공되지 않습니다.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb209-2" data-line-number="2"></a>
<a class="sourceLine" id="cb209-3" data-line-number="3">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb209-4" data-line-number="4">corp_list =<span class="st">  </span><span class="kw">read.csv</span>(<span class="st">&#39;data/corp_list.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb209-5" data-line-number="5"></a>
<a class="sourceLine" id="cb209-6" data-line-number="6">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb209-7" data-line-number="7"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb209-8" data-line-number="8"></a>
<a class="sourceLine" id="cb209-9" data-line-number="9">corp_list<span class="op">$</span><span class="st">&#39;code&#39;</span> =</a>
<a class="sourceLine" id="cb209-10" data-line-number="10"><span class="st">  </span><span class="kw">str_pad</span>(corp_list<span class="op">$</span><span class="st">&#39;code&#39;</span>, <span class="dv">8</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb209-11" data-line-number="11"></a>
<a class="sourceLine" id="cb209-12" data-line-number="12">corp_list<span class="op">$</span><span class="st">&#39;stock&#39;</span> =</a>
<a class="sourceLine" id="cb209-13" data-line-number="13"><span class="st">  </span><span class="kw">str_pad</span>(corp_list<span class="op">$</span><span class="st">&#39;stock&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb209-14" data-line-number="14"></a>
<a class="sourceLine" id="cb209-15" data-line-number="15">ticker_list =<span class="st"> </span>KOR_ticker <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">left_join</span>(corp_list, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;종목코드&#39;</span> =<span class="st"> &#39;stock&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb209-16" data-line-number="16"><span class="st">  </span><span class="kw">select</span>(<span class="st">&#39;종목코드&#39;</span>, <span class="st">&#39;종목명&#39;</span>, <span class="st">&#39;code&#39;</span>)</a>
<a class="sourceLine" id="cb209-17" data-line-number="17"></a>
<a class="sourceLine" id="cb209-18" data-line-number="18"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/dart_fs&#39;</span>), <span class="ot">FALSE</span>, <span class="kw">dir.create</span>(<span class="st">&#39;data/dart_fs&#39;</span>))</a></code></pre></div>
<p>먼저 거래소에서 받은 티커 파일과 API를 통해 받은 고유번호 파일을 불러온 후, <code>str_pad()</code> 함수를 통해 0을 채워주며, 고유번호의 경우 8자리로 구성되어 있습니다. 그 후 dart_fs 폴더를 생성해 줍니다.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1">bsns_year =<span class="st"> </span><span class="dv">2019</span></a>
<a class="sourceLine" id="cb210-2" data-line-number="2">reprt_code =<span class="st"> &#39;11011&#39;</span></a>
<a class="sourceLine" id="cb210-3" data-line-number="3"></a>
<a class="sourceLine" id="cb210-4" data-line-number="4"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(ticker_list) ) {</a>
<a class="sourceLine" id="cb210-5" data-line-number="5">  </a>
<a class="sourceLine" id="cb210-6" data-line-number="6">  data_fs =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb210-7" data-line-number="7">  name =<span class="st"> </span>ticker_list<span class="op">$</span>code[i]</a>
<a class="sourceLine" id="cb210-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb210-9" data-line-number="9">  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></a>
<a class="sourceLine" id="cb210-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb210-11" data-line-number="11">  <span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb210-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb210-13" data-line-number="13">    <span class="co"># url 생성</span></a>
<a class="sourceLine" id="cb210-14" data-line-number="14">    url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb210-15" data-line-number="15">       dart_api, </a>
<a class="sourceLine" id="cb210-16" data-line-number="16">       <span class="st">&#39;&amp;corp_code=&#39;</span>, name,</a>
<a class="sourceLine" id="cb210-17" data-line-number="17">       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb210-18" data-line-number="18">       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=CFS&#39;</span></a>
<a class="sourceLine" id="cb210-19" data-line-number="19">       )</a>
<a class="sourceLine" id="cb210-20" data-line-number="20">    </a>
<a class="sourceLine" id="cb210-21" data-line-number="21">    <span class="co"># JSON 다운로드</span></a>
<a class="sourceLine" id="cb210-22" data-line-number="22">    fs_data_all =<span class="st"> </span><span class="kw">fromJSON</span>(url) </a>
<a class="sourceLine" id="cb210-23" data-line-number="23">    fs_data_all =<span class="st"> </span>fs_data_all[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb210-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb210-25" data-line-number="25">    <span class="co"># 만일 연결재무제표 없어서 NULL 반환시</span></a>
<a class="sourceLine" id="cb210-26" data-line-number="26">    <span class="co"># reprt_code를 OFS 즉 재무제표 다운로드</span></a>
<a class="sourceLine" id="cb210-27" data-line-number="27">    <span class="cf">if</span> (<span class="kw">is.null</span>(fs_data_all)) {</a>
<a class="sourceLine" id="cb210-28" data-line-number="28">      </a>
<a class="sourceLine" id="cb210-29" data-line-number="29">      url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;https://opendart.fss.or.kr/api/fnlttSinglAcntAll.json?crtfc_key=&#39;</span>,</a>
<a class="sourceLine" id="cb210-30" data-line-number="30">       dart_api, </a>
<a class="sourceLine" id="cb210-31" data-line-number="31">       <span class="st">&#39;&amp;corp_code=&#39;</span>, name,</a>
<a class="sourceLine" id="cb210-32" data-line-number="32">       <span class="st">&#39;&amp;bsns_year=&#39;</span>, bsns_year,</a>
<a class="sourceLine" id="cb210-33" data-line-number="33">       <span class="st">&#39;&amp;reprt_code=&#39;</span>, reprt_code,<span class="st">&#39;&amp;fs_div=OFS&#39;</span></a>
<a class="sourceLine" id="cb210-34" data-line-number="34">       )</a>
<a class="sourceLine" id="cb210-35" data-line-number="35">      </a>
<a class="sourceLine" id="cb210-36" data-line-number="36">      fs_data_all =<span class="st"> </span><span class="kw">fromJSON</span>(url) </a>
<a class="sourceLine" id="cb210-37" data-line-number="37">      fs_data_all =<span class="st"> </span>fs_data_all[[<span class="st">&#39;list&#39;</span>]]</a>
<a class="sourceLine" id="cb210-38" data-line-number="38">      </a>
<a class="sourceLine" id="cb210-39" data-line-number="39">    }</a>
<a class="sourceLine" id="cb210-40" data-line-number="40">    </a>
<a class="sourceLine" id="cb210-41" data-line-number="41"></a>
<a class="sourceLine" id="cb210-42" data-line-number="42">    <span class="co"># 데이터 선택 후 열이름을 연도로 변경</span></a>
<a class="sourceLine" id="cb210-43" data-line-number="43">    yr_count =<span class="st"> </span><span class="kw">str_detect</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</a>
<a class="sourceLine" id="cb210-44" data-line-number="44">    yr_name =<span class="st"> </span><span class="kw">seq</span>(bsns_year, (bsns_year <span class="op">-</span><span class="st"> </span>yr_count <span class="op">+</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb210-45" data-line-number="45">    </a>
<a class="sourceLine" id="cb210-46" data-line-number="46">    fs_data_all =<span class="st"> </span>fs_data_all[, <span class="kw">c</span>(<span class="st">&#39;corp_code&#39;</span>, <span class="st">&#39;sj_nm&#39;</span>, <span class="st">&#39;account_nm&#39;</span>, <span class="st">&#39;account_detail&#39;</span>)] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb210-47" data-line-number="47"><span class="st">      </span><span class="kw">cbind</span>(fs_data_all[, <span class="kw">str_which</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;trm_amount&#39;</span>)])</a>
<a class="sourceLine" id="cb210-48" data-line-number="48">    </a>
<a class="sourceLine" id="cb210-49" data-line-number="49">    <span class="kw">colnames</span>(fs_data_all)[<span class="kw">str_which</span>(<span class="kw">colnames</span>(fs_data_all), <span class="st">&#39;amount&#39;</span>)] =<span class="st"> </span>yr_name</a>
<a class="sourceLine" id="cb210-50" data-line-number="50">    </a>
<a class="sourceLine" id="cb210-51" data-line-number="51">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb210-52" data-line-number="52">    </a>
<a class="sourceLine" id="cb210-53" data-line-number="53">    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></a>
<a class="sourceLine" id="cb210-54" data-line-number="54">    data_fs &lt;&lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb210-55" data-line-number="55">    <span class="kw">warning</span>(<span class="kw">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</a>
<a class="sourceLine" id="cb210-56" data-line-number="56">  })</a>
<a class="sourceLine" id="cb210-57" data-line-number="57">  </a>
<a class="sourceLine" id="cb210-58" data-line-number="58">  <span class="co"># 다운로드 받은 파일을 생성한 각각의 폴더 내 csv 파일로 저장</span></a>
<a class="sourceLine" id="cb210-59" data-line-number="59">  </a>
<a class="sourceLine" id="cb210-60" data-line-number="60">  <span class="co"># 재무제표 저장</span></a>
<a class="sourceLine" id="cb210-61" data-line-number="61">  <span class="kw">write.csv</span>(fs_data_all, <span class="kw">paste0</span>(<span class="st">&#39;data/dart_fs/&#39;</span>, ticker_list<span class="op">$</span>종목코드[i], <span class="st">&#39;_fs_dart.csv&#39;</span>))</a>
<a class="sourceLine" id="cb210-62" data-line-number="62">  </a>
<a class="sourceLine" id="cb210-63" data-line-number="63">  <span class="co"># 2초간 타임슬립 적용</span></a>
<a class="sourceLine" id="cb210-64" data-line-number="64">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb210-65" data-line-number="65">}</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>for loop 구문을 이용해 고유번호에 해당하는 값을 변경합니다.</li>
<li>일부 종목의 경우 연결재무제표가 아닌 재무제표를 업로드 하는 경우가 있으며, <code>if (is.null(fs_data_all))</code> 부분을 통해 연결재무제표가 없을 경우 fs_div를 OFS로 변경하여 재무제표를 다운로드 받습니다.</li>
<li>이를 제외하고는 앞서 살펴본 예제와 동일합니다.</li>
<li>데이터 수집 및 정리를 해준 후, data 폴더의 dart_fs 폴더 내에 티커_fs_dart.csv 이름으로 저장해 줍니다.</li>
</ol>
<p>Open API 내에서는 2015년 이후 재무제표 데이터를 API 형태로 제공하고 있으므로 bsns_year 부분에도 for loop 구문을 이용하면 해당 데이터를 모두 수집할 수 있습니다. 그러나 간단한 퀀트 투자를 하기에는 최근 3년의 재무제표 데이터만 있어도 충분하며, 시간이 너무 오래 걸린다는 점, API 요청한도를 초과한다는 단점이 있으므로 본 책에서는 다루지 않도록 하겠습니다.</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="14">
<li id="fn14"><p><a href="https://finance.naver.com/item/fchart.nhn?code=005930" class="uri">https://finance.naver.com/item/fchart.nhn?code=005930</a><a href="금융-데이터-수집하기-심화.html#fnref14" class="footnote-back">↩</a></p></li>
<li id="fn15"><p>플래쉬가 차단되어 화면이 나오지 않는 경우, 주소창의 왼쪽 상단에 위치한 자물쇠 버튼을 클릭한 다음, Flash를 허용으로 바꾼 후 새로고침을 누르면 차트가 나오게 됩니다.<a href="금융-데이터-수집하기-심화.html#fnref15" class="footnote-back">↩</a></p></li>
<li id="fn16"><p><a href="http://comp.fnguide.com/" class="uri">http://comp.fnguide.com/</a><a href="금융-데이터-수집하기-심화.html#fnref16" class="footnote-back">↩</a></p></li>
<li id="fn17"><p>분모에 사용되는 재무데이터의 구체적인 항목과 발행주식수를 계산하는 방법의 차이로 인해 여러 업체에서 제공하는 가치지표와 다소 차이가 발생할 수 있습니다.<a href="금융-데이터-수집하기-심화.html#fnref17" class="footnote-back">↩</a></p></li>
</ol>
</div>
<div id="disqus_thread"></div>
<script>

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://quant-cookbook.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            </section>

          </div>
        </div>
      </div>
<a href="금융-데이터-수집하기-기본.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="데이터-정리하기.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"split_bib": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
