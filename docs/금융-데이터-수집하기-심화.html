<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기</title>
  <meta name="description" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="hyunyulhenry/quant_cookbook" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 금융 데이터 수집하기 (심화) | R을 이용한 퀀트 투자 포트폴리오 만들기" />
  
  
  

<meta name="author" content="이현열" />


<meta name="date" content="2020-03-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="데이터-정리하기.html"/>
<link rel="next" href="데이터-정리하기-1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/dygraphs-1.1.1/dygraph.css" rel="stylesheet" />
<script src="libs/dygraphs-1.1.1/dygraph-combined.js"></script>
<script src="libs/dygraphs-1.1.1/shapes.js"></script>
<script src="libs/moment-2.8.4/moment.js"></script>
<script src="libs/moment-timezone-0.2.5/moment-timezone-with-data.js"></script>
<script src="libs/moment-fquarter-1.0.0/moment-fquarter.min.js"></script>
<script src="libs/dygraphs-binding-1.1.1.6/dygraphs.js"></script>
<script src="libs/proj4js-2.3.15/proj4.js"></script>
<link href="libs/highcharts-7.0.1/css/motion.css" rel="stylesheet" />
<link href="libs/highcharts-7.0.1/css/htmlwdgtgrid.css" rel="stylesheet" />
<script src="libs/highcharts-7.0.1/highcharts.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-3d.js"></script>
<script src="libs/highcharts-7.0.1/highcharts-more.js"></script>
<script src="libs/highcharts-7.0.1/modules/stock.js"></script>
<script src="libs/highcharts-7.0.1/modules/map.js"></script>
<script src="libs/highcharts-7.0.1/modules/annotations.js"></script>
<script src="libs/highcharts-7.0.1/modules/boost.js"></script>
<script src="libs/highcharts-7.0.1/modules/data.js"></script>
<script src="libs/highcharts-7.0.1/modules/drag-panes.js"></script>
<script src="libs/highcharts-7.0.1/modules/drilldown.js"></script>
<script src="libs/highcharts-7.0.1/modules/item-series.js"></script>
<script src="libs/highcharts-7.0.1/modules/offline-exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/overlapping-datalabels.js"></script>
<script src="libs/highcharts-7.0.1/modules/exporting.js"></script>
<script src="libs/highcharts-7.0.1/modules/export-data.js"></script>
<script src="libs/highcharts-7.0.1/modules/funnel.js"></script>
<script src="libs/highcharts-7.0.1/modules/heatmap.js"></script>
<script src="libs/highcharts-7.0.1/modules/treemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/sankey.js"></script>
<script src="libs/highcharts-7.0.1/modules/solid-gauge.js"></script>
<script src="libs/highcharts-7.0.1/modules/streamgraph.js"></script>
<script src="libs/highcharts-7.0.1/modules/sunburst.js"></script>
<script src="libs/highcharts-7.0.1/modules/vector.js"></script>
<script src="libs/highcharts-7.0.1/modules/wordcloud.js"></script>
<script src="libs/highcharts-7.0.1/modules/xrange.js"></script>
<script src="libs/highcharts-7.0.1/modules/tilemap.js"></script>
<script src="libs/highcharts-7.0.1/modules/venn.js"></script>
<script src="libs/highcharts-7.0.1/modules/gantt.js"></script>
<script src="libs/highcharts-7.0.1/modules/timeline.js"></script>
<script src="libs/highcharts-7.0.1/modules/parallel-coordinates.js"></script>
<script src="libs/highcharts-7.0.1/plugins/grouped-categories.js"></script>
<script src="libs/highcharts-7.0.1/plugins/motion.js"></script>
<script src="libs/highcharts-7.0.1/plugins/multicolor_series.js"></script>
<script src="libs/highcharts-7.0.1/custom/reset.js"></script>
<script src="libs/highcharts-7.0.1/custom/symbols-extra.js"></script>
<script src="libs/highcharts-7.0.1/custom/text-symbols.js"></script>
<script src="libs/highchart-binding-0.7.0/highchart.js"></script>
<script src="libs/plotly-binding-4.9.2/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#지은이-소개"><i class="fa fa-check"></i>지은이 소개</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#머리말"><i class="fa fa-check"></i>머리말</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-구성"><i class="fa fa-check"></i>이 책의 구성</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책에서-다루지-않은-주제"><i class="fa fa-check"></i>이 책에서 다루지 않은 주제</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#도움이-될-만한-자료들"><i class="fa fa-check"></i>도움이 될 만한 자료들</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#이-책의-지원-페이지"><i class="fa fa-check"></i>이 책의 지원 페이지</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#종목과-관련된-유의사항"><i class="fa fa-check"></i>종목과 관련된 유의사항</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html"><i class="fa fa-check"></i><b>1</b> 퀀트 투자의 심장: 데이터와 프로그래밍</a><ul>
<li class="chapter" data-level="1.1" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#데이터-구하기"><i class="fa fa-check"></i><b>1.1</b> 데이터 구하기</a></li>
<li class="chapter" data-level="1.2" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자와-프로그래밍"><i class="fa fa-check"></i><b>1.2</b> 퀀트 투자와 프로그래밍</a></li>
<li class="chapter" data-level="1.3" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#r-프로그램"><i class="fa fa-check"></i><b>1.3</b> R 프로그램</a></li>
<li class="chapter" data-level="1.4" data-path="퀀트-투자의-심장-데이터와-프로그래밍.html"><a href="퀀트-투자의-심장-데이터와-프로그래밍.html#퀀트-투자에-유용한-r-패키지"><i class="fa fa-check"></i><b>1.4</b> 퀀트 투자에 유용한 R 패키지</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html"><i class="fa fa-check"></i><b>2</b> 크롤링을 위한 기본 지식</a><ul>
<li class="chapter" data-level="2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인코딩의-이해와-r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1</b> 인코딩의 이해와 R에서 UTF-8 설정하기</a><ul>
<li class="chapter" data-level="2.1.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#인간과-컴퓨터-간-번역의-시작-ascii"><i class="fa fa-check"></i><b>2.1.1</b> 인간과 컴퓨터 간 번역의 시작, ASCII</a></li>
<li class="chapter" data-level="2.1.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#한글-인코딩-방식의-종류"><i class="fa fa-check"></i><b>2.1.2</b> 한글 인코딩 방식의 종류</a></li>
<li class="chapter" data-level="2.1.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#r에서-utf-8-설정하기"><i class="fa fa-check"></i><b>2.1.3</b> R에서 UTF-8 설정하기</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#웹의-동작-방식"><i class="fa fa-check"></i><b>2.2</b> 웹의 동작 방식</a><ul>
<li class="chapter" data-level="2.2.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#http"><i class="fa fa-check"></i><b>2.2.1</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html과-css"><i class="fa fa-check"></i><b>2.3</b> HTML과 CSS</a><ul>
<li class="chapter" data-level="2.3.1" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#html-기본-구조"><i class="fa fa-check"></i><b>2.3.1</b> HTML 기본 구조</a></li>
<li class="chapter" data-level="2.3.2" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#태그와-속성"><i class="fa fa-check"></i><b>2.3.2</b> 태그와 속성</a></li>
<li class="chapter" data-level="2.3.3" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#h-태그와-p-태그"><i class="fa fa-check"></i><b>2.3.3</b> h 태그와 p 태그</a></li>
<li class="chapter" data-level="2.3.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#리스트를-나타내는-ul-태그와-ol-태그"><i class="fa fa-check"></i><b>2.3.4</b> 리스트를 나타내는 ul 태그와 ol 태그</a></li>
<li class="chapter" data-level="2.3.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#table-태그"><i class="fa fa-check"></i><b>2.3.5</b> table 태그</a></li>
<li class="chapter" data-level="2.3.6" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#a-태그와-src-태그-및-속성"><i class="fa fa-check"></i><b>2.3.6</b> a 태그와 src 태그 및 속성</a></li>
<li class="chapter" data-level="2.3.7" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#div-태그"><i class="fa fa-check"></i><b>2.3.7</b> div 태그</a></li>
<li class="chapter" data-level="2.3.8" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#css"><i class="fa fa-check"></i><b>2.3.8</b> CSS</a></li>
<li class="chapter" data-level="2.3.9" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#클래스와-id"><i class="fa fa-check"></i><b>2.3.9</b> 클래스와 id</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#파이프-오퍼레이터"><i class="fa fa-check"></i><b>2.4</b> 파이프 오퍼레이터(<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="2.5" data-path="크롤링을-위한-기본-지식.html"><a href="크롤링을-위한-기본-지식.html#오류에-대한-예외처리"><i class="fa fa-check"></i><b>2.5</b> 오류에 대한 예외처리</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html"><i class="fa fa-check"></i><b>3</b> API를 이용한 데이터 수집</a><ul>
<li class="chapter" data-level="3.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#api를-이용한-quandl-데이터-다운로드"><i class="fa fa-check"></i><b>3.1</b> API를 이용한 Quandl 데이터 다운로드</a></li>
<li class="chapter" data-level="3.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#getsymbols-함수를-이용한-api-다운로드"><i class="fa fa-check"></i><b>3.2</b> <code>getSymbols()</code> 함수를 이용한 API 다운로드</a><ul>
<li class="chapter" data-level="3.2.1" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#주가-다운로드"><i class="fa fa-check"></i><b>3.2.1</b> 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.2" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#국내-종목-주가-다운로드"><i class="fa fa-check"></i><b>3.2.2</b> 국내 종목 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.3" data-path="api를-이용한-데이터-수집.html"><a href="api를-이용한-데이터-수집.html#fred-데이터-다운로드"><i class="fa fa-check"></i><b>3.2.3</b> FRED 데이터 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html"><i class="fa fa-check"></i><b>4</b> 크롤링 이해하기</a><ul>
<li class="chapter" data-level="4.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get과-post-방식-이해하기"><i class="fa fa-check"></i><b>4.1</b> GET과 POST 방식 이해하기</a><ul>
<li class="chapter" data-level="4.1.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#get-방식"><i class="fa fa-check"></i><b>4.1.1</b> GET 방식</a></li>
<li class="chapter" data-level="4.1.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#post-방식"><i class="fa fa-check"></i><b>4.1.2</b> POST 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#크롤링-예제"><i class="fa fa-check"></i><b>4.2</b> 크롤링 예제</a><ul>
<li class="chapter" data-level="4.2.1" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#금융-속보-크롤링"><i class="fa fa-check"></i><b>4.2.1</b> 금융 속보 크롤링</a></li>
<li class="chapter" data-level="4.2.2" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#기업공시채널에서-오늘의-공시-불러오기"><i class="fa fa-check"></i><b>4.2.2</b> 기업공시채널에서 오늘의 공시 불러오기</a></li>
<li class="chapter" data-level="4.2.3" data-path="크롤링-이해하기.html"><a href="크롤링-이해하기.html#네이버-금융에서-주식티커-크롤링"><i class="fa fa-check"></i><b>4.2.3</b> 네이버 금융에서 주식티커 크롤링</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html"><i class="fa fa-check"></i><b>5</b> 데이터 정리하기</a><ul>
<li class="chapter" data-level="5.1" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#주가-정리하기"><i class="fa fa-check"></i><b>5.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="5.2" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#재무제표-정리하기"><i class="fa fa-check"></i><b>5.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="5.3" data-path="데이터-정리하기.html"><a href="데이터-정리하기.html#가치지표-정리하기"><i class="fa fa-check"></i><b>5.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html"><i class="fa fa-check"></i><b>6</b> 금융 데이터 수집하기 (심화)</a><ul>
<li class="chapter" data-level="6.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#수정주가-크롤링"><i class="fa fa-check"></i><b>6.1</b> 수정주가 크롤링</a><ul>
<li class="chapter" data-level="6.1.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#개별종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.1</b> 개별종목 주가 크롤링</a></li>
<li class="chapter" data-level="6.1.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-주가-크롤링"><i class="fa fa-check"></i><b>6.1.2</b> 전 종목 주가 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-및-가치지표-크롤링"><i class="fa fa-check"></i><b>6.2</b> 재무제표 및 가치지표 크롤링</a><ul>
<li class="chapter" data-level="6.2.1" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#재무제표-다운로드"><i class="fa fa-check"></i><b>6.2.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.2.2" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#가치지표-계산하기"><i class="fa fa-check"></i><b>6.2.2</b> 가치지표 계산하기</a></li>
<li class="chapter" data-level="6.2.3" data-path="금융-데이터-수집하기-심화.html"><a href="금융-데이터-수집하기-심화.html#전-종목-재무제표-및-가치지표-다운로드"><i class="fa fa-check"></i><b>6.2.3</b> 전 종목 재무제표 및 가치지표 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="데이터-정리하기-1.html"><a href="데이터-정리하기-1.html"><i class="fa fa-check"></i><b>7</b> 데이터 정리하기</a><ul>
<li class="chapter" data-level="7.1" data-path="데이터-정리하기-1.html"><a href="데이터-정리하기-1.html#주가-정리하기-1"><i class="fa fa-check"></i><b>7.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="7.2" data-path="데이터-정리하기-1.html"><a href="데이터-정리하기-1.html#재무제표-정리하기-1"><i class="fa fa-check"></i><b>7.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="7.3" data-path="데이터-정리하기-1.html"><a href="데이터-정리하기-1.html#가치지표-정리하기-1"><i class="fa fa-check"></i><b>7.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html"><i class="fa fa-check"></i><b>8</b> 데이터 분석 및 시각화하기</a><ul>
<li class="chapter" data-level="8.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-데이터-분석"><i class="fa fa-check"></i><b>8.1</b> 종목정보 데이터 분석</a><ul>
<li class="chapter" data-level="8.1.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#join-데이터-합치기"><i class="fa fa-check"></i><b>8.1.1</b> <code>*_join</code>: 데이터 합치기</a></li>
<li class="chapter" data-level="8.1.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#glimpse-데이터-구조-확인하기"><i class="fa fa-check"></i><b>8.1.2</b> <code>glimpse()</code>: 데이터 구조 확인하기</a></li>
<li class="chapter" data-level="8.1.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#rename-열-이름-바꾸기"><i class="fa fa-check"></i><b>8.1.3</b> <code>rename()</code>: 열 이름 바꾸기</a></li>
<li class="chapter" data-level="8.1.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#distinct-고유한-값-확인"><i class="fa fa-check"></i><b>8.1.4</b> distinct(): 고유한 값 확인</a></li>
<li class="chapter" data-level="8.1.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#select-원하는-열만-선택"><i class="fa fa-check"></i><b>8.1.5</b> <code>select()</code>: 원하는 열만 선택</a></li>
<li class="chapter" data-level="8.1.6" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#mutate-열-생성-및-데이터-변형"><i class="fa fa-check"></i><b>8.1.6</b> <code>mutate()</code>: 열 생성 및 데이터 변형</a></li>
<li class="chapter" data-level="8.1.7" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#filter-조건을-충족하는-행-선택"><i class="fa fa-check"></i><b>8.1.7</b> <code>filter()</code>: 조건을 충족하는 행 선택</a></li>
<li class="chapter" data-level="8.1.8" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#summarize-요약-통곗값-계산"><i class="fa fa-check"></i><b>8.1.8</b> <code>summarize()</code>: 요약 통곗값 계산</a></li>
<li class="chapter" data-level="8.1.9" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#arrange-데이터-정렬"><i class="fa fa-check"></i><b>8.1.9</b> <code>arrange()</code>: 데이터 정렬</a></li>
<li class="chapter" data-level="8.1.10" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#row_number-순위-계산"><i class="fa fa-check"></i><b>8.1.10</b> <code>row_number()</code>: 순위 계산</a></li>
<li class="chapter" data-level="8.1.11" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#ntile-분위수-계산"><i class="fa fa-check"></i><b>8.1.11</b> <code>ntile()</code>: 분위수 계산</a></li>
<li class="chapter" data-level="8.1.12" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#group_by-그룹별로-데이터를-묶기"><i class="fa fa-check"></i><b>8.1.12</b> <code>group_by()</code>: 그룹별로 데이터를 묶기</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#종목정보-시각화"><i class="fa fa-check"></i><b>8.2</b> 종목정보 시각화</a><ul>
<li class="chapter" data-level="8.2.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_point-산점도-나타내기"><i class="fa fa-check"></i><b>8.2.1</b> <code>geom_point()</code>: 산점도 나타내기</a></li>
<li class="chapter" data-level="8.2.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_histogram-히스토그램-나타내기"><i class="fa fa-check"></i><b>8.2.2</b> <code>geom_histogram()</code>: 히스토그램 나타내기</a></li>
<li class="chapter" data-level="8.2.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_boxplot-박스-플롯-나타내기"><i class="fa fa-check"></i><b>8.2.3</b> <code>geom_boxplot()</code>: 박스 플롯 나타내기</a></li>
<li class="chapter" data-level="8.2.4" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#dplyr과-ggplot을-연결하여-사용하기"><i class="fa fa-check"></i><b>8.2.4</b> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</a></li>
<li class="chapter" data-level="8.2.5" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#geom_bar-막대-그래프-나타내기"><i class="fa fa-check"></i><b>8.2.5</b> <code>geom_bar()</code>: 막대 그래프 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-및-수익률-시각화"><i class="fa fa-check"></i><b>8.3</b> 주가 및 수익률 시각화</a><ul>
<li class="chapter" data-level="8.3.1" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#주가-그래프-나타내기"><i class="fa fa-check"></i><b>8.3.1</b> 주가 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.2" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#인터랙티브-그래프-나타내기"><i class="fa fa-check"></i><b>8.3.2</b> 인터랙티브 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.3" data-path="데이터-분석-및-시각화하기.html"><a href="데이터-분석-및-시각화하기.html#연도별-수익률-나타내기"><i class="fa fa-check"></i><b>8.3.3</b> 연도별 수익률 나타내기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html"><i class="fa fa-check"></i><b>9</b> 퀀트 전략을 이용한 종목선정 (기본)</a><ul>
<li class="chapter" data-level="9.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-이해하기"><i class="fa fa-check"></i><b>9.1</b> 베타 이해하기</a><ul>
<li class="chapter" data-level="9.1.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-계산하기"><i class="fa fa-check"></i><b>9.1.1</b> 베타 계산하기</a></li>
<li class="chapter" data-level="9.1.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#베타-시각화"><i class="fa fa-check"></i><b>9.1.2</b> 베타 시각화</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-전략"><i class="fa fa-check"></i><b>9.2</b> 저변동성 전략</a><ul>
<li class="chapter" data-level="9.2.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-일간-기준"><i class="fa fa-check"></i><b>9.2.1</b> 저변동성 포트폴리오 구하기: 일간 기준</a></li>
<li class="chapter" data-level="9.2.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#저변동성-포트폴리오-구하기-주간-기준"><i class="fa fa-check"></i><b>9.2.2</b> 저변동성 포트폴리오 구하기: 주간 기준</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-전략"><i class="fa fa-check"></i><b>9.3</b> 모멘텀 전략</a><ul>
<li class="chapter" data-level="9.3.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-12개월-모멘텀"><i class="fa fa-check"></i><b>9.3.1</b> 모멘텀 포트폴리오 구하기: 12개월 모멘텀</a></li>
<li class="chapter" data-level="9.3.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#모멘텀-포트폴리오-구하기-위험조정-수익률"><i class="fa fa-check"></i><b>9.3.2</b> 모멘텀 포트폴리오 구하기: 위험조정 수익률</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-전략"><i class="fa fa-check"></i><b>9.4</b> 밸류 전략</a><ul>
<li class="chapter" data-level="9.4.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#밸류-포트폴리오-구하기-저pbr"><i class="fa fa-check"></i><b>9.4.1</b> 밸류 포트폴리오 구하기: 저PBR</a></li>
<li class="chapter" data-level="9.4.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표-결합하기"><i class="fa fa-check"></i><b>9.4.2</b> 각 지표 결합하기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#퀄리티-전략"><i class="fa fa-check"></i><b>9.5</b> 퀄리티 전략</a><ul>
<li class="chapter" data-level="9.5.1" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#f-score"><i class="fa fa-check"></i><b>9.5.1</b> F-Score</a></li>
<li class="chapter" data-level="9.5.2" data-path="퀀트-전략을-이용한-종목선정-기본.html"><a href="퀀트-전략을-이용한-종목선정-기본.html#각-지표를-결합하기"><i class="fa fa-check"></i><b>9.5.2</b> 각 지표를 결합하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html"><i class="fa fa-check"></i><b>10</b> 퀀트 전략을 이용한 종목선정 (심화)</a><ul>
<li class="chapter" data-level="10.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#섹터-중립-포트폴리오"><i class="fa fa-check"></i><b>10.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="10.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식"><i class="fa fa-check"></i><b>10.2</b> 마법공식</a><ul>
<li class="chapter" data-level="10.2.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#퀄리티와-밸류-간의-관계"><i class="fa fa-check"></i><b>10.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="10.2.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-이해하기"><i class="fa fa-check"></i><b>10.2.2</b> 마법공식 이해하기</a></li>
<li class="chapter" data-level="10.2.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#마법공식-구성하기"><i class="fa fa-check"></i><b>10.2.3</b> 마법공식 구성하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#이상치-데이터-제거-및-팩터의-결합"><i class="fa fa-check"></i><b>10.3</b> 이상치 데이터 제거 및 팩터의 결합</a><ul>
<li class="chapter" data-level="10.3.1" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#트림trim-이상치-데이터-삭제"><i class="fa fa-check"></i><b>10.3.1</b> 트림(Trim): 이상치 데이터 삭제</a></li>
<li class="chapter" data-level="10.3.2" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#윈저라이징winsorizing-이상치-데이터-대체"><i class="fa fa-check"></i><b>10.3.2</b> 윈저라이징(Winsorizing): 이상치 데이터 대체</a></li>
<li class="chapter" data-level="10.3.3" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#팩터의-결합-방법"><i class="fa fa-check"></i><b>10.3.3</b> 팩터의 결합 방법</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="퀀트-전략을-이용한-종목선정-심화.html"><a href="퀀트-전략을-이용한-종목선정-심화.html#멀티팩터-포트폴리오"><i class="fa fa-check"></i><b>10.4</b> 멀티팩터 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html"><i class="fa fa-check"></i><b>11</b> 포트폴리오 구성</a><ul>
<li class="chapter" data-level="11.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소분산-포트폴리오"><i class="fa fa-check"></i><b>11.1</b> 최소분산 포트폴리오</a><ul>
<li class="chapter" data-level="11.1.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#slsqp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.1</b> <code>slsqp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.2</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.1.3</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#결괏값들의-비교"><i class="fa fa-check"></i><b>11.1.4</b> 결괏값들의 비교</a></li>
<li class="chapter" data-level="11.1.5" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건"><i class="fa fa-check"></i><b>11.1.5</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.1.6" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산별-제약조건의-추가"><i class="fa fa-check"></i><b>11.1.6</b> 각 자산별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최대분산효과-포트폴리오"><i class="fa fa-check"></i><b>11.2</b> 최대분산효과 포트폴리오</a><ul>
<li class="chapter" data-level="11.2.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#solve.qp-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.1</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#optimalportfolio-함수를-이용한-최적화-1"><i class="fa fa-check"></i><b>11.2.2</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#최소-및-최대-투자비중-제약조건-1"><i class="fa fa-check"></i><b>11.2.3</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.2.4" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#각-자산-별-제약조건의-추가"><i class="fa fa-check"></i><b>11.2.4</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험균형-포트폴리오"><i class="fa fa-check"></i><b>11.3</b> 위험균형 포트폴리오</a><ul>
<li class="chapter" data-level="11.3.1" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#주식-60와-채권-40-포트폴리오의-위험기여도"><i class="fa fa-check"></i><b>11.3.1</b> 주식 60%와 채권 40% 포트폴리오의 위험기여도</a></li>
<li class="chapter" data-level="11.3.2" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#rp-함수를-이용한-최적화"><i class="fa fa-check"></i><b>11.3.2</b> <code>rp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.3.3" data-path="포트폴리오-구성.html"><a href="포트폴리오-구성.html#위험예산-포트폴리오"><i class="fa fa-check"></i><b>11.3.3</b> 위험예산 포트폴리오</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html"><i class="fa fa-check"></i><b>12</b> 포트폴리오 백테스트</a><ul>
<li class="chapter" data-level="12.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#return.portfolio-함수"><i class="fa fa-check"></i><b>12.1</b> <code>Return.Portfolio()</code> 함수</a><ul>
<li class="chapter" data-level="12.1.1" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#인자-목록-살펴보기"><i class="fa fa-check"></i><b>12.1.1</b> 인자 목록 살펴보기</a></li>
<li class="chapter" data-level="12.1.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#출력값-살펴보기"><i class="fa fa-check"></i><b>12.1.2</b> 출력값 살펴보기</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#전통적인-60대-40-포트폴리오-백테스트"><i class="fa fa-check"></i><b>12.2</b> 전통적인 60대 40 포트폴리오 백테스트</a></li>
<li class="chapter" data-level="12.3" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#시점-선택-전략-백테스트"><i class="fa fa-check"></i><b>12.3</b> 시점 선택 전략 백테스트</a></li>
<li class="chapter" data-level="12.4" data-path="포트폴리오-백테스트.html"><a href="포트폴리오-백테스트.html#동적-자산배분-백테스트"><i class="fa fa-check"></i><b>12.4</b> 동적 자산배분 백테스트</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html"><i class="fa fa-check"></i><b>13</b> 성과 및 위험 평가</a><ul>
<li class="chapter" data-level="13.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#결과-측정-지표"><i class="fa fa-check"></i><b>13.1</b> 결과 측정 지표</a><ul>
<li class="chapter" data-level="13.1.1" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#수익률-및-변동성"><i class="fa fa-check"></i><b>13.1.1</b> 수익률 및 변동성</a></li>
<li class="chapter" data-level="13.1.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#낙폭과-최대낙폭"><i class="fa fa-check"></i><b>13.1.2</b> 낙폭과 최대낙폭</a></li>
<li class="chapter" data-level="13.1.3" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#연도별-수익률"><i class="fa fa-check"></i><b>13.1.3</b> 연도별 수익률</a></li>
<li class="chapter" data-level="13.1.4" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#승률-및-롤링-윈도우-값"><i class="fa fa-check"></i><b>13.1.4</b> 승률 및 롤링 윈도우 값</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="성과-및-위험-평가.html"><a href="성과-및-위험-평가.html#팩터-회귀분석-및-테이블로-나타내기"><i class="fa fa-check"></i><b>13.2</b> 팩터 회귀분석 및 테이블로 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="http://henryquant.blogspot.com/" target="blank">Henry's Quantopia</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R을 이용한 퀀트 투자 포트폴리오 만들기</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="금융-데이터-수집하기-심화" class="section level1">
<h1><span class="header-section-number">Chapter 6</span> 금융 데이터 수집하기 (심화)</h1>
<p>지난 CHAPTER에서 수집한 주식티커를 바탕으로 이번 CHAPTER에서는 퀀트 투자의 핵심 자료인 수정주가, 재무제표, 가치지표를 크롤링하는 방법을 알아보겠습니다.</p>
<div id="수정주가-크롤링" class="section level2">
<h2><span class="header-section-number">6.1</span> 수정주가 크롤링</h2>
<p>주가 데이터는 투자를 함에 있어 반드시 필요한 데이터이며, 인터넷에서 주가를 수집할 수 있는 방법은 매우 많습니다. 먼저 API를 이용한 데이터 수집에서 살펴본 것과 같이, <code>getSymbols()</code> 함수를 이용해 데이터를 받을 수 있습니다. 그러나 야후 파이낸스에서 제공하는 데이터 중 미국 주가는 이상 없이 다운로드되지만, 국내 중소형주는 주가가 없는 경우가 있습니다.</p>
<p>또한 단순 주가를 구할 수 있는 방법은 많지만, 투자에 필요한 수정주가를 구할 수 있는 방법은 찾기 힘듭니다. 다행히 네이버 금융에서 제공하는 정보를 통해 모든 종목의 수정주가를 매우 손쉽게 구할 수 있습니다.</p>
<div id="개별종목-주가-크롤링" class="section level3">
<h3><span class="header-section-number">6.1.1</span> 개별종목 주가 크롤링</h3>
<p>먼저 네이버 금융에서 특정종목(예: 삼성전자)의 [차트] 탭<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>을 선택합니다.<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> 해당 차트는 주가 데이터를 받아 그래프를 그려주는 형태입니다. 따라서 해당 데이터가 어디에서 오는지 알기 위해 개발자 도구 화면을 이용합니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="images/crawl_practice_price2.png" alt="네이버금융 차트의 통신기록" width="70%" />
<p class="caption">
그림 1.3: 네이버금융 차트의 통신기록
</p>
</div>
<p>화면을 연 상태에서 [일봉] 탭을 선택하면 sise.nhn, schedule.nhn, notice.nhn 총 세 가지 항목이 생성됩니다. 이 중 sise.nhn 항목의 Request URL이 주가 데이터를 요청하는 주소입니다. 해당 URL에 접속해보겠습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-2"></span>
<img src="images/crawl_practice_price3.png" alt="주가 데이터 페이지" width="70%" />
<p class="caption">
그림 2.1: 주가 데이터 페이지
</p>
</div>
<p>각 날짜별로 시가, 고가, 저가, 종가, 거래량이 있으며, 주가는 모두 수정주가 기준입니다. 또한 해당 데이터가 item 태그 내 data 속성에 위치하고 있습니다.</p>
<p>URL에서 symbol= 뒤에 6자리 티커만 변경하면 해당 종목의 주가 데이터가 있는 페이지로 이동할 수 있으며, 우리가 원하는 모든 종목의 주가 데이터를 크롤링할 수 있습니다.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb112-2" data-line-number="2"></a>
<a class="sourceLine" id="cb112-3" data-line-number="3">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb112-4" data-line-number="4"><span class="kw">print</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</a></code></pre></div>
<pre><code>## [1] 5930</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb114-2" data-line-number="2"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a></code></pre></div>
<p>먼저 저장해두었던 csv 파일을 불러옵니다. 종목코드를 살펴보면 005930이어야 할 삼성전자의 티커가 5930으로 입력되어 있습니다. 이는 파일을 불러오는 과정에서 0으로 시작하는 숫자들이 지워졌기 때문입니다. stringr 패키지의 <code>str_pad()</code> 함수를 사용해 6자리가 되지 않는 문자는 왼쪽에 0을 추가해 강제로 6자리로 만들어주도록 합니다.</p>
<p>다음은 첫 번째 종목인 삼성전자의 주가를 크롤링한 후 가공하는 방법입니다.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1"><span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb115-2" data-line-number="2"></a>
<a class="sourceLine" id="cb115-3" data-line-number="3"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb115-4" data-line-number="4">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1">i =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb117-2" data-line-number="2">name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i]</a>
<a class="sourceLine" id="cb117-3" data-line-number="3"></a>
<a class="sourceLine" id="cb117-4" data-line-number="4">price =<span class="st"> </span><span class="kw">xts</span>(<span class="ot">NA</span>, <span class="dt">order.by =</span> <span class="kw">Sys.Date</span>())</a>
<a class="sourceLine" id="cb117-5" data-line-number="5"><span class="kw">print</span>(price)</a></code></pre></div>
<pre><code>##            [,1]
## 2020-03-17   NA</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_price 폴더를 생성합니다.</li>
<li>i = 1을 입력합니다. 향후 for loop 구문을 통해 i 값만 변경하면 모든 종목의 주가를 다운로드할 수 있습니다.</li>
<li>name에 해당 티커를 입력합니다.</li>
<li><code>xts()</code> 함수를 이용해 빈 시계열 데이터를 생성하며, 인덱스는 <code>Sys.Date()</code>를 통해 현재 날짜를 입력합니다.</li>
</ol>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb119-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb119-3" data-line-number="3"></a>
<a class="sourceLine" id="cb119-4" data-line-number="4">url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb119-5" data-line-number="5">  <span class="st">&#39;https://fchart.stock.naver.com/sise.nhn?symbol=&#39;</span>,</a>
<a class="sourceLine" id="cb119-6" data-line-number="6">  name,<span class="st">&#39;&amp;timeframe=day&amp;count=500&amp;requestType=0&#39;</span>)</a>
<a class="sourceLine" id="cb119-7" data-line-number="7">data =<span class="st"> </span><span class="kw">GET</span>(url)</a>
<a class="sourceLine" id="cb119-8" data-line-number="8">data_html =<span class="st"> </span><span class="kw">read_html</span>(data, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-9" data-line-number="9"><span class="st">  </span><span class="kw">html_nodes</span>(<span class="st">&#39;item&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb119-10" data-line-number="10"><span class="st">  </span><span class="kw">html_attr</span>(<span class="st">&#39;data&#39;</span>) </a>
<a class="sourceLine" id="cb119-11" data-line-number="11"></a>
<a class="sourceLine" id="cb119-12" data-line-number="12"><span class="kw">print</span>(<span class="kw">head</span>(data_html))</a></code></pre></div>
<pre><code>## [1] &quot;20180306|45920|47100|45820|47020|308467&quot;
## [2] &quot;20180307|48200|48900|47220|48620|428541&quot;
## [3] &quot;20180308|49200|49480|48080|49200|389273&quot;
## [4] &quot;20180309|49440|50540|49240|49740|286088&quot;
## [5] &quot;20180312|50560|50780|49580|49740|173779&quot;
## [6] &quot;20180313|50760|51660|50360|51660|401974&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>paste0()</code> 함수를 이용해 원하는 종목의 url을 생성합니다. url 중 티커에 해당하는 6자리 부분만 위에서 입력한 name으로 설정해주면 됩니다.</li>
<li><code>GET()</code> 함수를 통해 페이지의 데이터를 불러옵니다.</li>
<li><code>read_html()</code> 함수를 통해 HTML 정보를 읽어옵니다.</li>
<li><code>html_nodes()</code>와 <code>html_attr()</code> 함수를 통해 item 태그 및 data 속성의 데이터를 추출합니다.</li>
</ol>
<p>결과적으로 날짜 및 주가, 거래량 데이터가 추출됩니다. 해당 데이터는 |으로 구분되어 있으며, 이를 테이블 형태로 바꿀 필요가 있습니다.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb121-2" data-line-number="2"></a>
<a class="sourceLine" id="cb121-3" data-line-number="3">price =<span class="st"> </span><span class="kw">read_delim</span>(data_html, <span class="dt">delim =</span> <span class="st">&#39;|&#39;</span>)</a>
<a class="sourceLine" id="cb121-4" data-line-number="4"><span class="kw">print</span>(<span class="kw">head</span>(price))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 6
##   `20180306` `45920` `47100` `45820` `47020` `308467`
##        &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
## 1   20180307   48200   48900   47220   48620   428541
## 2   20180308   49200   49480   48080   49200   389273
## 3   20180309   49440   50540   49240   49740   286088
## 4   20180312   50560   50780   49580   49740   173779
## 5   20180313   50760   51660   50360   51660   401974
## 6   20180314   51020   52000   51000   51760   254265</code></pre>
<p>readr 패키지의 <code>read_delim()</code> 함수를 쓰면 구분자로 이루어진 데이터를 테이블로 쉽게 변경할 수 있습니다. 데이터를 확인해보면 테이블 형태로 변경되었으며 각 열은 날짜, 시가, 고가, 저가, 종가, 거래량을 의미합니다. 이 중 우리가 필요한 날짜와 종가를 선택한 후 데이터 클렌징을 해줍니다.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb123-2" data-line-number="2"><span class="kw">library</span>(timetk)</a>
<a class="sourceLine" id="cb123-3" data-line-number="3"></a>
<a class="sourceLine" id="cb123-4" data-line-number="4">price =<span class="st"> </span>price[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)] </a>
<a class="sourceLine" id="cb123-5" data-line-number="5">price =<span class="st"> </span><span class="kw">data.frame</span>(price)</a>
<a class="sourceLine" id="cb123-6" data-line-number="6"><span class="kw">colnames</span>(price) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>)</a>
<a class="sourceLine" id="cb123-7" data-line-number="7">price[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">ymd</span>(price[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb123-8" data-line-number="8">price =<span class="st"> </span><span class="kw">tk_xts</span>(price, <span class="dt">date_var =</span> Date)</a>
<a class="sourceLine" id="cb123-9" data-line-number="9"> </a>
<a class="sourceLine" id="cb123-10" data-line-number="10"><span class="kw">print</span>(<span class="kw">tail</span>(price))</a></code></pre></div>
<pre><code>##            Price
## 2020-03-10 54600
## 2020-03-11 52100
## 2020-03-12 50800
## 2020-03-13 49950
## 2020-03-16 48900
## 2020-03-17 49550</code></pre>
<ol style="list-style-type: decimal">
<li>날짜에 해당하는 첫 번째 열과, 종가에 해당하는 다섯 번째 열만 선택해 저장합니다.</li>
<li>티블 형태의 데이터를 데이터 프레임 형태로 변경합니다.</li>
<li>열 이름을 Date와 Price로 변경합니다.</li>
<li>lubridate 패키지의 <code>ymd()</code> 함수를 이용하면 yyyymmdd 형태가 yyyy-mm-dd로 변경되며 데이터 형태 또한 Date 타입으로 변경됩니다.</li>
<li><code>timetk</code> 패키지의 <code>tk_xts()</code> 함수를 이용해 시계열 형태로 변경하며, 인덱스는 Date 열을 설정합니다. 형태를 변경한 후 해당 열은 자동으로 삭제됩니다.</li>
</ol>
<p>데이터를 확인해보면 우리에게 필요한 형태로 정리되었습니다.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1"><span class="kw">write.csv</span>(price, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name,</a>
<a class="sourceLine" id="cb125-2" data-line-number="2">                        <span class="st">&#39;_price.csv&#39;</span>))</a></code></pre></div>
<p>마지막으로 해당 데이터를 data 폴더의 KOR_price 폴더 내에 티커_price.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-주가-크롤링" class="section level3">
<h3><span class="header-section-number">6.1.2</span> 전 종목 주가 크롤링</h3>
<p>위의 코드에서 for loop 구문을 이용해 i 값만 변경해주면 모든 종목의 주가를 다운로드할 수 있습니다. 전 종목 주가를 다운로드하는 전체 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb126-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb126-3" data-line-number="3"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb126-4" data-line-number="4"><span class="kw">library</span>(xts)</a>
<a class="sourceLine" id="cb126-5" data-line-number="5"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb126-6" data-line-number="6"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb126-7" data-line-number="7"></a>
<a class="sourceLine" id="cb126-8" data-line-number="8">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb126-9" data-line-number="9"><span class="kw">print</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb126-10" data-line-number="10">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb126-11" data-line-number="11"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb126-12" data-line-number="12"></a>
<a class="sourceLine" id="cb126-13" data-line-number="13"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_price&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb126-14" data-line-number="14">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_price&#39;</span>))</a>
<a class="sourceLine" id="cb126-15" data-line-number="15"></a>
<a class="sourceLine" id="cb126-16" data-line-number="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(KOR_ticker) ) {</a>
<a class="sourceLine" id="cb126-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb126-18" data-line-number="18">  price =<span class="st"> </span><span class="kw">xts</span>(<span class="ot">NA</span>, <span class="dt">order.by =</span> <span class="kw">Sys.Date</span>()) <span class="co"># 빈 시계열 데이터 생성</span></a>
<a class="sourceLine" id="cb126-19" data-line-number="19">  name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i] <span class="co"># 티커 부분 선택</span></a>
<a class="sourceLine" id="cb126-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb126-21" data-line-number="21">  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></a>
<a class="sourceLine" id="cb126-22" data-line-number="22">  <span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb126-23" data-line-number="23">    <span class="co"># url 생성</span></a>
<a class="sourceLine" id="cb126-24" data-line-number="24">    url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb126-25" data-line-number="25">      <span class="st">&#39;https://fchart.stock.naver.com/sise.nhn?symbol=&#39;</span></a>
<a class="sourceLine" id="cb126-26" data-line-number="26">      ,name,<span class="st">&#39;&amp;timeframe=day&amp;count=500&amp;requestType=0&#39;</span>)</a>
<a class="sourceLine" id="cb126-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb126-28" data-line-number="28">    <span class="co"># 이 후 과정은 위와 동일함</span></a>
<a class="sourceLine" id="cb126-29" data-line-number="29">    <span class="co"># 데이터 다운로드</span></a>
<a class="sourceLine" id="cb126-30" data-line-number="30">    data =<span class="st"> </span><span class="kw">GET</span>(url)</a>
<a class="sourceLine" id="cb126-31" data-line-number="31">    data_html =<span class="st"> </span><span class="kw">read_html</span>(data, <span class="dt">encoding =</span> <span class="st">&#39;EUC-KR&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-32" data-line-number="32"><span class="st">      </span><span class="kw">html_nodes</span>(<span class="st">&quot;item&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb126-33" data-line-number="33"><span class="st">      </span><span class="kw">html_attr</span>(<span class="st">&quot;data&quot;</span>) </a>
<a class="sourceLine" id="cb126-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb126-35" data-line-number="35">    <span class="co"># 데이터 나누기</span></a>
<a class="sourceLine" id="cb126-36" data-line-number="36">    price =<span class="st"> </span><span class="kw">read_delim</span>(data_html, <span class="dt">delim =</span> <span class="st">&#39;|&#39;</span>)</a>
<a class="sourceLine" id="cb126-37" data-line-number="37">    </a>
<a class="sourceLine" id="cb126-38" data-line-number="38">    <span class="co"># 필요한 열만 선택 후 클렌징</span></a>
<a class="sourceLine" id="cb126-39" data-line-number="39">    price =<span class="st"> </span>price[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>)] </a>
<a class="sourceLine" id="cb126-40" data-line-number="40">    price =<span class="st"> </span><span class="kw">data.frame</span>(price)</a>
<a class="sourceLine" id="cb126-41" data-line-number="41">    <span class="kw">colnames</span>(price) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Date&#39;</span>, <span class="st">&#39;Price&#39;</span>)</a>
<a class="sourceLine" id="cb126-42" data-line-number="42">    price[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">ymd</span>(price[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb126-43" data-line-number="43">    </a>
<a class="sourceLine" id="cb126-44" data-line-number="44">    <span class="kw">rownames</span>(price) =<span class="st"> </span>price[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb126-45" data-line-number="45">    price[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb126-46" data-line-number="46">    </a>
<a class="sourceLine" id="cb126-47" data-line-number="47">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb126-48" data-line-number="48">    </a>
<a class="sourceLine" id="cb126-49" data-line-number="49">    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></a>
<a class="sourceLine" id="cb126-50" data-line-number="50">    <span class="kw">warning</span>(<span class="kw">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</a>
<a class="sourceLine" id="cb126-51" data-line-number="51">  })</a>
<a class="sourceLine" id="cb126-52" data-line-number="52">  </a>
<a class="sourceLine" id="cb126-53" data-line-number="53">  <span class="co"># 다운로드 받은 파일을 생성한 폴더 내 csv 파일로 저장</span></a>
<a class="sourceLine" id="cb126-54" data-line-number="54">  <span class="kw">write.csv</span>(price, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_price/&#39;</span>, name,</a>
<a class="sourceLine" id="cb126-55" data-line-number="55">                          <span class="st">&#39;_price.csv&#39;</span>))</a>
<a class="sourceLine" id="cb126-56" data-line-number="56">  </a>
<a class="sourceLine" id="cb126-57" data-line-number="57">  <span class="co"># 타임슬립 적용</span></a>
<a class="sourceLine" id="cb126-58" data-line-number="58">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb126-59" data-line-number="59">}</a></code></pre></div>
<p>위 코드에서 추가된 점은 다음과 같습니다. 페이지 오류, 통신 오류 등 오류가 발생할 경우 for loop 구문은 멈춰버리는데 전체 데이터를 처음부터 다시 받는 일은 매우 귀찮은 작업입니다. 따라서 <code>tryCatch()</code> 함수를 이용해 오류가 발생할 때 해당 티커를 출력한 후 다음 루프로 넘어가게 합니다.</p>
<p>또한 오류가 발생하면 <code>xts()</code> 함수를 통해 만들어둔 빈 데이터를 저장하게 됩니다. 마지막으로 무한 크롤링을 방지하기 위해 한 번의 루프가 끝날 때마다 2초의 타임슬립을 적용했습니다.</p>
<p>위 코드가 모두 돌아가는 데는 수 시간이 걸립니다. 작업이 끝난 후 data/KOR_price 폴더를 확인해보면 전 종목 주가가 csv 형태로 저장되어 있습니다.</p>
</div>
</div>
<div id="재무제표-및-가치지표-크롤링" class="section level2">
<h2><span class="header-section-number">6.2</span> 재무제표 및 가치지표 크롤링</h2>
<p>주가와 더불어 재무제표와 가치지표 역시 투자에 있어 핵심이 되는 데이터입니다. 해당 데이터 역시 여러 웹사이트에서 구할 수 있지만, 국내 데이터 제공업체인 FnGuide에서 운영하는 Company Guide 웹사이트<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>에서 손쉽게 구할 수 있습니다.</p>
<div id="재무제표-다운로드" class="section level3">
<h3><span class="header-section-number">6.2.1</span> 재무제표 다운로드</h3>
<p>먼저 개별종목의 재무제표를 탭을 선택하면 포괄손익계산서, 재무상태표, 현금흐름표 항목이 보이게 되며, 티커에 해당하는 A005930 뒤의 주소는 불필요한 내용이므로, 이를 제거한 주소로 접속합니다. A 뒤의 6자리 티커만 변경한다면 해당 종목의 재무제표 페이지로 이동하게 됩니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>우리가 원하는 재무제표 항목들은 모두 테이블 형태로 제공되고 있으므로 html_table() 함수를 이용해 추출할 수 있습니다.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb127-2" data-line-number="2"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb127-3" data-line-number="3"></a>
<a class="sourceLine" id="cb127-4" data-line-number="4"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb127-5" data-line-number="5">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</a>
<a class="sourceLine" id="cb127-6" data-line-number="6"></a>
<a class="sourceLine" id="cb127-7" data-line-number="7"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;English&quot;</span>)</a>
<a class="sourceLine" id="cb127-8" data-line-number="8"></a>
<a class="sourceLine" id="cb127-9" data-line-number="9">url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&amp;gicode=A005930&#39;</span>)</a>
<a class="sourceLine" id="cb127-10" data-line-number="10"></a>
<a class="sourceLine" id="cb127-11" data-line-number="11">data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb127-12" data-line-number="12">           <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb127-13" data-line-number="13"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb127-14" data-line-number="14">data =<span class="st"> </span>data <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-15" data-line-number="15"><span class="st">  </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb127-16" data-line-number="16"><span class="st">  </span><span class="kw">html_table</span>()</a>
<a class="sourceLine" id="cb127-17" data-line-number="17"></a>
<a class="sourceLine" id="cb127-18" data-line-number="18"><span class="kw">Sys.setlocale</span>(<span class="st">&quot;LC_ALL&quot;</span>, <span class="st">&quot;Korean&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" data-line-number="1"><span class="kw">lapply</span>(data, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb128-2" data-line-number="2">  <span class="kw">head</span>(x, <span class="dv">3</span>)})</a></code></pre></div>
<pre><code>## [[1]]
##   IFRS(연결)   2016/12   2017/12   2018/12   2019/12
## 1     매출액 2,018,667 2,395,754 2,437,714 2,304,009
## 2   매출원가 1,202,777 1,292,907 1,323,944 1,472,395
## 3 매출총이익   815,890 1,102,847 1,113,770   831,613
##    전년동기 전년동기(%)
## 1 2,437,714        -5.5
## 2 1,323,944        11.2
## 3 1,113,770       -25.3
## 
## [[2]]
##   IFRS(연결) 2019/03 2019/06 2019/09 2019/12 전년동기
## 1     매출액 523,855 561,271 620,035 598,848  592,651
## 2   매출원가 327,465 359,447 399,939 385,545  340,160
## 3 매출총이익 196,391 201,824 220,096 213,302  252,491
##   전년동기(%)
## 1         1.0
## 2        13.3
## 3       -15.5
## 
## [[3]]
##                          IFRS(연결)   2016/12   2017/12
## 1                              자산 2,621,743 3,017,521
## 2 유동자산계산에 참여한 계정 펼치기 1,414,297 1,469,825
## 3                          재고자산   183,535   249,834
##     2018/12   2019/12
## 1 3,393,572 3,525,645
## 2 1,746,974 1,813,853
## 3   289,847   267,665
## 
## [[4]]
##                          IFRS(연결)   2019/03   2019/06
## 1                              자산 3,450,679 3,429,401
## 2 유동자산계산에 참여한 계정 펼치기 1,773,885 1,734,335
## 3                          재고자산   314,560   312,470
##     2019/09   2019/12
## 1 3,533,860 3,525,645
## 2 1,860,421 1,813,853
## 3   309,088   267,665
## 
## [[5]]
##                     IFRS(연결) 2016/12 2017/12 2018/12
## 1     영업활동으로인한현금흐름 473,856 621,620 670,319
## 2                   당기순손익 227,261 421,867 443,449
## 3 법인세비용차감전계속사업이익                        
##   2019/12
## 1 453,829
## 2 217,389
## 3        
## 
## [[6]]
##                     IFRS(연결) 2019/03 2019/06 2019/09
## 1     영업활동으로인한현금흐름  52,443  65,949 138,266
## 2                   당기순손익  50,436  51,806  62,877
## 3 법인세비용차감전계속사업이익                        
##   2019/12
## 1 197,171
## 2  52,270
## 3</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_fs 폴더를 생성합니다.</li>
<li><code>Sys.setlocale()</code> 함수를 통해 로케일 언어를 English로 설정합니다.</li>
<li>url을 입력한 후 <code>GET()</code> 함수를 통해 페이지 내용을 받아오며, <code>user_agent()</code> 항목에 웹브라우저 구별을 입력해줍니다. 해당 사이트는 크롤러와 같이 정체가 불분명한 웹브라우저를 통한 접속이 막혀 있어, 마치 모질라 혹은 크롬을 통해 접속한 것 처럼 데이터를 요청합니다. 다양한 웹브라저 리스트는 아래 링크에 나와있습니다.</li>
</ol>
<pre><code>http://www.useragentstring.com/pages/useragentstring.php</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><code>read_html()</code> 함수를 통해 HTML 내용을 읽어오며, <code>html_table()</code> 함수를 통해 테이블 내용만 추출합니다.</li>
<li>로케일 언어를 다시 Korean으로 설정합니다.</li>
</ol>
<p>위의 과정을 거치면 data 변수에는 리스트 형태로 총 6개의 테이블이 들어오게 되며, 그 내용은 표 <a href="금융-데이터-수집하기-심화.html#tab:fstable">6.1</a>와 같습니다.</p>
<table>
<caption><span id="tab:fstable">표 6.1: </span>재무제표 테이블 내역</caption>
<thead>
<tr class="header">
<th align="center">순서</th>
<th align="center">내용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">포괄손익계산서 (연간)</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">포괄손익계산서 (분기)</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">재무상태표 (연간)</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">재무상태표 (분기)</td>
</tr>
<tr class="odd">
<td align="center">5</td>
<td align="center">현금흐름표 (연간)</td>
</tr>
<tr class="even">
<td align="center">6</td>
<td align="center">현금흐름표 (분기)</td>
</tr>
</tbody>
</table>
<p>이 중 연간 기준 재무제표에 해당하는 첫 번째, 세 번째, 다섯 번째 테이블을 선택합니다.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">data_IS =<span class="st"> </span>data[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb131-2" data-line-number="2">data_BS =<span class="st"> </span>data[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb131-3" data-line-number="3">data_CF =<span class="st"> </span>data[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb131-4" data-line-number="4"></a>
<a class="sourceLine" id="cb131-5" data-line-number="5"><span class="kw">print</span>(<span class="kw">names</span>(data_IS))</a></code></pre></div>
<pre><code>## [1] &quot;IFRS(연결)&quot;  &quot;2016/12&quot;     &quot;2017/12&quot;    
## [4] &quot;2018/12&quot;     &quot;2019/12&quot;     &quot;전년동기&quot;   
## [7] &quot;전년동기(%)&quot;</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">data_IS =<span class="st"> </span>data_IS[, <span class="dv">1</span><span class="op">:</span>(<span class="kw">ncol</span>(data_IS)<span class="op">-</span><span class="dv">2</span>)]</a></code></pre></div>
<p>포괄손익계산서 테이블(data_IS)에는 전년동기, 전년동기(%) 열이 있는데 통일성을 위해 해당 열을 삭제합니다. 이제 테이블을 묶은 후 클렌징하겠습니다.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" data-line-number="1">data_fs =<span class="st"> </span><span class="kw">rbind</span>(data_IS, data_BS, data_CF)</a>
<a class="sourceLine" id="cb134-2" data-line-number="2">data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</a>
<a class="sourceLine" id="cb134-3" data-line-number="3">                    <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb134-4" data-line-number="4">data_fs =<span class="st"> </span>data_fs[<span class="op">!</span><span class="kw">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</a>
<a class="sourceLine" id="cb134-5" data-line-number="5"></a>
<a class="sourceLine" id="cb134-6" data-line-number="6"><span class="kw">rownames</span>(data_fs) =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb134-7" data-line-number="7"><span class="kw">rownames</span>(data_fs) =<span class="st"> </span>data_fs[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb134-8" data-line-number="8">data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb134-9" data-line-number="9"></a>
<a class="sourceLine" id="cb134-10" data-line-number="10">data_fs =<span class="st"> </span>data_fs[, <span class="kw">substr</span>(<span class="kw">colnames</span>(data_fs), <span class="dv">6</span>,<span class="dv">7</span>) <span class="op">==</span><span class="st"> &#39;12&#39;</span>]</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>rbind()</code> 함수를 이용해 세 테이블을 행으로 묶은 후 data_fs에 저장합니다.</li>
<li>첫 번째 열인 계정명에는 ‘계산에 참여한 계정 펼치기’라는 글자가 들어간 항목이 있습니다. 이는 페이지 내에서 펼치기 역할을 하는 (+) 항목에 해당하며 <code>gsub()</code> 함수를 이용해 해당 글자를 삭제합니다.</li>
<li>중복되는 계정명이 다수 있는데 대부분 불필요한 항목입니다. <code>!duplicated()</code> 함수를 사용해 중복되지 않는 계정명만 선택합니다.</li>
<li>행 이름을 초기화한 후 첫 번째 열의 계정명을 행 이름으로 변경합니다. 그 후 첫 번째 열은 삭제합니다.</li>
<li>간혹 12월 결산법인이 아닌 종목이거나 연간 재무제표임에도 불구하고 분기 재무제표가 들어간 경우가 있습니다. 비교의 통일성을 위해 <code>substr()</code> 함수를 이용해 끝 글자가 12인 열, 즉 12월 결산 데이터만 선택합니다.</li>
</ol>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">head</span>(data_fs))</a></code></pre></div>
<pre><code>##                    2016/12   2017/12   2018/12
## 매출액           2,018,667 2,395,754 2,437,714
## 매출원가         1,202,777 1,292,907 1,323,944
## 매출총이익         815,890 1,102,847 1,113,770
## 판매비와관리비     523,484   566,397   524,903
## 인건비              59,763    67,972    64,514
## 유무형자산상각비    10,018    13,366    14,477
##                    2019/12
## 매출액           2,304,009
## 매출원가         1,472,395
## 매출총이익         831,613
## 판매비와관리비     553,928
## 인건비              64,226
## 유무형자산상각비    20,408</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1"><span class="kw">sapply</span>(data_fs, typeof)</a></code></pre></div>
<pre><code>##     2016/12     2017/12     2018/12     2019/12 
## &quot;character&quot; &quot;character&quot; &quot;character&quot; &quot;character&quot;</code></pre>
<p>데이터를 확인해보면 연간 기준 재무제표가 정리되었습니다. 문자형 데이터이므로 숫자형으로 변경합니다.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb139-2" data-line-number="2"></a>
<a class="sourceLine" id="cb139-3" data-line-number="3">data_fs =<span class="st"> </span><span class="kw">sapply</span>(data_fs, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb139-4" data-line-number="4">  <span class="kw">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-5" data-line-number="5"><span class="st">    </span><span class="kw">as.numeric</span>()</a>
<a class="sourceLine" id="cb139-6" data-line-number="6">}) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb139-7" data-line-number="7"><span class="st">  </span><span class="kw">data.frame</span>(., <span class="dt">row.names =</span> <span class="kw">rownames</span>(data_fs))</a>
<a class="sourceLine" id="cb139-8" data-line-number="8"></a>
<a class="sourceLine" id="cb139-9" data-line-number="9"><span class="kw">print</span>(<span class="kw">head</span>(data_fs))</a></code></pre></div>
<pre><code>##                  X2016.12 X2017.12 X2018.12 X2019.12
## 매출액            2018667  2395754  2437714  2304009
## 매출원가          1202777  1292907  1323944  1472395
## 매출총이익         815890  1102847  1113770   831613
## 판매비와관리비     523484   566397   524903   553928
## 인건비              59763    67972    64514    64226
## 유무형자산상각비    10018    13366    14477    20408</code></pre>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1"><span class="kw">sapply</span>(data_fs, typeof)</a></code></pre></div>
<pre><code>## X2016.12 X2017.12 X2018.12 X2019.12 
## &quot;double&quot; &quot;double&quot; &quot;double&quot; &quot;double&quot;</code></pre>
<ol style="list-style-type: decimal">
<li><code>sapply()</code> 함수를 이용해 각 열에 stringr 패키지의 <code>str_replace_allr()</code> 함수를 적용해 콤마(,)를 제거한 후 <code>as.numeric()</code> 함수를 통해 숫자형 데이터로 변경합니다.</li>
<li><code>data.frame()</code> 함수를 이용해 데이터 프레임 형태로 만들어주며, 행 이름은 기존 내용을 그대로 유지합니다.</li>
</ol>
<p>정리된 데이터를 출력해보면 문자형이던 데이터가 숫자형으로 변경되었습니다.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">write.csv</span>(data_fs, <span class="st">&#39;data/KOR_fs/005930_fs.csv&#39;</span>)</a></code></pre></div>
<p>data 폴더의 KOR_fs 폴더 내에 티커_fs.csv 이름으로 저장합니다.</p>
</div>
<div id="가치지표-계산하기" class="section level3">
<h3><span class="header-section-number">6.2.2</span> 가치지표 계산하기</h3>
<p>위에서 구한 재무제표 데이터를 이용해 가치지표를 계산할 수 있습니다. 흔히 사용되는 가치지표는 <strong>PER, PBR, PCR, PSR</strong>이며 분자는 주가, 분모는 재무제표 데이터가 사용됩니다.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-17">표 6.2: </span>가치지표의 종류
</caption>
<thead>
<tr>
<th style="text-align:center;">
순서
</th>
<th style="text-align:center;">
분모
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
PER
</td>
<td style="text-align:center;">
Earnings (순이익)
</td>
</tr>
<tr>
<td style="text-align:center;">
PBR
</td>
<td style="text-align:center;">
Book Value (순자산)
</td>
</tr>
<tr>
<td style="text-align:center;">
PCR
</td>
<td style="text-align:center;">
Cashflow (영업활동현금흐름)
</td>
</tr>
<tr>
<td style="text-align:center;">
PSR
</td>
<td style="text-align:center;">
Sales (매출액)
</td>
</tr>
</tbody>
</table>
<p>위에서 구한 재무제표 항목에서 분모 부분에 해당하는 데이터만 선택해보겠습니다.</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb144-2" data-line-number="2">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1">value_type =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>,</a>
<a class="sourceLine" id="cb146-2" data-line-number="2">               <span class="st">&#39;자본&#39;</span>,</a>
<a class="sourceLine" id="cb146-3" data-line-number="3">               <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>,</a>
<a class="sourceLine" id="cb146-4" data-line-number="4">               <span class="st">&#39;매출액&#39;</span>)</a>
<a class="sourceLine" id="cb146-5" data-line-number="5"></a>
<a class="sourceLine" id="cb146-6" data-line-number="6">value_index =<span class="st"> </span>data_fs[<span class="kw">match</span>(value_type, <span class="kw">rownames</span>(data_fs)),</a>
<a class="sourceLine" id="cb146-7" data-line-number="7">                      <span class="kw">ncol</span>(data_fs)]</a>
<a class="sourceLine" id="cb146-8" data-line-number="8"><span class="kw">print</span>(value_index)</a></code></pre></div>
<pre><code>## [1]  215051 2628804  453829 2304009</code></pre>
<ol style="list-style-type: decimal">
<li>data 폴더 내에 KOR_value 폴더를 생성합니다.</li>
<li>분모에 해당하는 항목을 저장한 후 <code>match()</code> 함수를 이용해 해당 항목이 위치하는 지점을 찾습니다. <code>ncol()</code> 함수를 이용해 맨 오른쪽, 즉 최근년도 재무제표 데이터를 선택합니다.</li>
</ol>
<p>다음으로 분자 부분에 해당하는 현재 주가를 수집해야 합니다. 이 역시 Company Guide 접속 화면에서 구할 수 있습니다. 불필요한 부분을 제거한 URL은 다음과 같습니다.</p>
<p><strong><a href="http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930" class="uri">http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930</a></strong></p>
<p>위의 주소 역시 A 뒤의 6자리 티커만 변경하면 해당 종목의 스냅샷 페이지로 이동하게 됩니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/crawl_practice_comp_price.png" alt="Company Guide 스냅샷 화면" width="70%" />
<p class="caption">
그림 2.12: Company Guide 스냅샷 화면
</p>
</div>
<p>주가추이 부분에 우리가 원하는 현재 주가가 있습니다. 해당 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb148-1" data-line-number="1">/<span class="co">/*[@id=&quot;svdMainChartTxt11&quot;]</span></a></code></pre></div>
<style type="text/css">
//*[@id="svdMainChartTxt11"]
</style>
<p>위에서 구한 주가의 Xpath를 이용해 해당 데이터를 크롤링하겠습니다.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb149-2" data-line-number="2"></a>
<a class="sourceLine" id="cb149-3" data-line-number="3">url =<span class="st"> &#39;http://comp.fnguide.com/SVO2/ASP/SVD_main.asp?pGB=1&amp;gicode=A005930&#39;</span></a>
<a class="sourceLine" id="cb149-4" data-line-number="4">data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb149-5" data-line-number="5">           <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb149-6" data-line-number="6"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb149-7" data-line-number="7"></a>
<a class="sourceLine" id="cb149-8" data-line-number="8">price =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-9" data-line-number="9"><span class="st">  </span><span class="kw">html_node</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-10" data-line-number="10"><span class="st">  </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb149-11" data-line-number="11"><span class="st">  </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb149-12" data-line-number="12"></a>
<a class="sourceLine" id="cb149-13" data-line-number="13"><span class="kw">print</span>(price)</a></code></pre></div>
<pre><code>## [1] 48900</code></pre>
<ol style="list-style-type: decimal">
<li>url을 입력한 후, <code>GET()</code> 함수를 이용해 데이터를 불러오며, 역시나 user_agent를 추가해 줍니다.</li>
<li><code>read_html()</code> 함수를 이용해 HTML 데이터를 불러온 후 <code>html_node()</code> 함수에 앞서 구한 Xpath를 입력해 해당 지점의 데이터를 추출합니다.</li>
<li><code>html_text()</code> 함수를 통해 텍스트 데이터만을 추출하며, readr 패키지의 <code>parse_number()</code> 함수를 적용합니다. 해당 함수는 문자형 데이터에서 콤마와 같은 불필요한 문자를 제거한 후 숫자형 데이터로 변경해줍니다.</li>
</ol>
<p>가치지표를 계산하려면 발행주식수 역시 필요합니다. 예를 들어 PER를 계산하는 방법은 다음과 같습니다.</p>
<p><span class="math display">\[ PER = Price / EPS  = 주가 / 주당순이익\]</span></p>
<p>주당순이익은 순이익을 전체 주식수로 나눈 값이므로, 해당 값의 계산하려면 전체 주식수를 구해야 합니다. 전체 주식수 데이터 역시 웹페이지에 있으므로 앞서 주가를 크롤링한 방법과 동일한 방법으로 구할 수 있습니다. 전체 주식수 데이터의 Xpath는 다음과 같습니다.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode css"><code class="sourceCode css"><a class="sourceLine" id="cb151-1" data-line-number="1">/<span class="co">/*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]</span></a></code></pre></div>
<style type="text/css">
//*[@id="svdMainGrid1"]/table/tbody/tr[7]/td[1]
</style>
<p>이를 이용해 발행주식수 중 보통주를 선택하는 방법은 다음과 같습니다.</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1">share =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-2" data-line-number="2"><span class="st">  </span><span class="kw">html_node</span>(</a>
<a class="sourceLine" id="cb152-3" data-line-number="3">    <span class="dt">xpath =</span></a>
<a class="sourceLine" id="cb152-4" data-line-number="4">      <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb152-5" data-line-number="5"><span class="st">  </span><span class="kw">html_text</span>()</a>
<a class="sourceLine" id="cb152-6" data-line-number="6"></a>
<a class="sourceLine" id="cb152-7" data-line-number="7"><span class="kw">print</span>(share)</a></code></pre></div>
<pre><code>## [1] &quot;5,969,782,550/ 822,886,700&quot;</code></pre>
<p><code>read_html()</code> 함수와 <code>html_node()</code> 함수를 이용해, HTML 내에서 Xpath에 해당하는 데이터를 추출합니다. 그 후 <code>html_text()</code> 함수를 통해 텍스트 부분만 추출합니다. 해당 과정을 거치면 보통주/우선주의 형태로 발행주식주가 저장됩니다. 이 중 우리가 원하는 데이터는 / 앞에 있는 보통주 발행주식수입니다.</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">share =<span class="st"> </span>share <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-2" data-line-number="2"><span class="st">  </span><span class="kw">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-3" data-line-number="3"><span class="st">  </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-4" data-line-number="4"><span class="st">  </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb154-5" data-line-number="5"><span class="st">  </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb154-6" data-line-number="6"></a>
<a class="sourceLine" id="cb154-7" data-line-number="7"><span class="kw">print</span>(share)</a></code></pre></div>
<pre><code>## [1] 5969782550</code></pre>
<ol style="list-style-type: decimal">
<li><code>strsplit()</code> 함수를 통해 /를 기준으로 데이터를 나눕니다. 해당 결과는 리스트 형태로 저장됩니다.</li>
<li><code>unlist()</code> 함수를 통해 리스트를 벡터 형태로 변환합니다.</li>
<li><code>.[1]</code>.[1]을 통해 보통주 발행주식수인 첫 번째 데이터를 선택합니다.</li>
<li><code>parse_number()</code> 함수를 통해 문자형 데이터를 숫자형으로 변환합니다.</li>
</ol>
<p>재무 데이터, 현재 주가, 발행주식수를 이용해 가치지표를 계산해보겠습니다.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">data_value =<span class="st"> </span>price <span class="op">/</span><span class="st"> </span>(value_index <span class="op">*</span><span class="st"> </span><span class="dv">100000000</span> <span class="op">/</span><span class="st"> </span>share)</a>
<a class="sourceLine" id="cb156-2" data-line-number="2"><span class="kw">names</span>(data_value) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</a>
<a class="sourceLine" id="cb156-3" data-line-number="3">data_value[data_value <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb156-4" data-line-number="4"></a>
<a class="sourceLine" id="cb156-5" data-line-number="5"><span class="kw">print</span>(data_value)</a></code></pre></div>
<pre><code>##    PER    PBR    PCR    PSR 
## 13.575  1.110  6.432  1.267</code></pre>
<p>분자에는 현재 주가를 입력하며, 분모에는 재무 데이터를 보통주 발행주식수로 나눈 값을 입력합니다. 단, 주가는 원 단위, 재무 데이터는 억 원 단위이므로, 둘 사이에 단위를 동일하게 맞춰주기 위해 분모에 억을 곱합니다. 또한 가치지표가 음수인 경우는 NA로 변경해줍니다.</p>
<p>결과를 확인해보면 4가지 가치지표가 잘 계산되었습니다.<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a></p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1"><span class="kw">write.csv</span>(data_value, <span class="st">&#39;data/KOR_value/005930_value.csv&#39;</span>)</a></code></pre></div>
<p>data 폴더의 KOR_value 폴더 내에 티커_value.csv 이름으로 저장합니다.</p>
</div>
<div id="전-종목-재무제표-및-가치지표-다운로드" class="section level3">
<h3><span class="header-section-number">6.2.3</span> 전 종목 재무제표 및 가치지표 다운로드</h3>
<p>위 코드에서 for loop 구문을 이용해 URL 중 6자리 티커에 해당하는 값만 변경해주면 모든 종목의 재무제표를 다운로드하고 이를 바탕으로 가치지표를 계산할 수 있습니다. 해당 코드는 다음과 같습니다.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb159-2" data-line-number="2"><span class="kw">library</span>(httr)</a>
<a class="sourceLine" id="cb159-3" data-line-number="3"><span class="kw">library</span>(rvest)</a>
<a class="sourceLine" id="cb159-4" data-line-number="4"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb159-5" data-line-number="5"><span class="kw">library</span>(readr)</a>
<a class="sourceLine" id="cb159-6" data-line-number="6"></a>
<a class="sourceLine" id="cb159-7" data-line-number="7">KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb159-8" data-line-number="8">KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =</a>
<a class="sourceLine" id="cb159-9" data-line-number="9"><span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>,<span class="dt">side =</span> <span class="kw">c</span>(<span class="st">&#39;left&#39;</span>), <span class="dt">pad =</span> <span class="st">&#39;0&#39;</span>)</a>
<a class="sourceLine" id="cb159-10" data-line-number="10"></a>
<a class="sourceLine" id="cb159-11" data-line-number="11"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_fs&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb159-12" data-line-number="12">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_fs&#39;</span>))</a>
<a class="sourceLine" id="cb159-13" data-line-number="13"><span class="kw">ifelse</span>(<span class="kw">dir.exists</span>(<span class="st">&#39;data/KOR_value&#39;</span>), <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb159-14" data-line-number="14">       <span class="kw">dir.create</span>(<span class="st">&#39;data/KOR_value&#39;</span>))</a>
<a class="sourceLine" id="cb159-15" data-line-number="15"></a>
<a class="sourceLine" id="cb159-16" data-line-number="16"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span> <span class="op">:</span><span class="st"> </span><span class="kw">nrow</span>(KOR_ticker) ) {</a>
<a class="sourceLine" id="cb159-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb159-18" data-line-number="18">  data_fs =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb159-19" data-line-number="19">  data_value =<span class="st"> </span><span class="kw">c</span>()</a>
<a class="sourceLine" id="cb159-20" data-line-number="20">  name =<span class="st"> </span>KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>[i]</a>
<a class="sourceLine" id="cb159-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb159-22" data-line-number="22">  <span class="co"># 오류 발생 시 이를 무시하고 다음 루프로 진행</span></a>
<a class="sourceLine" id="cb159-23" data-line-number="23">  <span class="kw">tryCatch</span>({</a>
<a class="sourceLine" id="cb159-24" data-line-number="24">    </a>
<a class="sourceLine" id="cb159-25" data-line-number="25">    <span class="kw">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;English&#39;</span>)</a>
<a class="sourceLine" id="cb159-26" data-line-number="26">    </a>
<a class="sourceLine" id="cb159-27" data-line-number="27">    <span class="co"># url 생성</span></a>
<a class="sourceLine" id="cb159-28" data-line-number="28">    url =<span class="st"> </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb159-29" data-line-number="29">      <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/&#39;</span></a>
<a class="sourceLine" id="cb159-30" data-line-number="30">      ,<span class="st">&#39;SVD_Finance.asp?pGB=1&amp;gicode=A&#39;</span>,</a>
<a class="sourceLine" id="cb159-31" data-line-number="31">      name)</a>
<a class="sourceLine" id="cb159-32" data-line-number="32">    </a>
<a class="sourceLine" id="cb159-33" data-line-number="33">    <span class="co"># 이 후 과정은 위와 동일함</span></a>
<a class="sourceLine" id="cb159-34" data-line-number="34">    </a>
<a class="sourceLine" id="cb159-35" data-line-number="35">    <span class="co"># 데이터 다운로드 후 테이블 추출</span></a>
<a class="sourceLine" id="cb159-36" data-line-number="36">    data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb159-37" data-line-number="37">               <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb159-38" data-line-number="38"><span class="st">                          AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-39" data-line-number="39"><span class="st">      </span><span class="kw">read_html</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-40" data-line-number="40"><span class="st">      </span><span class="kw">html_table</span>()</a>
<a class="sourceLine" id="cb159-41" data-line-number="41">    </a>
<a class="sourceLine" id="cb159-42" data-line-number="42">    <span class="kw">Sys.setlocale</span>(<span class="st">&#39;LC_ALL&#39;</span>, <span class="st">&#39;Korean&#39;</span>)</a>
<a class="sourceLine" id="cb159-43" data-line-number="43">    </a>
<a class="sourceLine" id="cb159-44" data-line-number="44">    <span class="co"># 3개 재무제표를 하나로 합치기</span></a>
<a class="sourceLine" id="cb159-45" data-line-number="45">    data_IS =<span class="st"> </span>data[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb159-46" data-line-number="46">    data_BS =<span class="st"> </span>data[[<span class="dv">3</span>]]</a>
<a class="sourceLine" id="cb159-47" data-line-number="47">    data_CF =<span class="st"> </span>data[[<span class="dv">5</span>]]</a>
<a class="sourceLine" id="cb159-48" data-line-number="48">    </a>
<a class="sourceLine" id="cb159-49" data-line-number="49">    data_IS =<span class="st"> </span>data_IS[, <span class="dv">1</span><span class="op">:</span>(<span class="kw">ncol</span>(data_IS)<span class="op">-</span><span class="dv">2</span>)]</a>
<a class="sourceLine" id="cb159-50" data-line-number="50">    data_fs =<span class="st"> </span><span class="kw">rbind</span>(data_IS, data_BS, data_CF)</a>
<a class="sourceLine" id="cb159-51" data-line-number="51">    </a>
<a class="sourceLine" id="cb159-52" data-line-number="52">    <span class="co"># 데이터 클랜징</span></a>
<a class="sourceLine" id="cb159-53" data-line-number="53">    data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;계산에 참여한 계정 펼치기&#39;</span>,</a>
<a class="sourceLine" id="cb159-54" data-line-number="54">                        <span class="st">&#39;&#39;</span>, data_fs[, <span class="dv">1</span>])</a>
<a class="sourceLine" id="cb159-55" data-line-number="55">    data_fs =<span class="st"> </span>data_fs[<span class="op">!</span><span class="kw">duplicated</span>(data_fs[, <span class="dv">1</span>]), ]</a>
<a class="sourceLine" id="cb159-56" data-line-number="56">    </a>
<a class="sourceLine" id="cb159-57" data-line-number="57">    <span class="kw">rownames</span>(data_fs) =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb159-58" data-line-number="58">    <span class="kw">rownames</span>(data_fs) =<span class="st"> </span>data_fs[, <span class="dv">1</span>]</a>
<a class="sourceLine" id="cb159-59" data-line-number="59">    data_fs[, <span class="dv">1</span>] =<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb159-60" data-line-number="60">    </a>
<a class="sourceLine" id="cb159-61" data-line-number="61">    <span class="co"># 12월 재무제표만 선택</span></a>
<a class="sourceLine" id="cb159-62" data-line-number="62">    data_fs =</a>
<a class="sourceLine" id="cb159-63" data-line-number="63"><span class="st">      </span>data_fs[, <span class="kw">substr</span>(<span class="kw">colnames</span>(data_fs), <span class="dv">6</span>,<span class="dv">7</span>) <span class="op">==</span><span class="st"> &quot;12&quot;</span>]</a>
<a class="sourceLine" id="cb159-64" data-line-number="64">    </a>
<a class="sourceLine" id="cb159-65" data-line-number="65">    data_fs =<span class="st"> </span><span class="kw">sapply</span>(data_fs, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb159-66" data-line-number="66">      <span class="kw">str_replace_all</span>(x, <span class="st">&#39;,&#39;</span>, <span class="st">&#39;&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-67" data-line-number="67"><span class="st">        </span><span class="kw">as.numeric</span>()</a>
<a class="sourceLine" id="cb159-68" data-line-number="68">    }) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-69" data-line-number="69"><span class="st">      </span><span class="kw">data.frame</span>(., <span class="dt">row.names =</span> <span class="kw">rownames</span>(data_fs))</a>
<a class="sourceLine" id="cb159-70" data-line-number="70">    </a>
<a class="sourceLine" id="cb159-71" data-line-number="71">    </a>
<a class="sourceLine" id="cb159-72" data-line-number="72">    <span class="co"># 가치지표 분모부분</span></a>
<a class="sourceLine" id="cb159-73" data-line-number="73">    value_type =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;지배주주순이익&#39;</span>, </a>
<a class="sourceLine" id="cb159-74" data-line-number="74">                   <span class="st">&#39;자본&#39;</span>, </a>
<a class="sourceLine" id="cb159-75" data-line-number="75">                   <span class="st">&#39;영업활동으로인한현금흐름&#39;</span>, </a>
<a class="sourceLine" id="cb159-76" data-line-number="76">                   <span class="st">&#39;매출액&#39;</span>) </a>
<a class="sourceLine" id="cb159-77" data-line-number="77">    </a>
<a class="sourceLine" id="cb159-78" data-line-number="78">    <span class="co"># 해당 재무데이터만 선택</span></a>
<a class="sourceLine" id="cb159-79" data-line-number="79">    value_index =<span class="st"> </span>data_fs[<span class="kw">match</span>(value_type, <span class="kw">rownames</span>(data_fs)),</a>
<a class="sourceLine" id="cb159-80" data-line-number="80">                          <span class="kw">ncol</span>(data_fs)]</a>
<a class="sourceLine" id="cb159-81" data-line-number="81">    </a>
<a class="sourceLine" id="cb159-82" data-line-number="82">    <span class="co"># Snapshot 페이지 불러오기</span></a>
<a class="sourceLine" id="cb159-83" data-line-number="83">    url =</a>
<a class="sourceLine" id="cb159-84" data-line-number="84"><span class="st">      </span><span class="kw">paste0</span>(</a>
<a class="sourceLine" id="cb159-85" data-line-number="85">        <span class="st">&#39;http://comp.fnguide.com/SVO2/ASP/SVD_Main.asp&#39;</span>,</a>
<a class="sourceLine" id="cb159-86" data-line-number="86">        <span class="st">&#39;?pGB=1&amp;gicode=A&#39;</span>,name)</a>
<a class="sourceLine" id="cb159-87" data-line-number="87">    data =<span class="st"> </span><span class="kw">GET</span>(url,</a>
<a class="sourceLine" id="cb159-88" data-line-number="88">               <span class="kw">user_agent</span>(<span class="st">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)</span></a>
<a class="sourceLine" id="cb159-89" data-line-number="89"><span class="st">                      AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.77 Safari/537.36&#39;</span>))</a>
<a class="sourceLine" id="cb159-90" data-line-number="90">    </a>
<a class="sourceLine" id="cb159-91" data-line-number="91">    <span class="co"># 현재 주가 크롤링</span></a>
<a class="sourceLine" id="cb159-92" data-line-number="92">    price =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-93" data-line-number="93"><span class="st">      </span><span class="kw">html_node</span>(<span class="dt">xpath =</span> <span class="st">&#39;//*[@id=&quot;svdMainChartTxt11&quot;]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-94" data-line-number="94"><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-95" data-line-number="95"><span class="st">      </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb159-96" data-line-number="96">    </a>
<a class="sourceLine" id="cb159-97" data-line-number="97">    <span class="co"># 보통주 발행장주식수 크롤링</span></a>
<a class="sourceLine" id="cb159-98" data-line-number="98">    share =<span class="st"> </span><span class="kw">read_html</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-99" data-line-number="99"><span class="st">      </span><span class="kw">html_node</span>(</a>
<a class="sourceLine" id="cb159-100" data-line-number="100">        <span class="dt">xpath =</span></a>
<a class="sourceLine" id="cb159-101" data-line-number="101">        <span class="st">&#39;//*[@id=&quot;svdMainGrid1&quot;]/table/tbody/tr[7]/td[1]&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-102" data-line-number="102"><span class="st">      </span><span class="kw">html_text</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-103" data-line-number="103"><span class="st">      </span><span class="kw">strsplit</span>(<span class="st">&#39;/&#39;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-104" data-line-number="104"><span class="st">      </span><span class="kw">unlist</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-105" data-line-number="105"><span class="st">      </span>.[<span class="dv">1</span>] <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb159-106" data-line-number="106"><span class="st">      </span><span class="kw">parse_number</span>()</a>
<a class="sourceLine" id="cb159-107" data-line-number="107">    </a>
<a class="sourceLine" id="cb159-108" data-line-number="108">    <span class="co"># 가치지표 계산</span></a>
<a class="sourceLine" id="cb159-109" data-line-number="109">    data_value =<span class="st"> </span>price <span class="op">/</span><span class="st"> </span>(value_index <span class="op">*</span><span class="st"> </span><span class="dv">100000000</span><span class="op">/</span><span class="st"> </span>share)</a>
<a class="sourceLine" id="cb159-110" data-line-number="110">    <span class="kw">names</span>(data_value) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;PER&#39;</span>, <span class="st">&#39;PBR&#39;</span>, <span class="st">&#39;PCR&#39;</span>, <span class="st">&#39;PSR&#39;</span>)</a>
<a class="sourceLine" id="cb159-111" data-line-number="111">    data_value[data_value <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] =<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb159-112" data-line-number="112">    </a>
<a class="sourceLine" id="cb159-113" data-line-number="113">  }, <span class="dt">error =</span> <span class="cf">function</span>(e) {</a>
<a class="sourceLine" id="cb159-114" data-line-number="114">    </a>
<a class="sourceLine" id="cb159-115" data-line-number="115">    <span class="co"># 오류 발생시 해당 종목명을 출력하고 다음 루프로 이동</span></a>
<a class="sourceLine" id="cb159-116" data-line-number="116">    data_fs &lt;&lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb159-117" data-line-number="117">    data_value &lt;&lt;-<span class="st"> </span><span class="ot">NA</span></a>
<a class="sourceLine" id="cb159-118" data-line-number="118">    <span class="kw">warning</span>(<span class="kw">paste0</span>(<span class="st">&quot;Error in Ticker: &quot;</span>, name))</a>
<a class="sourceLine" id="cb159-119" data-line-number="119">  })</a>
<a class="sourceLine" id="cb159-120" data-line-number="120">  </a>
<a class="sourceLine" id="cb159-121" data-line-number="121">  <span class="co"># 다운로드 받은 파일을 생성한 각각의 폴더 내 csv 파일로 저장</span></a>
<a class="sourceLine" id="cb159-122" data-line-number="122">  </a>
<a class="sourceLine" id="cb159-123" data-line-number="123">  <span class="co"># 재무제표 저장</span></a>
<a class="sourceLine" id="cb159-124" data-line-number="124">  <span class="kw">write.csv</span>(data_fs, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_fs/&#39;</span>, name, <span class="st">&#39;_fs.csv&#39;</span>))</a>
<a class="sourceLine" id="cb159-125" data-line-number="125">  </a>
<a class="sourceLine" id="cb159-126" data-line-number="126">  <span class="co"># 가치지표 저장</span></a>
<a class="sourceLine" id="cb159-127" data-line-number="127">  <span class="kw">write.csv</span>(data_value, <span class="kw">paste0</span>(<span class="st">&#39;data/KOR_value/&#39;</span>, name,</a>
<a class="sourceLine" id="cb159-128" data-line-number="128">                               <span class="st">&#39;_value.csv&#39;</span>))</a>
<a class="sourceLine" id="cb159-129" data-line-number="129">  </a>
<a class="sourceLine" id="cb159-130" data-line-number="130">  <span class="co"># 2초간 타임슬립 적용</span></a>
<a class="sourceLine" id="cb159-131" data-line-number="131">  <span class="kw">Sys.sleep</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb159-132" data-line-number="132">}</a></code></pre></div>
<p>전 종목 주가 데이터를 받는 과정과 동일하게 KOR_ticker.csv 파일을 불러온 후 for loop를 통해 i 값이 변함에 따라 티커를 변경해가며 모든 종목의 재무제표 및 가치지표를 다운로드합니다. <code>tryCatch()</code> 함수를 이용해 오류가 발생하면 NA로 이루어진 빈 데이터를 저장한 후 다음 루프로 넘어가게 됩니다. data/KOR_fs 폴더에는 전 종목의 재무제표 데이터가 저장되고, data/KOR_value 폴더에는 전 종목의 가치지표 데이터가 csv 형태로 저장됩니다.</p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="11">
<li id="fn11"><p><a href="https://finance.naver.com/item/fchart.nhn?code=005930" class="uri">https://finance.naver.com/item/fchart.nhn?code=005930</a><a href="금융-데이터-수집하기-심화.html#fnref11" class="footnote-back">↩</a></p></li>
<li id="fn12"><p>플래쉬가 차단되어 화면이 나오지 않는 경우, 주소창의 왼쪽 상단에 위치한 자물쇠 버튼을 클릭한 다음, Flash를 허용으로 바꾼 후 새로고침을 누르면 차트가 나오게 됩니다.<a href="금융-데이터-수집하기-심화.html#fnref12" class="footnote-back">↩</a></p></li>
<li id="fn13"><p><a href="http://comp.fnguide.com/" class="uri">http://comp.fnguide.com/</a><a href="금융-데이터-수집하기-심화.html#fnref13" class="footnote-back">↩</a></p></li>
<li id="fn14"><p>분모에 사용되는 재무데이터의 구체적인 항목과 발행주식수를 계산하는 방법의 차이로 인해 여러 업체에서 제공하는 가치지표와 다소 차이가 발생할 수 있습니다.<a href="금융-데이터-수집하기-심화.html#fnref14" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="데이터-정리하기.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="데이터-정리하기-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"split_bib": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
