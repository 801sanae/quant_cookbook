<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 데이터 분석 및 시각화하기 | 퀀트 투자 쿡북: R을 이용한 투자 포트폴리오 만들기</title>
  <meta name="description" content="Chapter 8 데이터 분석 및 시각화하기 | 퀀트 투자 쿡북: R을 이용한 투자 포트폴리오 만들기" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 데이터 분석 및 시각화하기 | 퀀트 투자 쿡북: R을 이용한 투자 포트폴리오 만들기" />
  <meta property="og:type" content="book" />
  
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 데이터 분석 및 시각화하기 | 퀀트 투자 쿡북: R을 이용한 투자 포트폴리오 만들기" />
  
  
  

<meta name="author" content="이현열" />


<meta name="date" content="2019-07-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="section-34.html">
<link rel="next" href="section-45.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">퀀트 투자 쿡북</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>여는 글</a></li>
<li class="chapter" data-level="1" data-path="section-1.html"><a href="section-1.html"><i class="fa fa-check"></i><b>1</b> 퀀트 투자의 심장: 데이터와 프로그래밍</a><ul>
<li class="chapter" data-level="1.1" data-path="section-1.html"><a href="section-1.html#section-2"><i class="fa fa-check"></i><b>1.1</b> 데이터 구하기</a></li>
<li class="chapter" data-level="1.2" data-path="section-1.html"><a href="section-1.html#section-3"><i class="fa fa-check"></i><b>1.2</b> 퀀트 투자와 프로그래밍</a></li>
<li class="chapter" data-level="1.3" data-path="section-1.html"><a href="section-1.html#r-"><i class="fa fa-check"></i><b>1.3</b> R 프로그램</a></li>
<li class="chapter" data-level="1.4" data-path="section-1.html"><a href="section-1.html#r--1"><i class="fa fa-check"></i><b>1.4</b> 퀀트 투자에 유용한 R 패키지</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="section-4.html"><a href="section-4.html"><i class="fa fa-check"></i><b>2</b> 크롤링을 위한 기본 지식</a><ul>
<li class="chapter" data-level="2.1" data-path="section-4.html"><a href="section-4.html#r-utf-8-"><i class="fa fa-check"></i><b>2.1</b> 인코딩의 이해와 R에서 UTF-8 설정하기</a><ul>
<li class="chapter" data-level="2.1.1" data-path="section-4.html"><a href="section-4.html#ascii"><i class="fa fa-check"></i><b>2.1.1</b> 인간과 컴퓨터 간 번역의 시작, ASCII</a></li>
<li class="chapter" data-level="2.1.2" data-path="section-4.html"><a href="section-4.html#section-5"><i class="fa fa-check"></i><b>2.1.2</b> 한글 인코딩의 종류</a></li>
<li class="chapter" data-level="2.1.3" data-path="section-4.html"><a href="section-4.html#r-utf-8--1"><i class="fa fa-check"></i><b>2.1.3</b> R에서 UTF-8 설정하기</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="section-4.html"><a href="section-4.html#section-6"><i class="fa fa-check"></i><b>2.2</b> 웹의 동작 방식</a><ul>
<li class="chapter" data-level="2.2.1" data-path="section-4.html"><a href="section-4.html#http"><i class="fa fa-check"></i><b>2.2.1</b> HTTP</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="section-4.html"><a href="section-4.html#html-css-"><i class="fa fa-check"></i><b>2.3</b> HTML과 CSS 이해하기</a><ul>
<li class="chapter" data-level="2.3.1" data-path="section-4.html"><a href="section-4.html#html--"><i class="fa fa-check"></i><b>2.3.1</b> HTML 기본 구조</a></li>
<li class="chapter" data-level="2.3.2" data-path="section-4.html"><a href="section-4.html#section-7"><i class="fa fa-check"></i><b>2.3.2</b> 태그와 속성</a></li>
<li class="chapter" data-level="2.3.3" data-path="section-4.html"><a href="section-4.html#h--p-"><i class="fa fa-check"></i><b>2.3.3</b> h 태그와 p 태그</a></li>
<li class="chapter" data-level="2.3.4" data-path="section-4.html"><a href="section-4.html#ul-ol-"><i class="fa fa-check"></i><b>2.3.4</b> 리스트: ul과 ol 태그</a></li>
<li class="chapter" data-level="2.3.5" data-path="section-4.html"><a href="section-4.html#table-"><i class="fa fa-check"></i><b>2.3.5</b> table 태그</a></li>
<li class="chapter" data-level="2.3.6" data-path="section-4.html"><a href="section-4.html#a-src--"><i class="fa fa-check"></i><b>2.3.6</b> a, src 태그와 속성</a></li>
<li class="chapter" data-level="2.3.7" data-path="section-4.html"><a href="section-4.html#div-"><i class="fa fa-check"></i><b>2.3.7</b> div 태그</a></li>
<li class="chapter" data-level="2.3.8" data-path="section-4.html"><a href="section-4.html#css"><i class="fa fa-check"></i><b>2.3.8</b> CSS</a></li>
<li class="chapter" data-level="2.3.9" data-path="section-4.html"><a href="section-4.html#class-id"><i class="fa fa-check"></i><b>2.3.9</b> class와 id</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="section-4.html"><a href="section-4.html#section-8"><i class="fa fa-check"></i><b>2.4</b> 파이프 오퍼레이터 (<code>%&gt;%</code>)</a></li>
<li class="chapter" data-level="2.5" data-path="section-4.html"><a href="section-4.html#section-9"><i class="fa fa-check"></i><b>2.5</b> 오류에 대한 예외처리</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="api-.html"><a href="api-.html"><i class="fa fa-check"></i><b>3</b> API를 이용한 데이터 수집</a><ul>
<li class="chapter" data-level="3.1" data-path="api-.html"><a href="api-.html#api--quandl--"><i class="fa fa-check"></i><b>3.1</b> API를 이용한 Quandl 데이터 다운로드</a></li>
<li class="chapter" data-level="3.2" data-path="api-.html"><a href="api-.html#getsymbols---api-"><i class="fa fa-check"></i><b>3.2</b> <code>getSymbols()</code> 함수를 이용한 API 다운로드</a><ul>
<li class="chapter" data-level="3.2.1" data-path="api-.html"><a href="api-.html#section-10"><i class="fa fa-check"></i><b>3.2.1</b> 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.2" data-path="api-.html"><a href="api-.html#section-11"><i class="fa fa-check"></i><b>3.2.2</b> 국내 종목 주가 다운로드</a></li>
<li class="chapter" data-level="3.2.3" data-path="api-.html"><a href="api-.html#fred--"><i class="fa fa-check"></i><b>3.2.3</b> FRED 데이터 다운로드</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="section-12.html"><a href="section-12.html"><i class="fa fa-check"></i><b>4</b> 크롤링 이해하기</a><ul>
<li class="chapter" data-level="4.1" data-path="section-12.html"><a href="section-12.html#get-post--"><i class="fa fa-check"></i><b>4.1</b> GET과 POST 방식 이해하기</a><ul>
<li class="chapter" data-level="4.1.1" data-path="section-12.html"><a href="section-12.html#get-"><i class="fa fa-check"></i><b>4.1.1</b> GET 방식</a></li>
<li class="chapter" data-level="4.1.2" data-path="section-12.html"><a href="section-12.html#post-"><i class="fa fa-check"></i><b>4.1.2</b> POST 방식</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="section-12.html"><a href="section-12.html#section-13"><i class="fa fa-check"></i><b>4.2</b> 크롤링 예제</a><ul>
<li class="chapter" data-level="4.2.1" data-path="section-12.html"><a href="section-12.html#section-14"><i class="fa fa-check"></i><b>4.2.1</b> 금융 속보 크롤링</a></li>
<li class="chapter" data-level="4.2.2" data-path="section-12.html"><a href="section-12.html#section-15"><i class="fa fa-check"></i><b>4.2.2</b> 기업공시채널에서 오늘의 공시 불러오기</a></li>
<li class="chapter" data-level="4.2.3" data-path="section-12.html"><a href="section-12.html#section-16"><i class="fa fa-check"></i><b>4.2.3</b> 네이버 금융에서 주식티커 크롤링</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="section-17.html"><a href="section-17.html"><i class="fa fa-check"></i><b>5</b> 금융 데이터 수집하기 (기본)</a><ul>
<li class="chapter" data-level="5.1" data-path="section-17.html"><a href="section-17.html#section-18"><i class="fa fa-check"></i><b>5.1</b> 한국거래소의 산업별 현황 및 개별지표 크롤링</a><ul>
<li class="chapter" data-level="5.1.1" data-path="section-17.html"><a href="section-17.html#section-19"><i class="fa fa-check"></i><b>5.1.1</b> 산업별 현황 크롤링</a></li>
<li class="chapter" data-level="5.1.2" data-path="section-17.html"><a href="section-17.html#section-20"><i class="fa fa-check"></i><b>5.1.2</b> 개별종목 지표 크롤링</a></li>
<li class="chapter" data-level="5.1.3" data-path="section-17.html"><a href="section-17.html#section-21"><i class="fa fa-check"></i><b>5.1.3</b> 최근 영업일 기준 데이터 받기</a></li>
<li class="chapter" data-level="5.1.4" data-path="section-17.html"><a href="section-17.html#section-22"><i class="fa fa-check"></i><b>5.1.4</b> 데이터 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="section-17.html"><a href="section-17.html#wics---"><i class="fa fa-check"></i><b>5.2</b> WICS 기준 섹터정보 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="section-23.html"><a href="section-23.html"><i class="fa fa-check"></i><b>6</b> 금융 데이터 수집하기 (심화)</a><ul>
<li class="chapter" data-level="6.1" data-path="section-23.html"><a href="section-23.html#section-24"><i class="fa fa-check"></i><b>6.1</b> 수정주가 크롤링</a><ul>
<li class="chapter" data-level="6.1.1" data-path="section-23.html"><a href="section-23.html#section-25"><i class="fa fa-check"></i><b>6.1.1</b> 개별 종목 주가 크롤링</a></li>
<li class="chapter" data-level="6.1.2" data-path="section-23.html"><a href="section-23.html#section-26"><i class="fa fa-check"></i><b>6.1.2</b> 전 종목 주가 크롤링</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="section-23.html"><a href="section-23.html#section-27"><i class="fa fa-check"></i><b>6.2</b> 재무제표 및 가치지표 크롤링</a><ul>
<li class="chapter" data-level="6.2.1" data-path="section-23.html"><a href="section-23.html#section-28"><i class="fa fa-check"></i><b>6.2.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.2.2" data-path="section-23.html"><a href="section-23.html#section-29"><i class="fa fa-check"></i><b>6.2.2</b> 가치지표 계산하기</a></li>
<li class="chapter" data-level="6.2.3" data-path="section-23.html"><a href="section-23.html#section-30"><i class="fa fa-check"></i><b>6.2.3</b> 전 종목 재무제표 및 가치지표 다운로드</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="section-23.html"><a href="section-23.html#section-31"><i class="fa fa-check"></i><b>6.3</b> 야후 파이낸스 데이터 구하기</a><ul>
<li class="chapter" data-level="6.3.1" data-path="section-23.html"><a href="section-23.html#section-32"><i class="fa fa-check"></i><b>6.3.1</b> 재무제표 다운로드</a></li>
<li class="chapter" data-level="6.3.2" data-path="section-23.html"><a href="section-23.html#section-33"><i class="fa fa-check"></i><b>6.3.2</b> 가치지표 계산하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="section-34.html"><a href="section-34.html"><i class="fa fa-check"></i><b>7</b> 데이터 정리하기</a><ul>
<li class="chapter" data-level="7.1" data-path="section-34.html"><a href="section-34.html#section-35"><i class="fa fa-check"></i><b>7.1</b> 주가 정리하기</a></li>
<li class="chapter" data-level="7.2" data-path="section-34.html"><a href="section-34.html#section-36"><i class="fa fa-check"></i><b>7.2</b> 재무제표 정리하기</a></li>
<li class="chapter" data-level="7.3" data-path="section-34.html"><a href="section-34.html#section-37"><i class="fa fa-check"></i><b>7.3</b> 가치지표 정리하기</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="section-38.html"><a href="section-38.html"><i class="fa fa-check"></i><b>8</b> 데이터 분석 및 시각화하기</a><ul>
<li class="chapter" data-level="8.1" data-path="section-38.html"><a href="section-38.html#section-39"><i class="fa fa-check"></i><b>8.1</b> 종목정보 데이터 분석</a><ul>
<li class="chapter" data-level="8.1.1" data-path="section-38.html"><a href="section-38.html#join--"><i class="fa fa-check"></i><b>8.1.1</b> <code>*_join</code>: 데이터 합치기</a></li>
<li class="chapter" data-level="8.1.2" data-path="section-38.html"><a href="section-38.html#glimpse---"><i class="fa fa-check"></i><b>8.1.2</b> <code>glimpse()</code>: 데이터 구조 확인하기</a></li>
<li class="chapter" data-level="8.1.3" data-path="section-38.html"><a href="section-38.html#rename---"><i class="fa fa-check"></i><b>8.1.3</b> <code>rename()</code>: 열 이름 바꾸기</a></li>
<li class="chapter" data-level="8.1.4" data-path="section-38.html"><a href="section-38.html#distinct---"><i class="fa fa-check"></i><b>8.1.4</b> distinct(): 고유한 값 확인</a></li>
<li class="chapter" data-level="8.1.5" data-path="section-38.html"><a href="section-38.html#select---"><i class="fa fa-check"></i><b>8.1.5</b> <code>select()</code>: 원하는 열만 선택</a></li>
<li class="chapter" data-level="8.1.6" data-path="section-38.html"><a href="section-38.html#mutate-----"><i class="fa fa-check"></i><b>8.1.6</b> <code>mutate()</code>: 열 생성 및 데이터 변형</a></li>
<li class="chapter" data-level="8.1.7" data-path="section-38.html"><a href="section-38.html#filter----"><i class="fa fa-check"></i><b>8.1.7</b> <code>filter()</code>: 조건을 충족하는 행 선택</a></li>
<li class="chapter" data-level="8.1.8" data-path="section-38.html"><a href="section-38.html#summarize---"><i class="fa fa-check"></i><b>8.1.8</b> <code>summarize()</code>: 요약 통계값 계산</a></li>
<li class="chapter" data-level="8.1.9" data-path="section-38.html"><a href="section-38.html#arrange--"><i class="fa fa-check"></i><b>8.1.9</b> <code>arrange()</code>: 데이터 정렬</a></li>
<li class="chapter" data-level="8.1.10" data-path="section-38.html"><a href="section-38.html#row_number--"><i class="fa fa-check"></i><b>8.1.10</b> <code>row_number()</code>: 순위 계산</a></li>
<li class="chapter" data-level="8.1.11" data-path="section-38.html"><a href="section-38.html#ntile--"><i class="fa fa-check"></i><b>8.1.11</b> <code>ntile()</code>: 분위수 계산</a></li>
<li class="chapter" data-level="8.1.12" data-path="section-38.html"><a href="section-38.html#group_by---"><i class="fa fa-check"></i><b>8.1.12</b> <code>group_by()</code>: 그룹별로 데이터를 묶음</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="section-38.html"><a href="section-38.html#section-40"><i class="fa fa-check"></i><b>8.2</b> 종목정보 시각화</a><ul>
<li class="chapter" data-level="8.2.1" data-path="section-38.html"><a href="section-38.html#geom_point--"><i class="fa fa-check"></i><b>8.2.1</b> <code>geom_point()</code>: 산점도 나타내기</a></li>
<li class="chapter" data-level="8.2.2" data-path="section-38.html"><a href="section-38.html#geom_histogram--"><i class="fa fa-check"></i><b>8.2.2</b> <code>geom_histogram()</code>: 히스토그램 나타내기</a></li>
<li class="chapter" data-level="8.2.3" data-path="section-38.html"><a href="section-38.html#geom_boxplot--"><i class="fa fa-check"></i><b>8.2.3</b> <code>geom_boxplot()</code>: 박스플롯 나타내기</a></li>
<li class="chapter" data-level="8.2.4" data-path="section-38.html"><a href="section-38.html#dplyr-ggplot--"><i class="fa fa-check"></i><b>8.2.4</b> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</a></li>
<li class="chapter" data-level="8.2.5" data-path="section-38.html"><a href="section-38.html#geom_bar--"><i class="fa fa-check"></i><b>8.2.5</b> <code>geom_bar()</code>: 막대그래프를 나타내기</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="section-38.html"><a href="section-38.html#section-41"><i class="fa fa-check"></i><b>8.3</b> 주가 및 수익률 시각화</a><ul>
<li class="chapter" data-level="8.3.1" data-path="section-38.html"><a href="section-38.html#section-42"><i class="fa fa-check"></i><b>8.3.1</b> 주가 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.2" data-path="section-38.html"><a href="section-38.html#section-43"><i class="fa fa-check"></i><b>8.3.2</b> 인터랙티브 그래프 나타내기</a></li>
<li class="chapter" data-level="8.3.3" data-path="section-38.html"><a href="section-38.html#section-44"><i class="fa fa-check"></i><b>8.3.3</b> 연도별 수익률 나타내기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="section-45.html"><a href="section-45.html"><i class="fa fa-check"></i><b>9</b> 퀀트 전략을 이용한 종목선정 (기본)</a><ul>
<li class="chapter" data-level="9.1" data-path="section-45.html"><a href="section-45.html#section-46"><i class="fa fa-check"></i><b>9.1</b> 베타 이해하기</a><ul>
<li class="chapter" data-level="9.1.1" data-path="section-45.html"><a href="section-45.html#section-47"><i class="fa fa-check"></i><b>9.1.1</b> 베타 계산하기</a></li>
<li class="chapter" data-level="9.1.2" data-path="section-45.html"><a href="section-45.html#section-48"><i class="fa fa-check"></i><b>9.1.2</b> 베타 시각화</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="section-45.html"><a href="section-45.html#section-49"><i class="fa fa-check"></i><b>9.2</b> 저변동성 전략</a><ul>
<li class="chapter" data-level="9.2.1" data-path="section-45.html"><a href="section-45.html#section-50"><i class="fa fa-check"></i><b>9.2.1</b> 저변동성 포트폴리오 구하기: 일간 기준</a></li>
<li class="chapter" data-level="9.2.2" data-path="section-45.html"><a href="section-45.html#section-51"><i class="fa fa-check"></i><b>9.2.2</b> 저변동성 포트폴리오 구하기: 주간 기준</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="section-45.html"><a href="section-45.html#section-52"><i class="fa fa-check"></i><b>9.3</b> 모멘텀 전략</a><ul>
<li class="chapter" data-level="9.3.1" data-path="section-45.html"><a href="section-45.html#section-53"><i class="fa fa-check"></i><b>9.3.1</b> 모멘텀 포트폴리오 구하기: 12개월 모멘텀</a></li>
<li class="chapter" data-level="9.3.2" data-path="section-45.html"><a href="section-45.html#section-54"><i class="fa fa-check"></i><b>9.3.2</b> 모멘텀 포트폴리오 구하기: 위험조정 수익률</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="section-45.html"><a href="section-45.html#section-55"><i class="fa fa-check"></i><b>9.4</b> 밸류 전략</a><ul>
<li class="chapter" data-level="9.4.1" data-path="section-45.html"><a href="section-45.html#pbr"><i class="fa fa-check"></i><b>9.4.1</b> 밸류 포트폴리오 구하기: 저 PBR</a></li>
<li class="chapter" data-level="9.4.2" data-path="section-45.html"><a href="section-45.html#section-56"><i class="fa fa-check"></i><b>9.4.2</b> 각 지표를 결합하기</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="section-45.html"><a href="section-45.html#section-57"><i class="fa fa-check"></i><b>9.5</b> 퀄리티 전략</a><ul>
<li class="chapter" data-level="9.5.1" data-path="section-45.html"><a href="section-45.html#f-score"><i class="fa fa-check"></i><b>9.5.1</b> F-Score</a></li>
<li class="chapter" data-level="9.5.2" data-path="section-45.html"><a href="section-45.html#section-58"><i class="fa fa-check"></i><b>9.5.2</b> 각 지표를 결합하기</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="section-59.html"><a href="section-59.html"><i class="fa fa-check"></i><b>10</b> 퀀트 전략을 이용한 종목선정 (심화)</a><ul>
<li class="chapter" data-level="10.1" data-path="section-59.html"><a href="section-59.html#section-60"><i class="fa fa-check"></i><b>10.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="10.2" data-path="section-59.html"><a href="section-59.html#section-61"><i class="fa fa-check"></i><b>10.2</b> 마법공식</a><ul>
<li class="chapter" data-level="10.2.1" data-path="section-59.html"><a href="section-59.html#section-62"><i class="fa fa-check"></i><b>10.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="10.2.2" data-path="section-59.html"><a href="section-59.html#section-63"><i class="fa fa-check"></i><b>10.2.2</b> 마법공식 이해하기</a></li>
<li class="chapter" data-level="10.2.3" data-path="section-59.html"><a href="section-59.html#section-64"><i class="fa fa-check"></i><b>10.2.3</b> 마법공식 구성하기</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="section-59.html"><a href="section-59.html#section-65"><i class="fa fa-check"></i><b>10.3</b> 이상치 데이터 제거 및 팩터의 결합</a><ul>
<li class="chapter" data-level="10.3.1" data-path="section-59.html"><a href="section-59.html#trim---"><i class="fa fa-check"></i><b>10.3.1</b> 트림(Trim): 이상치 데이터 삭제</a></li>
<li class="chapter" data-level="10.3.2" data-path="section-59.html"><a href="section-59.html#winsorizing---"><i class="fa fa-check"></i><b>10.3.2</b> 윈저라이징(Winsorizing): 이상치 데이터 대체</a></li>
<li class="chapter" data-level="10.3.3" data-path="section-59.html"><a href="section-59.html#section-66"><i class="fa fa-check"></i><b>10.3.3</b> 팩터의 결합 방법</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="section-59.html"><a href="section-59.html#section-67"><i class="fa fa-check"></i><b>10.4</b> 멀티팩터 포트폴리오</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="section-68.html"><a href="section-68.html"><i class="fa fa-check"></i><b>11</b> 포트폴리오 구성</a><ul>
<li class="chapter" data-level="11.1" data-path="section-68.html"><a href="section-68.html#section-69"><i class="fa fa-check"></i><b>11.1</b> 최소분산 포트폴리오</a><ul>
<li class="chapter" data-level="11.1.1" data-path="section-68.html"><a href="section-68.html#slsqp---"><i class="fa fa-check"></i><b>11.1.1</b> <code>slsqp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.2" data-path="section-68.html"><a href="section-68.html#solve.qp---"><i class="fa fa-check"></i><b>11.1.2</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.3" data-path="section-68.html"><a href="section-68.html#optimalportfolio---"><i class="fa fa-check"></i><b>11.1.3</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.1.4" data-path="section-68.html"><a href="section-68.html#section-70"><i class="fa fa-check"></i><b>11.1.4</b> 결과값들의 비교</a></li>
<li class="chapter" data-level="11.1.5" data-path="section-68.html"><a href="section-68.html#section-71"><i class="fa fa-check"></i><b>11.1.5</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.1.6" data-path="section-68.html"><a href="section-68.html#section-72"><i class="fa fa-check"></i><b>11.1.6</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="section-68.html"><a href="section-68.html#section-73"><i class="fa fa-check"></i><b>11.2</b> 최대분산효과 포트폴리오</a><ul>
<li class="chapter" data-level="11.2.1" data-path="section-68.html"><a href="section-68.html#solve.qp----1"><i class="fa fa-check"></i><b>11.2.1</b> <code>solve.QP()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.2" data-path="section-68.html"><a href="section-68.html#optimalportfolio----1"><i class="fa fa-check"></i><b>11.2.2</b> <code>optimalPortfolio()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.2.3" data-path="section-68.html"><a href="section-68.html#section-74"><i class="fa fa-check"></i><b>11.2.3</b> 최소 및 최대 투자비중 제약조건</a></li>
<li class="chapter" data-level="11.2.4" data-path="section-68.html"><a href="section-68.html#section-75"><i class="fa fa-check"></i><b>11.2.4</b> 각 자산 별 제약조건의 추가</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="section-68.html"><a href="section-68.html#section-76"><i class="fa fa-check"></i><b>11.3</b> 위험균형 포트폴리오</a><ul>
<li class="chapter" data-level="11.3.1" data-path="section-68.html"><a href="section-68.html#section-77"><i class="fa fa-check"></i><b>11.3.1</b> 주식 60%와 채권 40% 포트폴리오의 위험기여도</a></li>
<li class="chapter" data-level="11.3.2" data-path="section-68.html"><a href="section-68.html#rp---"><i class="fa fa-check"></i><b>11.3.2</b> <code>rp()</code> 함수를 이용한 최적화</a></li>
<li class="chapter" data-level="11.3.3" data-path="section-68.html"><a href="section-68.html#section-78"><i class="fa fa-check"></i><b>11.3.3</b> 위험예산 포트폴리오</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="section-79.html"><a href="section-79.html"><i class="fa fa-check"></i><b>12</b> 포트폴리오 백테스트</a><ul>
<li class="chapter" data-level="12.1" data-path="section-79.html"><a href="section-79.html#return.portfolio-"><i class="fa fa-check"></i><b>12.1</b> <code>Return.Portfolio()</code> 함수</a><ul>
<li class="chapter" data-level="12.1.1" data-path="section-79.html"><a href="section-79.html#section-80"><i class="fa fa-check"></i><b>12.1.1</b> 인자목록 살펴보기</a></li>
<li class="chapter" data-level="12.1.2" data-path="section-79.html"><a href="section-79.html#section-81"><i class="fa fa-check"></i><b>12.1.2</b> 출력값 살펴보기</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="section-79.html"><a href="section-79.html#section-82"><i class="fa fa-check"></i><b>12.2</b> 전통적인 60대 40 포트폴리오 백테스트</a></li>
<li class="chapter" data-level="12.3" data-path="section-79.html"><a href="section-79.html#section-83"><i class="fa fa-check"></i><b>12.3</b> 시점 선택 전략 백테스트</a></li>
<li class="chapter" data-level="12.4" data-path="section-79.html"><a href="section-79.html#section-84"><i class="fa fa-check"></i><b>12.4</b> 동적 자산배분 백테스트</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="section-85.html"><a href="section-85.html"><i class="fa fa-check"></i><b>13</b> 성과 및 위험 평가</a><ul>
<li class="chapter" data-level="13.1" data-path="section-85.html"><a href="section-85.html#section-86"><i class="fa fa-check"></i><b>13.1</b> 결과 측정 지표</a><ul>
<li class="chapter" data-level="13.1.1" data-path="section-85.html"><a href="section-85.html#section-87"><i class="fa fa-check"></i><b>13.1.1</b> 수익률 및 변동성</a></li>
<li class="chapter" data-level="13.1.2" data-path="section-85.html"><a href="section-85.html#section-88"><i class="fa fa-check"></i><b>13.1.2</b> 낙폭과 최대낙폭</a></li>
<li class="chapter" data-level="13.1.3" data-path="section-85.html"><a href="section-85.html#section-89"><i class="fa fa-check"></i><b>13.1.3</b> 연도별 수익률</a></li>
<li class="chapter" data-level="13.1.4" data-path="section-85.html"><a href="section-85.html#section-90"><i class="fa fa-check"></i><b>13.1.4</b> 승률 및 롤링 윈도우 값</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="section-85.html"><a href="section-85.html#section-91"><i class="fa fa-check"></i><b>13.2</b> 팩터 회귀분석 및 테이블로 나타내기</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://henryquant.blogspot.com/" target="blank">Henry's Quantopia</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">퀀트 투자 쿡북: R을 이용한 투자 포트폴리오 만들기</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="section-38" class="section level1">
<h1><span class="header-section-number">Chapter 8</span> 데이터 분석 및 시각화하기</h1>
<p>데이터 수집 및 정리가 끝났다면, 내가 가지고 있는 데이터가 어떠한 특성을 가지고 있는지에 대한 분석 및 시각화 과정, 즉 <strong>탐색적 데이터 분석(Exploratory Data Analysis)</strong>을 할 필요가 있습니다. 해당 과정을 통해 데이터를 더 잘 이해할 수 있으며, 극단치나 결측치 등 데이터가 가지고 있는 잠재적인 문제를 발견하고 이를 어떻게 처리할지에 대해 고민할 수 있습니다.</p>
<p>해당 장에서는 <code>dplyr</code> 패키지를 이용한 데이터 분석과 <code>ggplot</code> 패키지를 이용한 데이터 시각화에 대해 알아보도록 하겠습니다.</p>
<div id="section-39" class="section level2">
<h2><span class="header-section-number">8.1</span> 종목정보 데이터 분석</h2>
<p>먼저 거래소를 통해 수집한 산업별 현황과 개별지표를 정리한 파일, WICS 기준 섹터지표를 정리한 파일을 통해 국내 상장종목의 데이터를 분석해보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)

KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>,
                      <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
KOR_sector =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_sector.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>,
                      <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =
<span class="st">  </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>,<span class="st">&#39;left&#39;</span>, <span class="dv">0</span>)
KOR_sector<span class="op">$</span><span class="st">&#39;CMP_CD&#39;</span> =
<span class="st">  </span><span class="kw">str_pad</span>(KOR_sector<span class="op">$</span><span class="st">&#39;CMP_CD&#39;</span>, <span class="dv">6</span>, <span class="st">&#39;left&#39;</span>, <span class="dv">0</span>)</code></pre>
<p>먼저 각 파일을 불러온 후, 티커에 해당하는 종목코드와 CMP_CD 열을 6자리 숫자로 만들어 주도록 합니다.</p>
<p>이제 <code>dplyr</code> 패키지의 여러 함수들을 이용하여 데이터를 분석해보도록 하겠습니다. 해당 패키지는 데이터 처리에 특화된 패키지이며, C++로 작성되어 매우 빠른 처리속도를 자랑합니다. 또한 문법이 SQL과 매우 비슷하여, 함수들의 내용을 직관적으로 이해할 수 있습니다.</p>
<div id="join--" class="section level3">
<h3><span class="header-section-number">8.1.1</span> <code>*_join</code>: 데이터 합치기</h3>
<p>두 테이블을 하나로 합치기 위해 <code>*_join()</code> 함수를 이용하도록 합니다. 해당 함수는 기존에 살펴본 <code>merge()</code> 함수와 동일하며, 합치는 방법은 그림 <a href="section-38.html#fig:joinimg">8.1</a>과 표 <a href="section-38.html#tab:joindesc">8.1</a>과 같이 크게 4가지 종류가 있습니다.</p>
<div class="figure" style="text-align: center"><span id="fig:joinimg"></span>
<img src="images/data_analysis_join.png" alt="join 함수의 종류" width="70%" />
<p class="caption">
그림 8.1: join 함수의 종류
</p>
</div>
<table>
<caption><span id="tab:joindesc">표 8.1: </span>join 함수의 종류</caption>
<thead>
<tr class="header">
<th align="center">함수</th>
<th align="center">내용</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">inner_join()</td>
<td align="center">교집합</td>
</tr>
<tr class="even">
<td align="center">full_join()</td>
<td align="center">합집합</td>
</tr>
<tr class="odd">
<td align="center">left_join()</td>
<td align="center">좌측 기준</td>
</tr>
<tr class="even">
<td align="center">right_join()</td>
<td align="center">우측 기준</td>
</tr>
</tbody>
</table>
<p>이 중 거래소 티커 기준으로 데이터를 맞추기 위해 <code>left_join()</code> 함수를 사용하여 두 데이터를 합치도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

data_market =<span class="st"> </span><span class="kw">left_join</span>(KOR_ticker, KOR_sector,
                         <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;종목코드&#39;</span> =<span class="st"> &#39;CMP_CD&#39;</span>,
                                <span class="st">&#39;종목명&#39;</span> =<span class="st"> &#39;CMP_KOR&#39;</span>))

<span class="kw">head</span>(data_market)</code></pre>
<pre><code>##   종목코드     종목명 시장구분 산업분류 현재가.종가. 전일대비 시가총액.원.
## 1   005930   삼성전자   코스피 전기전자        45400     -850    2.710e+14
## 2   000660 SK하이닉스   코스피 전기전자        69100    -2300    5.030e+13
## 3   005380     현대차   코스피 운수장비       136000    -1000    2.906e+13
## 4   068270   셀트리온   코스피   의약품       206000     1000    2.644e+13
## 5   051910     LG화학   코스피     화학       355500     7000    2.510e+13
## 6   012330 현대모비스   코스피 운수장비       229500    -2500    2.187e+13
##         일자 관리여부   종가    EPS   PER     BPS   PBR 주당배당금
## 1 2019-07-03        -  45400  6,461  7.03  35,342  1.28       1416
## 2 2019-07-03        -  69100 22,255   3.1  64,348  1.07       1500
## 3 2019-07-03        - 136000  5,632 24.15 245,447  0.55       4000
## 4 2019-07-03        - 206000  2,063 99.85  19,766 10.42          0
## 5 2019-07-03        - 355500 19,217  18.5 218,227  1.63       6000
## 6 2019-07-03        - 229500 19,944 11.51 314,650  0.73       4000
##   배당수익률 게시물..일련번호 총카운트 IDX_CD          IDX_NM_KOR
## 1       3.12             2165       NA    G45             WICS IT
## 2       2.17             1885       NA    G45             WICS IT
## 3       2.94             2159       NA    G25 WICS 경기관련소비재
## 4       0.00             2049       NA    G35       WICS 건강관리
## 5       1.69             2041       NA    G15           WICS 소재
## 6       1.74             2169       NA    G25 WICS 경기관련소비재
##   ALL_MKT_VAL   MKT_VAL   WGT S_WGT CAL_WGT SEC_CD     SEC_NM_KOR SEQ
## 1   376270891 208452867 55.40 55.40       1    G45             IT   1
## 2   376270891  35232402  9.36 64.76       1    G45             IT   2
## 3   141374708  20042076 14.18 14.18       1    G25 경기관련소비재   1
## 4    81157991  16895164 20.82 20.82       1    G35       건강관리   1
## 5    71815100  15165000 21.12 43.84       1    G15           소재   2
## 6   141374708  14257881 10.09 24.26       1    G25 경기관련소비재   2
##   TOP60 APT_SHR_CNT
## 1     2  4716128215
## 2     2   538721750
## 3    12   143157685
## 4    21    85980477
## 5     6    45885023
## 6    12    64808552</code></pre>
<p><code>left_join()</code> 함수를 이용해 KOR_ticker와 KOR_sector 데이터를 합쳐주도록 합니다. by 인자는 데이터를 합치는 기준점을 의미하며, x 데이터(KOR_ticker)의 <strong>종목코드</strong>와 y 데이터(KOR_sector)의 <strong>CMP_CD</strong>는 같음을, x 데이터의 <strong>종목명</strong>과 y 데이터의 <strong>CMP_KOR</strong>는 같음을 정의합니다.</p>
</div>
<div id="glimpse---" class="section level3">
<h3><span class="header-section-number">8.1.2</span> <code>glimpse()</code>: 데이터 구조 확인하기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(data_market)</code></pre>
<pre><code>## Observations: 2,041
## Variables: 30
## $ 종목코드         &lt;chr&gt; &quot;005930&quot;, &quot;000660&quot;, &quot;005...
## $ 종목명           &lt;chr&gt; &quot;삼성전자&quot;, &quot;SK하이닉스&quot;, &quot;현대차&quot;...
## $ 시장구분         &lt;chr&gt; &quot;코스피&quot;, &quot;코스피&quot;, &quot;코스피&quot;, &quot;코스...
## $ 산업분류         &lt;chr&gt; &quot;전기전자&quot;, &quot;전기전자&quot;, &quot;운수장비&quot;, ...
## $ 현재가.종가.     &lt;int&gt; 45400, 69100, 136000, 206...
## $ 전일대비         &lt;int&gt; -850, -2300, -1000, 1000...
## $ 시가총액.원.     &lt;dbl&gt; 2.710e+14, 5.030e+13, 2.9...
## $ 일자             &lt;chr&gt; &quot;2019-07-03&quot;, &quot;2019-07...
## $ 관리여부         &lt;chr&gt; &quot;-&quot;, &quot;-&quot;, &quot;-&quot;, &quot;-&quot;, &quot;-&quot;,...
## $ 종가             &lt;int&gt; 45400, 69100, 136000, ...
## $ EPS              &lt;chr&gt; &quot;6,461&quot;, &quot;22,255&quot;, &quot;...
## $ PER              &lt;chr&gt; &quot;7.03&quot;, &quot;3.1&quot;, &quot;24.1...
## $ BPS              &lt;chr&gt; &quot;35,342&quot;, &quot;64,348&quot;, ...
## $ PBR              &lt;chr&gt; &quot;1.28&quot;, &quot;1.07&quot;, &quot;0.5...
## $ 주당배당금       &lt;int&gt; 1416, 1500, 4000, 0, 6000...
## $ 배당수익률       &lt;dbl&gt; 3.12, 2.17, 2.94, 0.00, 1...
## $ 게시물..일련번호 &lt;int&gt; 2165, 1885, 2159, 2049, 204...
## $ 총카운트         &lt;int&gt; NA, NA, NA, NA, NA, NA, ...
## $ IDX_CD           &lt;chr&gt; &quot;G45&quot;, &quot;G45&quot;, &quot;G25&quot;,...
## $ IDX_NM_KOR       &lt;chr&gt; &quot;WICS IT&quot;, &quot;WICS IT&quot;...
## $ ALL_MKT_VAL      &lt;int&gt; 376270891, 376270891...
## $ MKT_VAL          &lt;int&gt; 208452867, 35232402,...
## $ WGT              &lt;dbl&gt; 55.40, 9.36, 14.18, ...
## $ S_WGT            &lt;dbl&gt; 55.40, 64.76, 14.18,...
## $ CAL_WGT          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1,...
## $ SEC_CD           &lt;chr&gt; &quot;G45&quot;, &quot;G45&quot;, &quot;G25&quot;,...
## $ SEC_NM_KOR       &lt;chr&gt; &quot;IT&quot;, &quot;IT&quot;, &quot;경기관련소비재...
## $ SEQ              &lt;int&gt; 1, 2, 1, 1, 2, 2, 1,...
## $ TOP60            &lt;int&gt; 2, 2, 12, 21, 6, 12,...
## $ APT_SHR_CNT      &lt;dbl&gt; 4716128215, 53872175...</code></pre>
<p><code>glimpse()</code> 함수는 데이터 내용, 구조, 형식을 확인하는 함수입니다. 기본 함수인 <code>str()</code>과 그 역할은 비슷하지만, tidy 형태로 결과물이 훨씬 깔끔하게 출력됩니다. 총 관측값 및 열의 갯수, 각 열의 이름과 데이터 형식, 앞부분 데이터를 확인할 수 있습니다.</p>
</div>
<div id="rename---" class="section level3">
<h3><span class="header-section-number">8.1.3</span> <code>rename()</code>: 열 이름 바꾸기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(<span class="kw">names</span>(data_market), <span class="dv">10</span>)</code></pre>
<pre><code>##  [1] &quot;종목코드&quot;     &quot;종목명&quot;       &quot;시장구분&quot;     &quot;산업분류&quot;    
##  [5] &quot;현재가.종가.&quot; &quot;전일대비&quot;     &quot;시가총액.원.&quot; &quot;일자&quot;        
##  [9] &quot;관리여부&quot;     &quot;종가&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market =<span class="st"> </span>data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">시가총액</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">시가총액.원.</span><span class="st">`</span>)

<span class="kw">head</span>(<span class="kw">names</span>(data_market), <span class="dv">10</span>)</code></pre>
<pre><code>##  [1] &quot;종목코드&quot;     &quot;종목명&quot;       &quot;시장구분&quot;     &quot;산업분류&quot;    
##  [5] &quot;현재가.종가.&quot; &quot;전일대비&quot;     &quot;시가총액&quot;     &quot;일자&quot;        
##  [9] &quot;관리여부&quot;     &quot;종가&quot;</code></pre>
<p><code>rename()</code> 함수는 열 이름을 바꾸는 함수로써, <code>rename(tbl, new_name, old_name)</code> 형태로 입력합니다. 위의 경우 <strong>시가총액.원.</strong> 열이름이 <strong>시가총액</strong>으로 변경되었습니다.</p>
</div>
<div id="distinct---" class="section level3">
<h3><span class="header-section-number">8.1.4</span> distinct(): 고유한 값 확인</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>(SEC_NM_KOR) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">c</span>() </code></pre>
<pre><code>## $SEC_NM_KOR
##  [1] &quot;IT&quot;                 &quot;경기관련소비재&quot;     &quot;건강관리&quot;          
##  [4] &quot;소재&quot;               &quot;금융&quot;               &quot;커뮤니케이션서비스&quot;
##  [7] &quot;산업재&quot;             &quot;유틸리티&quot;           &quot;에너지&quot;            
## [10] &quot;필수소비재&quot;         NA</code></pre>
<p><code>distinct()</code> 함수는 고유한 값을 반환하며, 기본함수 중 <code>unique()</code>와 동일한 기능을 합니다. 데이터의 섹터 정보를 확인해보면, WICS 기준 10개 섹터 및 섹터 정보가 없는 종목인 NA 값이 있습니다.</p>
</div>
<div id="select---" class="section level3">
<h3><span class="header-section-number">8.1.5</span> <code>select()</code>: 원하는 열만 선택</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##       종목명
## 1   삼성전자
## 2 SK하이닉스
## 3     현대차
## 4   셀트리온
## 5     LG화학
## 6 현대모비스</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, <span class="st">`</span><span class="dt">PBR</span><span class="st">`</span>, <span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##       종목명   PBR     SEC_NM_KOR
## 1   삼성전자  1.28             IT
## 2 SK하이닉스  1.07             IT
## 3     현대차  0.55 경기관련소비재
## 4   셀트리온 10.42       건강관리
## 5     LG화학  1.63           소재
## 6 현대모비스  0.73 경기관련소비재</code></pre>
<p><code>select()</code> 함수는 원하는 열을 선택해주는 함수이며, 원하는 열 이름을 입력하면 됩니다. 하나의 열 뿐만 아니라 다수의 열을 입력할 경우 해당 열들이 선택됩니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">starts_with</span>(<span class="st">&#39;시&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##   시장구분  시가총액
## 1   코스피 2.710e+14
## 2   코스피 5.030e+13
## 3   코스피 2.906e+13
## 4   코스피 2.644e+13
## 5   코스피 2.510e+13
## 6   코스피 2.187e+13</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">ends_with</span>(<span class="st">&#39;R&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##     PER   PBR          IDX_NM_KOR     SEC_NM_KOR
## 1  7.03  1.28             WICS IT             IT
## 2   3.1  1.07             WICS IT             IT
## 3 24.15  0.55 WICS 경기관련소비재 경기관련소비재
## 4 99.85 10.42       WICS 건강관리       건강관리
## 5  18.5  1.63           WICS 소재           소재
## 6 11.51  0.73 WICS 경기관련소비재 경기관련소비재</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="kw">contains</span>(<span class="st">&#39;가&#39;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##   현재가.종가.  시가총액   종가
## 1        45400 2.710e+14  45400
## 2        69100 5.030e+13  69100
## 3       136000 2.906e+13 136000
## 4       206000 2.644e+13 206000
## 5       355500 2.510e+13 355500
## 6       229500 2.187e+13 229500</code></pre>
<p>해당 함수는 다양한 응용기능도 제공합니다. <code>starts_with()</code>의 경우 특정 문자로 시작하는 열들을, <code>ends_with()</code>의 경우 특정 문자로 끝나는 열들을, <code>contains()</code>의 경우 특정 문자가 포함되는 열들을 선택해 줍니다.</p>
</div>
<div id="mutate-----" class="section level3">
<h3><span class="header-section-number">8.1.6</span> <code>mutate()</code>: 열 생성 및 데이터 변형</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market =<span class="st"> </span>data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">PBR</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.numeric</span>(PBR),
         <span class="st">`</span><span class="dt">PER</span><span class="st">`</span> =<span class="st"> </span><span class="kw">as.numeric</span>(PER),
         <span class="st">`</span><span class="dt">ROE</span><span class="st">`</span> =<span class="st"> </span>PBR <span class="op">/</span><span class="st"> </span>PER,
         <span class="st">`</span><span class="dt">ROE</span><span class="st">`</span> =<span class="st"> </span><span class="kw">round</span>(ROE, <span class="dv">4</span>),
         <span class="st">`</span><span class="dt">size</span><span class="st">`</span> =<span class="st"> </span><span class="kw">ifelse</span>(<span class="st">`</span><span class="dt">시가총액</span><span class="st">`</span> <span class="op">&gt;=</span>
<span class="st">                           </span><span class="kw">median</span>(<span class="st">`</span><span class="dt">시가총액</span><span class="st">`</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                                        <span class="st">&#39;big&#39;</span>, <span class="st">&#39;small&#39;</span>)
  )

data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, <span class="st">`</span><span class="dt">ROE</span><span class="st">`</span>, <span class="st">`</span><span class="dt">size</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##       종목명    ROE size
## 1   삼성전자 0.1821  big
## 2 SK하이닉스 0.3452  big
## 3     현대차 0.0228  big
## 4   셀트리온 0.1044  big
## 5     LG화학 0.0881  big
## 6 현대모비스 0.0634  big</code></pre>
<p><code>mutate()</code> 함수는 원하는 형태로 열을 생성하거나 변형하는 함수입니다. 위의 예제에서는 먼저 PBR과 PER열을 <code>as.numeric()</code> 함수를 통해 숫자 형태로 변경한 후, PBR을 PER로 나눈 값을 ROE 열에 생성합니다. 그 후, <code>round()</code> 함수를 통해 ROE 값을 반올림 해주며, <code>ifelse()</code> 함수를 통해 시가총액의 중앙값 보다 큰 기업의 경우 big, 아닐 경우 small 임을 size 열에 저장해줍니다.</p>
<p>이 외에도 <code>mutate_*()</code> 계열 함수에는 <code>mutate_all()</code>, <code>mutate_if()</code>, <code>mutate_at()</code> 처럼 각 상황에 맞게 쓸수있는 다양한 함수들이 존재합니다.</p>
</div>
<div id="filter----" class="section level3">
<h3><span class="header-section-number">8.1.7</span> <code>filter()</code>: 조건을 충족하는 행 선택</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, <span class="st">`</span><span class="dt">PBR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="st">`</span><span class="dt">PBR</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##       종목명  PBR
## 1     현대차 0.55
## 2 현대모비스 0.73
## 3      POSCO 0.49
## 4   신한지주 0.59
## 5   SK텔레콤 0.93
## 6     KB금융 0.53</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, <span class="st">`</span><span class="dt">PBR</span><span class="st">`</span>, <span class="st">`</span><span class="dt">PER</span><span class="st">`</span>, <span class="st">`</span><span class="dt">ROE</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(PBR <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>PER <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>ROE <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.1</span> ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre>
<pre><code>##       종목명  PBR  PER    ROE
## 1   SK텔레콤 0.93 5.85 0.1590
## 2         SK 0.97 5.66 0.1714
## 3         LG 0.74 7.19 0.1029
## 4 롯데케미칼 0.72 5.83 0.1235
## 5         GS 0.56 5.28 0.1061
## 6   대림산업 0.80 6.69 0.1196</code></pre>
<p><code>filter()</code> 함수는 조건을 충족하는 부분의 데이터를 반환하는 함수입니다. 첫번째 예제와 같이 PBR이 1 미만인 단일 조건을 입력할 수도 있으며, 두번째 예제와 같이 PBR 1 미만, PER 20 미만, ROE 0.1 초과 등 복수 조건을 입력할 수도 있습니다.</p>
</div>
<div id="summarize---" class="section level3">
<h3><span class="header-section-number">8.1.8</span> <code>summarize()</code>: 요약 통계값 계산</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">PBR_max =</span> <span class="kw">max</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">PBR_min =</span> <span class="kw">min</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre>
<pre><code>##   PBR_max PBR_min
## 1    87.2    0.19</code></pre>
<p><code>summarize()</code> 혹은 <code>summarise()</code> 함수는 원하는 요약 통계값을 계산해 줍니다. PBR_max은 PBR 열에서 최대값을, PBR_min은 최소값을 계산해줍니다.</p>
</div>
<div id="arrange--" class="section level3">
<h3><span class="header-section-number">8.1.9</span> <code>arrange()</code>: 데이터 정렬</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(PBR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(PBR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>##    PBR
## 1 0.19
## 2 0.21
## 3 0.21
## 4 0.23
## 5 0.23</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(ROE) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ROE)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>##      ROE
## 1 1.3404
## 2 0.9589
## 3 0.7175
## 4 0.5761
## 5 0.5714</code></pre>
<p><code>arrange()</code> 함수는 선택한 열을 기준으로 데이터를 정렬해주며, 오름차순을 기준으로 정렬합니다. 내림차순으로 데이터를 정렬하고자 할 경우 <code>arrange()</code> 내에 <code>desc()</code> 함수를 추가로 입력해주면 됩니다.</p>
</div>
<div id="row_number--" class="section level3">
<h3><span class="header-section-number">8.1.10</span> <code>row_number()</code>: 순위 계산</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">PBR_rank =</span> <span class="kw">row_number</span>(PBR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, PBR, PBR_rank) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(PBR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>##       종목명  PBR PBR_rank
## 1 세아홀딩스 0.19        1
## 2   한국제지 0.21        2
## 3   세원정공 0.21        3
## 4     휴스틸 0.23        4
## 5       전방 0.23        5</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">PBR_rank =</span> <span class="kw">row_number</span>(<span class="kw">desc</span>(ROE))) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목명</span><span class="st">`</span>, ROE, PBR_rank) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ROE)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</code></pre>
<pre><code>##           종목명    ROE PBR_rank
## 1           효성 1.3404        1
## 2 바른손이앤에이 0.9589        2
## 3        THE E&amp;M 0.7175        3
## 4         케이씨 0.5761        4
## 5     한일홀딩스 0.5714        5</code></pre>
<p><code>row_number()</code> 함수는 선택한 열의 순위를 구해줍니다. 기본적으로 오름차순 기준으로 순위를 구하며, 내림차순으로 구하고자 할 떄는 <code>desc()</code> 함수를 추가해주면 됩니다.</p>
<p>순위를 구하는 함수는 이 외에도 <code>min_rank()</code>, <code>dense_rank()</code>, <code>percent_rank()</code>가 있습니다.</p>
</div>
<div id="ntile--" class="section level3">
<h3><span class="header-section-number">8.1.11</span> <code>ntile()</code>: 분위수 계산</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">PBR_tile =</span> <span class="kw">ntile</span>(PBR, <span class="dt">n =</span> <span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(PBR, PBR_tile) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>()</code></pre>
<pre><code>##     PBR PBR_tile
## 1  1.28        3
## 2  1.07        3
## 3  0.55        1
## 4 10.42        5
## 5  1.63        4
## 6  0.73        2</code></pre>
<p><code>ntile()</code> 함수는 분위수를 계산해주며, n 인자를 통해 몇 분위로 나눌지를 선택할 수 있습니다. 해당 함수 역시 오름차순을 기준으로 분위수를 나눕니다.</p>
</div>
<div id="group_by---" class="section level3">
<h3><span class="header-section-number">8.1.12</span> <code>group_by()</code>: 그룹별로 데이터를 묶음</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="kw">n</span>())</code></pre>
<pre><code>## # A tibble: 11 x 2
##    SEC_NM_KOR         `n()`
##    &lt;chr&gt;              &lt;int&gt;
##  1 &lt;NA&gt;                  77
##  2 IT                   574
##  3 건강관리             226
##  4 경기관련소비재       393
##  5 금융                  78
##  6 산업재               332
##  7 소재                 216
##  8 에너지                23
##  9 유틸리티              19
## 10 커뮤니케이션서비스     7
## 11 필수소비재            96</code></pre>
<p><code>group_by()</code> 함수는 선택한 열 중 동일한 데이터를 기준으로 데이터를 묶어줍니다. 위의 예제에서는 섹터를 나타내는 SEC_NM_KOR 기준으로 데이터를 묶었으며, <code>n()</code> 함수를 통해 해당 그룹 내 데이터의 갯수를 구할 수 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">PBR_median =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(PBR_median)</code></pre>
<pre><code>## # A tibble: 11 x 2
##    SEC_NM_KOR         PBR_median
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 유틸리티                 0.48
##  2 금융                     0.72
##  3 소재                     0.76
##  4 산업재                   0.93
##  5 커뮤니케이션서비스       0.93
##  6 필수소비재               0.96
##  7 에너지                   0.98
##  8 경기관련소비재           1.07
##  9 IT                       1.53
## 10 &lt;NA&gt;                     1.72
## 11 건강관리                 2.59</code></pre>
<p>위 예제는 섹터를 기준으로 데이터를 묶은 후, <code>summarize()</code>를 통해 각각의 섹터에 속하는 종목들의 PBR 중앙값을 구한 후, 정렬하였습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">시장구분</span><span class="st">`</span>, <span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">PBR_median =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(PBR_median)</code></pre>
<pre><code>## # A tibble: 22 x 3
## # Groups:   시장구분 [2]
##    시장구분 SEC_NM_KOR         PBR_median
##    &lt;chr&gt;    &lt;chr&gt;                   &lt;dbl&gt;
##  1 코스피   유틸리티                0.46 
##  2 코스피   금융                    0.575
##  3 코스피   소재                    0.69 
##  4 코스피   경기관련소비재          0.79 
##  5 코스피   에너지                  0.8  
##  6 코스피   필수소비재              0.81 
##  7 코스피   산업재                  0.84 
##  8 코스피   커뮤니케이션서비스      0.92 
##  9 코스닥   유틸리티                0.93 
## 10 코스닥   소재                    1.07 
## # ... with 12 more rows</code></pre>
<p>위 예제는 시장과 섹터를 기준으로 데이터를 그룹화한 후, 각 그룹별 PBR 중앙값을 구하였습니다. 이처럼 그룹의 경우 하나만이 아닌 원하는 만큼 나눌 수 있습니다.</p>
</div>
</div>
<div id="section-40" class="section level2">
<h2><span class="header-section-number">8.2</span> 종목정보 시각화</h2>
<p>R에서 기본적으로 제공하는 <code>plot()</code> 함수를 통해서도 시각화가 충분히 가능합니다. 그러나 데이터 과학자들에게 가장 많이 사랑받는 패키지 중 하나인 <code>ggplot2</code> 패키지의 <code>ggplot()</code> 함수를 사용할 경우 훨씬 아름답게 그림이 표현 가능하며, 다양한 기능들을 매우 쉽게 사용할 수도 있습니다.</p>
<p><code>ggplot()</code> 함수는 플러스(+) 기호를 사용한다는 점과 문법이 다소 어색하다는 점 때문에 처음에 배우기가 쉽지는 않습니다. 그러나 해당 패키지의 근본이 되는 철학인 <strong>The Grammar of Graphics</strong>를 이해하고 조금만 연습해본다면, 충분히 손쉽게 사용이 가능합니다.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-19"></span>
<img src="images/data_analysis_gg.png" alt="The Grammar of Graphics" width="50%" />
<p class="caption">
그림 4.4: The Grammar of Graphics
</p>
</div>
<div id="geom_point--" class="section level3">
<h3><span class="header-section-number">8.2.1</span> <code>geom_point()</code>: 산점도 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

<span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> ROE, <span class="dt">y =</span> PBR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><code>ggplot()</code> 함수 내에 사용될 데이터인 data_market을 입력하며, aes 인자 내부에 x축은 ROE, y축은 PBR 열을 사용하도록 정의합니다.</li>
<li><code>geom_point()</code> 함수를 통해 산점도 그래프를 그려주도록 합니다. 원하는 그림이 그려지기는 하였으나, ROE와 PBR에 극단치 데이터가 존재하여 둘간의 관계가 잘 보이지 않습니다.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> ROE, <span class="dt">y =</span> PBR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.30</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-21-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>이번에는 극단치 효과를 제거하기 위해 <code>coord_cartesian()</code> 함수 내에 xlim과 ylim, 즉 x축과 y축의 범위를 직접 지정해주도록 합니다. 극단치가 제거되어 데이터를 한 눈에 확인할 수 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> ROE, <span class="dt">y =</span> PBR,
                        <span class="dt">color =</span> <span class="st">`</span><span class="dt">시장구분</span><span class="st">`</span>,
                        <span class="dt">shape =</span> <span class="st">`</span><span class="dt">시장구분</span><span class="st">`</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&#39;lm&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.30</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">3</span>))</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-22-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><code>ggplot()</code> 함수 내부 aes 인자에 color와 shape를 지정해주면, 해당 그룹 별로 모양과 색이 나타납니다. 코스피와 코스닥 종목들에 해당하는 데이터의 색과 점 모양이 다르게 표시할 수 있습니다.</li>
<li><code>geom_smooth()</code> 함수를 통해 평활선을 추가해줄 수도 있으며, 방법으로 lm(linear model)을 지정해줄 경우 선형회귀선을 그려주게 됩니다. 이 외에도 glm, gam, loess 등의 다양한 회귀선을 그려줄 수 있습니다.</li>
</ol>
</div>
<div id="geom_histogram--" class="section level3">
<h3><span class="header-section-number">8.2.2</span> <code>geom_histogram()</code>: 히스토그램 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> PBR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>geom_histogram()</code> 함수는 히스토그램을 나타내주며, binwidth 인자를 막대의 통해 너비를 선택해줄 수 있습니다. 국내 종목들의 PBR 데이터는 좌측에 쏠려있고 오른쪽으로 꼬리가 긴 분포를 가지고 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> PBR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..),
                 <span class="dt">binwidth =</span> <span class="fl">0.1</span>,
                 <span class="dt">color =</span> <span class="st">&#39;sky blue&#39;</span>, <span class="dt">fill =</span> <span class="st">&#39;sky blue&#39;</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_density</span>(<span class="dt">color =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)),
             <span class="dt">color =</span> <span class="st">&#39;blue&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
                <span class="dt">x =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>), <span class="dt">y =</span> <span class="fl">0.05</span>),
             <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">6</span>, <span class="dt">hjust =</span> <span class="fl">-0.5</span>)</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-24-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>PBR 히스토그램을 좀 더 자세하게 나타내보도록 하겠습니다.</p>
<ol style="list-style-type: decimal">
<li><code>geom_histogram()</code> 함수 내에 aes(y = ..density..)를 추가해주어 밀도함수로 바꾸어주도록 합니다.</li>
<li><code>geom_density()</code> 함수를 추가해 밀도곡선을 그려줍니다.</li>
<li><code>geom_vline()</code> 함수는 세로선을 그려주며, xintercept 즉 x축으로 PBR의 중앙값을 선택해 줍니다.</li>
<li><code>geom_text()</code> 함수는 그림 내에 글자를 표현해주며, label 인자에 원하는 글자를 입력해준 후 글자가 표현될 x축, y축, 색상, 사이즈 등을 선택할 수 있습니다.</li>
</ol>
</div>
<div id="geom_boxplot--" class="section level3">
<h3><span class="header-section-number">8.2.3</span> <code>geom_boxplot()</code>: 박스플롯 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(data_market, <span class="kw">aes</span>(<span class="dt">x =</span> SEC_NM_KOR, <span class="dt">y =</span> PBR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>()</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-25-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>박스플롯 역시 데이터의 분포와 이상치를 확인하기 좋은 그림이며, geom_boxplot() 함수를
통해 나타낼 수 있습니다.</p>
<ol style="list-style-type: decimal">
<li>x축 데이터로는 섹터 정보, y축 데이터로는 PBR을 선택해 줍니다.</li>
<li><code>geom_boxplot()</code>를 통해 박스플롯을 그려줍니다.</li>
<li><code>coord_flip()</code> 함수는 x축과 y축을 뒤집어 표현해주며 x축에 PBR, y축에 섹터 정보가 나타나게 되었습니다.</li>
</ol>
<p>결과를 살펴보면 유틸리티나 금융 섹터의 경우 PBR이 잘 모여있는 반면, IT나 건강관리 섹터 등은 매우 극단적인 PBR을 가지고 있는 종목이 존재합니다.</p>
</div>
<div id="dplyr-ggplot--" class="section level3">
<h3><span class="header-section-number">8.2.4</span> <code>dplyr</code>과 <code>ggplot</code>을 연결하여 사용하기</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(SEC_NM_KOR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(SEC_NM_KOR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">ROE_sector =</span> <span class="kw">median</span>(ROE, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">PBR_sector =</span> <span class="kw">median</span>(PBR, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> ROE_sector, <span class="dt">y =</span> PBR_sector,
             <span class="dt">color =</span> SEC_NM_KOR, <span class="dt">label =</span> SEC_NM_KOR)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">vjust =</span> <span class="fl">1.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&#39;bottom&#39;</span>,
        <span class="dt">legend.title =</span> <span class="kw">element_blank</span>())</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-26-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>앞에서 배운 데이터 분석과 시각화를 동시에 연결하여 사용할 수도 있습니다.</p>
<ol style="list-style-type: decimal">
<li>데이터 분석의 단계로 <code>filter()</code>를 통해 섹터가 NA가 아닌 종목을 선택합니다.</li>
<li><code>group_by()</code>를 통해 섹터 별 그룹을 묶습니다.</li>
<li><code>summarize()</code>를 통해 ROE와 PBR의 중앙값을 계산해줍니다. 해당 과정을 거치면 다음의 결과가 계산됩니다.</li>
</ol>
<pre><code>## # A tibble: 10 x 3
##    SEC_NM_KOR         ROE_sector PBR_sector
##    &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt;
##  1 IT                     0.0960       1.53
##  2 건강관리               0.0705       2.59
##  3 경기관련소비재         0.0626       1.07
##  4 금융                   0.0896       0.72
##  5 산업재                 0.0684       0.93
##  6 소재                   0.0631       0.76
##  7 에너지                 0.0608       0.98
##  8 유틸리티               0.0697       0.48
##  9 커뮤니케이션서비스     0.137        0.93
## 10 필수소비재             0.0696       0.96</code></pre>
<p>해당 결과를 파이프 오퍼레이터(<code>%&gt;%</code>)로 이을 경우 그대로 시각화가 가능하며, <code>ggplot()</code> 함수 내에 데이터를 입력하지 않아도 됩니다.</p>
<ol start="4" style="list-style-type: decimal">
<li>x축과 y축을 설정해준 뒤, 색상과 라벨을 섹터로 지정해주면 각 섹터 별로 다른 색상의 산점도가 그려지게 됩니다.</li>
<li><code>geom_text()</code> 함수를 통해 앞에서 라벨로 지정한 섹터 정보들을 출력해줍니다.</li>
<li><code>theme()</code> 함수를 통해 다양한 테마를 지정해주도록 합니다. legend.position 인자를 통해 범례를 하단에 배치하였으며, legend.title 인자를 통해 범례의 제목을 삭제해 주었습니다.</li>
</ol>
</div>
<div id="geom_bar--" class="section level3">
<h3><span class="header-section-number">8.2.5</span> <code>geom_bar()</code>: 막대그래프를 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(SEC_NM_KOR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> SEC_NM_KOR, <span class="dt">y =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-28-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>geom_bar()</code>는 막대그래프를 그려주는 함수입니다.</p>
<ol style="list-style-type: decimal">
<li>먼저 <code>group_by()</code>를 통해 섹터 별 그룹을 묶어줍니다.</li>
<li><code>summarize()</code> 함수 내부에 <code>n()</code>을 통해, 각 그룹 별 데이터 갯수를 구합니다.</li>
<li><code>ggplot()</code> 함수에서 x축에는 SEC_NM_KOR, y축에는 n을 지정해줍니다.</li>
<li><code>geom_bar()</code>를 통해 막대그래프를 그려주도록 합니다. y축에 해당하는 n 데이터를 그대로 사용하기 위해서는 stat인자를 <strong>identity</strong>로 지정해주어야 합니다. <code>theme_*()</code> 함수를 통해 배경 테마를 바꿀수도 있습니다.</li>
</ol>
<p>한편 위 그래프는 데이터 갯수에 따라 순서대로 막대가 정렬되지 않아 보기에 좋은 형태는 아닙니다. 이를 반영하여 더욱 보기좋은 그래프로 나타내주도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(SEC_NM_KOR)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(SEC_NM_KOR) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(SEC_NM_KOR, n), <span class="dt">y =</span> n, <span class="dt">label =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">hjust =</span> <span class="fl">-0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-29-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li><code>filter()</code> 함수를 통해 NA 종목은 삭제해준 후, 섹터 별 종목 갯수를 구해주도록 합니다.</li>
<li><code>ggplot()</code>의 x축에 <code>reorder()</code> 함수를 적용하여 SEC_NM_KOR 변수를 n 순서대로 정렬해줍니다.</li>
<li><code>geom_bar()</code>를 통해 막대그래프를 그려준 후, <code>geom_text()</code>를 통해 라벨에 해당하는 종목 갯수를 출력합니다.</li>
<li><code>xlab()</code>과 <code>ylab()</code>에 NULL을 입력해 라벨을 삭제해 줍니다.</li>
<li><code>coord_flip()</code> 함수를 통해 x축과 y축을 뒤집어 줍니다.</li>
<li><code>scale_y_continuous()</code> 함수를 통해 그림의 간격을 약간 넓혀줍니다.</li>
<li><code>theme_classic()</code>로 테마를 변경해줍니다.</li>
</ol>
<p>결과를 보면, 종목수가 많은 섹터부터 순서대로 정렬되어 보기도 쉬우며, 종묵수도 텍스트로 표현되어 한 눈에 확인할 수 있습니다.</p>
<p>이처럼 데이터 시각화를 통해 정보의 분포나 특성을 한눈에 확인할 수 있으며, <code>ggplot()</code>을 이용할 경우 복잡한 형태의 그림도 매우 간단하고 아름답게 표현할 수 있습니다.</p>
</div>
</div>
<div id="section-41" class="section level2">
<h2><span class="header-section-number">8.3</span> 주가 및 수익률 시각화</h2>
<p>주가 혹은 수익률을 그리는 것 역시 매우 중요합니다. R 내의 기본 함수로도 이를 나타낼 수 있지만, 패키지를 사용한다면 더욱 보기좋은 그래프를 그릴수도 있습니다. 또한 최근에 나오는 여러 패키지들을 이용하면 매우 손쉽게 인터랙티브 그래프를 구현할 수도 있습니다.</p>
<div id="section-42" class="section level3">
<h3><span class="header-section-number">8.3.1</span> 주가 그래프 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(quantmod)

<span class="kw">getSymbols</span>(<span class="st">&#39;SPY&#39;</span>)
prices =<span class="st"> </span><span class="kw">Cl</span>(SPY)</code></pre>
<p><code>getSymbols()</code> 함수를 이용하여 미국 S&amp;P500 지수를 추종하는 ETF인 SPY의 데이터를 다운로드 받은 후, <code>Cl()</code> 함수를 이용하여 종가에 해당하는 데이터만 추출합니다. 이제 해당 가격 및 수익률을 바탕으로 그래프를 그려보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(prices, <span class="dt">main =</span> <span class="st">&#39;Price&#39;</span>)</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>getSymbols()</code> 함수는 데이터를 xts 형식으로 내려받으며, R에서는 데이터가 xts 형식일 경우 기본함수인 <code>plot()</code>으로 그래프를 그려도 x축에 시간을 나타내주며, 우측 상단에 기간을 표시해 줍니다. 그러나 완벽히 깔끔한 형태의 그래프라 보기는 어려운 면이 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)

SPY <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Index, <span class="dt">y =</span> SPY.Close)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-32-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>ggplot()</code>을 이용할 경우 기본 <code>plot()</code> 보다 한결 깔끔해졌으며, 패키지 내의 다양한 함수를 이용해 그래프를 꾸며 나갈수도 있습니다.</p>
</div>
<div id="section-43" class="section level3">
<h3><span class="header-section-number">8.3.2</span> 인터랙티브 그래프 나타내기</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dygraphs)

<span class="kw">dygraph</span>(prices) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">dyRangeSelector</span>()</code></pre>
<p><img src="images/dygraph.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>dygraphs</code> 패키지의 <code>dygraph()</code> 함수를 이용하면 사용자의 움직임에 따라 반응하는 그래프를 그릴 수 있습니다. 해당 패키지는 JavaScript를 이용하여 인터랙티브한 그래프를 구현하며, 그래프 위에 마우스를 올릴 경우 날짜 및 가격이 표시되기도 하며, 하단의 셀렉터를 이용해 원하는 기간의 수익률을 선택할 수도 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(highcharter)

<span class="kw">highchart</span>(<span class="dt">type =</span> <span class="st">&#39;stock&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hc_add_series</span>(prices) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">hc_scrollbar</span>(<span class="dt">enabled =</span> <span class="ot">FALSE</span>)</code></pre>
<p><img src="images/highcharter.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>highcharter</code> 패키지의 <code>highchart()</code> 함수 역시 이와 비슷한 기능을 하며, 인터랙티브 그래프를 생성해줍니다. 좌측 상단의 기간을 클릭할 경우 해당 기간의 수익률 만을 확인할 수도 있으며, 우측 상단에 기간을 직접 입력할 수도 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(plotly)

p =<span class="st"> </span>SPY <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Index, <span class="dt">y =</span> SPY.Close)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>()

<span class="kw">ggplotly</span>(p)</code></pre>
<p><img src="images/ggplotly.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>plotly</code> 패키지는 R 뿐만 아니라 Python, MATLAB, Julia 등 여러 프로그래밍 언어에 사용될 수 있는 그래픽 패키지로써 최근에 많은 사랑을 받고 있습니다. R 내에서는 단순히 <code>ggplot()</code>을 이용해 나타낸 그림에 <code>ggplotly()</code> 함수를 추가해주는것 만으로 인터랙티브한 그래프를 만들어 줍니다.</p>
<p>또한 해당 패키지는 최근 샤이니에서도 많이 사용되고 있습니다. 따라서 샤이니를 이용한 웹페이지 제작을 생각하고 계신분이라면, 원래의 함수 실행법도 알아두면 좋습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">prices <span class="op">%&gt;%</span>
<span class="st">  </span>fortify.zoo <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_ly</span>(<span class="dt">x=</span> <span class="op">~</span>Index, <span class="dt">y =</span> <span class="op">~</span>SPY.Close ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">add_lines</span>()</code></pre>
<p><img src="images/plotly.png" width="70%" style="display: block; margin: auto;" /></p>
<p><code>plot_ly()</code> 함수 내부에 x축과 y축을 설정해주며, 변수명 앞에 물결표(~)를 붙여줍니다. 그 후, <code>add_lines()</code> 함수를 추가해주면 선그래프를 표시해줍니다. <code>ggplot()</code> 함수의 경우 각 레이어의 연결을 플러스 기호(<code>+</code>)를 통해 해주었지만, <code>plot_ly()</code> 함수의 경우 파이프 오퍼레이터(<code>%&gt;%</code>)를 통해 할 수 있다는 장점이 있습니다.</p>
</div>
<div id="section-44" class="section level3">
<h3><span class="header-section-number">8.3.3</span> 연도별 수익률 나타내기</h3>
<p>주가 그래프 외에 연도별 수익률을 그리는 것도 중요합니다. <code>ggplot()</code>을 통해 연도별 수익률을 막대그래프로 나타내는 방법을 살펴보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(PerformanceAnalytics)

ret_yearly =<span class="st"> </span>prices <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">Return.calculate</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">apply.yearly</span>(., Return.cumulative) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">round</span>(<span class="dv">4</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">fortify.zoo</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Index =</span> <span class="kw">as.numeric</span>(<span class="kw">substring</span>(Index, <span class="dv">1</span>, <span class="dv">4</span>)))

<span class="kw">ggplot</span>(ret_yearly, <span class="kw">aes</span>(<span class="dt">x =</span> Index, <span class="dt">y =</span> SPY.Close)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat =</span> <span class="st">&#39;identity&#39;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> ret_yearly<span class="op">$</span>Index,
                       <span class="dt">expand =</span> <span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> <span class="kw">paste</span>(<span class="kw">round</span>(SPY.Close <span class="op">*</span><span class="st"> </span><span class="dv">100</span>, <span class="dv">2</span>), <span class="st">&quot;%&quot;</span>),
                <span class="dt">vjust =</span> <span class="kw">ifelse</span>(SPY.Close <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, <span class="fl">-0.5</span>, <span class="fl">1.5</span>)),
            <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="dv">1</span>),
            <span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="ot">NULL</span>)</code></pre>
<p><img src="08-data_analysis_files/figure-html/unnamed-chunk-45-1.png" width="70%" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>먼저 <code>apply.yearly()</code> 함수를 이용해 연도별 수익률을 계산해준 뒤 반올림을 해줍니다.</li>
<li><code>fortify.zoo()</code> 함수를 통해 인덱스에 있는 시간 데이터를 Index 열로 이동합니다.</li>
<li><code>mutate()</code> 함수 내에 <code>substring()</code> 을 통해 Index의 1번째부터 4번째 글자, 즉 연도에 해당하는 부분을 뽑아낸 후, 숫자 형태로 저장합니다.</li>
<li><code>ggplot()</code> 함수를 이용해 x축에는 연도가 저장된 Index, y축에는 수익률이 저장된 SPY.Close를 입력합니다.</li>
<li><code>geom_bar()</code> 함수를 통해 막대그래프를 그려줍니다.</li>
<li><code>scale_x_continuous()</code> 함수를 통해 x축에 모든 연도가 출력되도록 합니다.</li>
<li><code>geom_text()</code>를 통해 막대그래프에 연도별 수익률이 표시되도록 합니다. <code>vjust()</code> 내에 <code>ifelse()</code> 함수를 사용하여 수익률이 0보다 크면 위쪽에, 0보다 작으면 아래쪽에 표시되도록 합니다.</li>
</ol>
<p>해당 과정을 거치면 막대 그래프와 텍스트를 통해 연도별 수익률을 한 눈에 확인할 수 있게 됩니다.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="section-34.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="section-45.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
