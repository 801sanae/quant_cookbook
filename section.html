<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 퀀트 전략을 이용한 종목선정 (심화) | 10-factor_adv.utf8.md</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.11 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 퀀트 전략을 이용한 종목선정 (심화) | 10-factor_adv.utf8.md" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 퀀트 전략을 이용한 종목선정 (심화) | 10-factor_adv.utf8.md" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">퀀트 투자 쿡북</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#section"><i class="fa fa-check"></i><b>1</b> 퀀트 전략을 이용한 종목선정 (심화)</a><ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#section-1"><i class="fa fa-check"></i><b>1.1</b> 섹터 중립 포트폴리오</a></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#section-2"><i class="fa fa-check"></i><b>1.2</b> 마법공식</a><ul>
<li class="chapter" data-level="1.2.1" data-path=""><a href="#section-3"><i class="fa fa-check"></i><b>1.2.1</b> 퀄리티와 밸류 간의 관계</a></li>
<li class="chapter" data-level="1.2.2" data-path=""><a href="#section-4"><i class="fa fa-check"></i><b>1.2.2</b> 마법공식 이해하기</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="http://henryquant.blogspot.com/" target="blank">Henry's Quantopia</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="section" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> 퀀트 전략을 이용한 종목선정 (심화)</h1>
<p>지난 장에서는 팩터를 이용한 투자 전략의 기본이 되는 로우볼, 모멘텀, 밸류, 퀄리티 전략에 대해 알아보았습니다. 물론 이러한 단일 팩터를 이용한 투자도 장기적으로 우수한 성과를 보이지만, 여러 팩터를 결합하거나 좀더 정밀하게 전략을 만든다면 더욱 우수한 성과를 거둘 수 있습니다.</p>
<p>이번 장에서는 섹터별 효과를 없앤 후 포트폴리오를 구성하는 방법, 극단치 데이터 제거 및 팩터 결합 방법, 그리고 멀티팩터 구성방법에 대해 알아보겠습니다.</p>
<div id="section-1" class="section level2">
<h2><span class="header-section-number">1.1</span> 섹터 중립 포트폴리오</h2>
<p>팩터 전략의 단점 중 하나는 선택된 종목들이 특정 섹터로 쏠리는 경우가 있다는 점입니다. 특히 과거 수익률을 토대로 종목을 선정하는 모멘텀 전략의 경우, 특정 섹터가 좋을때 동일한 섹터의 모든 종목이 함께 움직이는 경향이 있어 이러한 쏠림이 심할 수 있습니다.</p>
<p>먼저 지난 장에서 배운 12개월 모멘텀을 이용한 포트폴리오 구성 방법을 다시 살펴보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">library</span>(xts)
<span class="kw">library</span>(PerformanceAnalytics)
<span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)

KOR_price =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_price.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.xts</span>()
KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) 
KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span> =<span class="st"> </span><span class="kw">str_pad</span>(KOR_ticker<span class="op">$</span><span class="st">&#39;종목코드&#39;</span>, <span class="dv">6</span>, <span class="st">&#39;left&#39;</span>, <span class="dv">0</span>)

ret =<span class="st"> </span><span class="kw">Return.calculate</span>(KOR_price) <span class="op">%&gt;%</span><span class="st"> </span>xts<span class="op">::</span><span class="kw">last</span>(<span class="dv">252</span>) 
ret_12m =<span class="st"> </span>ret <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sapply</span>(., <span class="cf">function</span>(x) {
  <span class="kw">prod</span>(<span class="dv">1</span><span class="op">+</span>x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  })

invest_mom =<span class="st"> </span><span class="kw">rank</span>(<span class="op">-</span>ret_12m) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span></code></pre>
<p>기존의 코드와 동일하게, 주식 가격 및 티커 데이터를 불러온 후, 최근 12개얼 수익률을 구해 상위 30 종목을 선택합니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">KOR_sector =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_sector.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
KOR_sector<span class="op">$</span><span class="st">&#39;CMP_CD&#39;</span> =<span class="st"> </span><span class="kw">str_pad</span>(KOR_sector<span class="op">$</span><span class="st">&#39;CMP_CD&#39;</span>, <span class="dv">6</span>, <span class="st">&#39;left&#39;</span>, <span class="dv">0</span>)
data_market =<span class="st"> </span><span class="kw">left_join</span>(KOR_ticker, KOR_sector,
                         <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&#39;종목코드&#39;</span> =<span class="st"> &#39;CMP_CD&#39;</span>, <span class="st">&#39;종목명&#39;</span> =<span class="st"> &#39;CMP_KOR&#39;</span>))</code></pre>
<p>해당 종목들의 섹터 정보를 추가로 살펴보기 위해, 섹터 데이터를 불러온 후, <code>left_join()</code> 함수를 이용해 티커와 결합하여 data_market에 저장해줍니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">data_market[invest_mom, ] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>, <span class="st">`</span><span class="dt">n</span><span class="st">`</span>), <span class="dt">y =</span> <span class="st">`</span><span class="dt">n</span><span class="st">`</span>, <span class="dt">label =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">hjust =</span> <span class="fl">-0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre>
<p><img src="10-factor_adv_files/figure-html/unnamed-chunk-3-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p><code>group_by()</code> 함수를 이용하여 12개월 기준 모멘텀 포트폴리오 종목들의 섹터 별 종목수를 계산해준 후, <code>ggplot()</code> 함수를 이용하여 이를 그림으로 나타내줍니다. 그림에서 알 수 있듯이, 특정 섹터에 대부분의 종목이 몰려있습니다.</p>
<p>따라서 여러 종목으로 포트폴리오를 구성하였지만, 분해해보면 특정 섹터에 쏠림이 심하다는 것을 알 수 있습니다. 이러한 섹터 쏠림 현상을 제거한 <strong>섹터 중립 포트폴리오</strong>를 구성해 보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">sector_neutral =<span class="st"> </span>data_market <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">종목코드</span><span class="st">`</span>, <span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">ret</span><span class="st">`</span> =<span class="st"> </span>ret_12m) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">scale_per_sector =</span> <span class="kw">scale</span>(<span class="st">`</span><span class="dt">ret</span><span class="st">`</span>),
         <span class="dt">scale_per_sector =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>), <span class="ot">NA</span>, scale_per_sector))</code></pre>
<ol style="list-style-type: decimal">
<li>먼저 종목코드와 섹터정보, 그리고 12개월 수익률 정보를 불러옵니다.</li>
<li><code>group_by()</code> 함수를 통해 섹터별 그룹을 만들어 줍니다.</li>
<li><code>scale()</code> 함수를 이용해 정규화를 해줍니다. 정규화의 경우 <span class="math inline">\(\frac{x- \mu}{\sigma}\)</span>로 계산됩니다.</li>
<li>섹터 정보가 없는 정보는 삭제해주도록 합니다.</li>
</ol>
<p>위의 정규화 과정을 살펴보면, 전체 종목에서 12개월 수익률을 비교하는 것이 아닌 각 섹터별로 수익률의 강도를 비교하게 됩니다. 따라서 특정 종목의 과거 수익률이 전체 종목과 비교해서 높았어도 해당 섹터 내에서의 순위가 낮다면, 정규화된 값은 낮게됩니다.</p>
<p>따라서 섹터 별 정규화 과정을 거친 값으로 비교 분석을 한다면, 섹터 효과가 어느정도 제거된 포트폴리오를 구성할 수 있습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r">invest_mom_neutral =<span class="st"> </span><span class="kw">rank</span>(<span class="op">-</span>sector_neutral<span class="op">$</span>scale_per_sector) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>

data_market[invest_mom_neutral, ] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(<span class="st">`</span><span class="dt">SEC_NM_KOR</span><span class="st">`</span>, <span class="st">`</span><span class="dt">n</span><span class="st">`</span>), <span class="dt">y =</span> <span class="st">`</span><span class="dt">n</span><span class="st">`</span>, <span class="dt">label =</span> n)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">hjust =</span> <span class="fl">-0.3</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">expand =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre>
<p><img src="10-factor_adv_files/figure-html/unnamed-chunk-5-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>정규화된 값의 랭킹이 높은 상위 30 종목을 선택하며, 내림차순을 위해 마이너스를 붙여줍니다. 해당 포트폴리오의 섹터 별 구성종목을 확인해보면, 단순하게 포트폴리오를 구성한 것 대비, 여러 섹터에 종목이 분산되어 있음이 확인됩니다.</p>
<p>이처럼 <code>group_by()</code> 함수를 통해 손쉽게 그룹별 중립화를 할 수 있으며, 글로벌 투자를 하는 경우에는 지역, 국가, 섹터 별로도 중립화된 포트폴리오를 구성하기도 합니다.</p>
</div>
<div id="section-2" class="section level2">
<h2><span class="header-section-number">1.2</span> 마법공식</h2>
<p>하나의 팩터만을 보고 투자하는 것 보다, 둘 혹은 그 이상의 팩터를 결합하여 투자하는 것이 훨씬 좋은 포트폴리오를 구성할 수 있으며, 이러한 방법을 멀티 팩터라 합니다. 그중에서도 밸류와 퀄리티의 조합은 전통적으로 많이 사용되어진 방법이며, 그 중 대표적인 예가 조엘 그린블라트의 마법공식입니다.</p>
<p>이번 장에서는 퀄리티와 밸류 간의 관계, 그리고 마법공식의 정의와 구성방법에 대해 알아보도록 하겠습니다.</p>
<div id="section-3" class="section level3">
<h3><span class="header-section-number">1.2.1</span> 퀄리티와 밸류 간의 관계</h3>
<p>투자의 정석 중 하나는 <strong>좋은 기업을 싸게 사는 것</strong>입니다. 이를 팩터의 관점에서 이해하면 퀄리티 팩터와 밸류 팩터로 이해할 수도 있습니다.</p>
<p>여러 논문에 따르면 흔히 밸류와 퀄리티 팩터는 반대의 관계에 있습니다. 먼저 가치주들은 위험이 크기 때문에 시장에서 소외를 받아 저평가가 이루어지는 것이며, 이러한 위험에 대한 댓가로 밸류 팩터의 수익률이 높게됩니다. 반대로 사람들은 우량주에 기꺼이 프리미엄을 지불하려 하기 때문에 퀄리티 팩터의 수익률이 높기도 합니다. 이는 마치 동전의 양면과 같지만, 장기적으로 가치주와 우량주 모두 우수한 성과를 기록합니다.</p>
<p>먼저 퀄리티의 지표인 매출총이익과 밸류 지표인 PBR을 통해 둘간의 관계를 확인해보도록 하겠습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">library</span>(dplyr)

KOR_value =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_value.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)
KOR_fs =<span class="st"> </span><span class="kw">readRDS</span>(<span class="st">&#39;data/KOR_fs.Rds&#39;</span>)
KOR_ticker =<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/KOR_ticker.csv&#39;</span>, <span class="dt">row.names =</span> <span class="dv">1</span>, <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>) 

data_pbr =<span class="st"> </span>KOR_value[<span class="st">&#39;PBR&#39;</span>]
data_gpa =<span class="st"> </span>(KOR_fs<span class="op">$</span><span class="st">&#39;매출총이익&#39;</span> <span class="op">/</span><span class="st"> </span>KOR_fs<span class="op">$</span><span class="st">&#39;자산&#39;</span>)[<span class="kw">ncol</span>(KOR_fs<span class="op">$</span><span class="st">&#39;매출총이익&#39;</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">setNames</span>(<span class="st">&#39;GPA&#39;</span>)

<span class="kw">cbind</span>(data_pbr, <span class="op">-</span>data_gpa) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cor</span>(<span class="dt">method =</span> <span class="st">&#39;spearman&#39;</span>, <span class="dt">use =</span> <span class="st">&#39;complete.obs&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">round</span>(<span class="dv">4</span>)</code></pre>
<pre><code>##         PBR     GPA
## PBR  1.0000 -0.2096
## GPA -0.2096  1.0000</code></pre>
<p>데이터를 불러온 후, PBR과 GPA(매출총이익 / 자산)을 구해주도록 합니다. 그 후 랭킹의 상관관계인 스피어만 상관관계를 구해보면, 서로 간 반대 관계가 있음이 확인됩니다. PBR의 경우 오름차순, GPA의 경우 내림차순 이므로 GPA 앞에 마이너스를 붙여주었습니다.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cbind</span>(data_pbr, data_gpa) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">quantile_pbr =</span> <span class="kw">ntile</span>(data_pbr, <span class="dv">5</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(quantile_pbr)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(quantile_pbr) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_gpa =</span> <span class="kw">mean</span>(GPA, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> quantile_pbr, <span class="dt">y =</span> mean_gpa)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">xlab</span>(<span class="st">&#39;PBR&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">ylab</span>(<span class="st">&#39;GPA&#39;</span>)</code></pre>
<p><img src="10-factor_adv_files/figure-html/unnamed-chunk-7-1.png" width="50%" style="display: block; margin: auto;" /></p>
<p>이번에는 PBR의 분위수 별 GPA 평균값을 구하도록 하겠습니다.</p>
<ol style="list-style-type: decimal">
<li><code>ntile()</code> 함수를 이용해 PBR을 5분위수로 나누어 줍니다.</li>
<li>PBR이 없는 종목은 제외합니다.</li>
<li><code>group_by()</code>를 통해 PBR의 분위수별 그룹을 묶어 줍니다.</li>
<li>각 PBR 그룹 별 GPA의 평균값을 구해줍니다.</li>
<li><code>ggplot()</code>을 이용해 시각화를 해줍니다.</li>
</ol>
<p>그림에서 알수 있듯이 PBR이 낮을수록 GPA도 낮으며, 즉 가치주일수록 우량성은 떨어집니다. 반면에 PBR이 높을수록 GPA도 늪으며, 이는 주식의 가격이 비쌀수록 우량성도 높다는 것을 의미합니다.</p>
<p>이를 이용해 밸류 팩터와 퀄리티 팩터간의 관계를 나타내면 다음과 같습니다.</p>
<table style="height: 171px;" width="552">
<tbody>
<tr style="height: 37px;">
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>&nbsp;</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>&nbsp;</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;" colspan="2">
<p>Value</p>
</td>
</tr>
<tr style="height: 35px;">
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>&nbsp;</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>&nbsp;</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>Expensive</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>Cheap</p>
</td>
</tr>
<tr style="height: 37px;">
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;" rowspan="2">
<p>Quality</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>Junk</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p><strong>2. Worst</strong></p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>1. Value</p>
</td>
</tr>
<tr style="height: 37px;">
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>Quality</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p>3. Quality</p>
</td>
<td style="width: 63px; height: 37px; text-align: center; vertical-align: middle;">
<p><strong>4. Best</strong></p>
</td>
</tr>
</tbody>
</table>
<p>주가가 쌀수록 기업의 우량성은 떨어지며(1번), 반대로 기업의 우량성이 좋으면 주식은 비싼 경향(3번)이 있습니다. 물론 우량성도 떨어지고 비싸기만한 주식(2번)을 사려는 사람들 아마 없을 겁니다. 결과적으로 우리가 원하는 최고의 주식은 우량성이 있으면서도 가격은 싼 주식(4번)일 것입니다.</p>
</div>
<div id="section-4" class="section level3">
<h3><span class="header-section-number">1.2.2</span> 마법공식 이해하기</h3>
<p>마법공식이란 고담 캐피탈의 설립자이자 전설적인 투자자 조엘 그린블라트에 의해 알려진 투자방법입니다. 그는 본인의 책 <strong>주식 시장을 이기는 작은 책</strong>에서 투자를 하는데 있어서 중요한 두가지 지표와, 이를 혼합할 경우 뛰어난 성과를 기록할 수 있다고 하였습니다.</p>
<p>첫번째 지표는 이율 (Earnings Yield)로써 기업의 수익을 기업의 가치로 나는 값입니다. 이는 PER와도 비슷하며, 밸류 지표 중 하나입니다.</p>
<p>두번째 지표는 투자 자본 수익률 (Return on Capital)로써 기업의 수익을 투자한 자본으로 나눈 값입니다. 이는 ROE와도 비슷하며, 퀄리티 지표 중 하나입니다.</p>
<p>마법공식은 이 두가지 지표의 랭킹을 각각 구한 후, 랭킹의 합 기준 상위 30 개 종목을 1년간 보유한 후 매도하는 전략입니다.</p>
<table>
<caption><span id="tab:unnamed-chunk-9">Table 1.1: </span>마법공식의 구성 요소</caption>
<thead>
<tr class="header">
<th align="left">팩터</th>
<th align="left">Value</th>
<th align="left">Quality</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">지표</td>
<td align="left">이율 (Earnings Yield)</td>
<td align="left">투하 자본 수익률 (Return On Capital)</td>
</tr>
<tr class="even">
<td align="left">계정 (한글)</td>
<td align="left"><span class="math inline">\(\frac{이자\,및\,세전이익}{(시가총액 + 부채 - 현금)}\)</span></td>
<td align="left"><span class="math inline">\(\frac{이자\,및\,세전이익}{유형자산 + 무형자산 + 유동자산 - 유동부채 - 현금}\)</span></td>
</tr>
<tr class="odd">
<td align="left">계정 (영문)</td>
<td align="left"><span class="math inline">\(\frac{EBIT}{Total\,Enterprise\,Value}\)</span></td>
<td align="left"><span class="math inline">\(\frac{Net\,Operating\,Profit - Adjusted\,Taxed}{Invested\,Capital}\)</span></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
